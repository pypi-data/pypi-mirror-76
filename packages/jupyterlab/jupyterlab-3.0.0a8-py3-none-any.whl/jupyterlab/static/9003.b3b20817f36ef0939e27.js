(window["webpackJsonp_jupyterlab_application_top"]=window["webpackJsonp_jupyterlab_application_top"]||[]).push([[9003],{"6jPX":(e,t,s)=>{"use strict";s.r(t);s.d(t,{isValidFileName:()=>d,renameDialog:()=>c,renameFile:()=>l,shouldOverwrite:()=>h,IDocumentManager:()=>w,DocumentManager:()=>W,SaveHandler:()=>D,SavingStatus:()=>I,PathStatus:()=>N,DocumentWidgetManager:()=>M});var i=s("V3w5");var n=s("0c61");var r=s("aV2H");const a="jp-FileDialog";const o="jp-new-name-title";function c(e,t){return(0,i.showDialog)({title:"Rename File",body:new u(t),focusNodeSelector:"input",buttons:[i.Dialog.cancelButton(),i.Dialog.okButton({label:"Rename"})]}).then(s=>{if(!s.value){return null}if(!d(s.value)){void(0,i.showErrorMessage)("Rename Error",Error(`"${s.value}" is not a valid name for a file. `+`Names must have nonzero length, `+`and cannot include "/", "\\", or ":"`));return null}const r=n.PathExt.dirname(t);const a=n.PathExt.join(r,s.value);return l(e,t,a)})}function l(e,t,s){return e.rename(t,s).catch(i=>{if(i.message.indexOf("409")===-1){throw i}return h(s).then(i=>{if(i){return e.overwrite(t,s)}return Promise.reject("File not renamed")})})}function h(e){const t={title:"Overwrite file?",body:`"${e}" already exists, overwrite?`,buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:"Overwrite"})]};return(0,i.showDialog)(t).then(e=>Promise.resolve(e.button.accept))}function d(e){const t=/[\/\\:]/;return e.length>0&&!t.test(e)}class u extends r.Widget{constructor(e){super({node:g.createRenameNode(e)});this.addClass(a);const t=n.PathExt.extname(e);const s=this.inputNode.value=n.PathExt.basename(e);this.inputNode.setSelectionRange(0,s.length-t.length)}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}var g;(function(e){function t(e){const t=document.createElement("div");const s=document.createElement("label");s.textContent="File Path";const i=document.createElement("span");i.textContent=e;const n=document.createElement("label");n.textContent="New Name";n.className=o;const r=document.createElement("input");t.appendChild(s);t.appendChild(i);t.appendChild(n);t.appendChild(r);return t}e.createRenameNode=t})(g||(g={}));var _=s("l37l");var p=s("s/A5");var f=s("yR1x");var m=s.n(f);var v=s("3gBK");const w=new _.Token("@jupyterlab/docmanager:IDocumentManager");var y=s("CwOy");var x=s("51fH");var P=s("ou5F");class D{constructor(e){this._autosaveTimer=-1;this._minInterval=-1;this._interval=-1;this._isActive=false;this._inDialog=false;this._isDisposed=false;this._multiplier=10;this._context=e.context;const t=e.saveInterval||120;this._minInterval=t*1e3;this._interval=this._minInterval;this._context.fileChanged.connect(this._setTimer,this);this._context.disposed.connect(this.dispose,this)}get saveInterval(){return this._interval/1e3}set saveInterval(e){this._minInterval=this._interval=e*1e3;if(this._isActive){this._setTimer()}}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;clearTimeout(this._autosaveTimer);p.Signal.clearData(this)}start(){this._isActive=true;this._setTimer()}stop(){this._isActive=false;clearTimeout(this._autosaveTimer)}_setTimer(){clearTimeout(this._autosaveTimer);if(!this._isActive){return}this._autosaveTimer=window.setTimeout(()=>{this._save()},this._interval)}_save(){const e=this._context;this._setTimer();if(!e){return}const t=e.contentsModel&&e.contentsModel.writable;if(!t||!e.model.dirty||this._inDialog){return}const s=(new Date).getTime();e.save().then(()=>{if(this.isDisposed){return}const e=(new Date).getTime()-s;this._interval=Math.max(this._multiplier*e,this._minInterval);this._setTimer()}).catch(e=>{if(e.message==="Cancel"){return}console.error("Error in Auto-Save",e.message)})}}var C=s("fBQ3");const b="jp-Document";class M{constructor(e){this._activateRequested=new p.Signal(this);this._isDisposed=false;this._registry=e.registry}get activateRequested(){return this._activateRequested}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;p.Signal.disconnectReceiver(this)}createWidget(e,t){const s=e.createNew(t);this._initializeWidget(s,e,t);return s}_initializeWidget(e,t,s){F.factoryProperty.set(e,t);const i=new y.DisposableSet;(0,v.each)(this._registry.widgetExtensions(t.name),t=>{i.add(t.createNew(e,s))});F.disposablesProperty.set(e,i);e.disposed.connect(this._onWidgetDisposed,this);this.adoptWidget(s,e);s.fileChanged.connect(this._onFileChanged,this);s.pathChanged.connect(this._onPathChanged,this);void s.ready.then(()=>{void this.setCaption(e)})}adoptWidget(e,t){const s=F.widgetsProperty.get(e);s.push(t);C.MessageLoop.installMessageHook(t,this);t.addClass(b);t.title.closable=true;t.disposed.connect(this._widgetDisposed,this);F.contextProperty.set(t,e)}findWidget(e,t){const s=F.widgetsProperty.get(e);if(!s){return undefined}return(0,v.find)(s,e=>{const s=F.factoryProperty.get(e);if(!s){return false}return s.name===t})}contextForWidget(e){return F.contextProperty.get(e)}cloneWidget(e){const t=F.contextProperty.get(e);if(!t){return undefined}const s=F.factoryProperty.get(e);if(!s){return undefined}const i=s.createNew(t,e);this._initializeWidget(i,s,t);return i}closeWidgets(e){const t=F.widgetsProperty.get(e);return Promise.all((0,v.toArray)((0,v.map)(t,e=>this.onClose(e)))).then(()=>undefined)}deleteWidgets(e){const t=F.widgetsProperty.get(e);return Promise.all((0,v.toArray)((0,v.map)(t,e=>this.onDelete(e)))).then(()=>undefined)}messageHook(e,t){switch(t.type){case"close-request":void this.onClose(e);return false;case"activate-request":{const t=this.contextForWidget(e);if(t){this._activateRequested.emit(t.path)}break}default:break}return true}async setCaption(e){const t=F.contextProperty.get(e);if(!t){return}const s=t.contentsModel;if(!s){e.title.caption="";return}return t.listCheckpoints().then(i=>{if(e.isDisposed){return}const r=i[i.length-1];const a=r?n.Time.format(r.last_modified):"None";let o=`Name: ${s.name}\nPath: ${s.path}\n`;if(t.model.readOnly){o+="Read-only"}else{o+=`Last Saved: ${n.Time.format(s.last_modified)}\n`+`Last Checkpoint: ${a}`}e.title.caption=o})}async onClose(e){var t;const[s,i]=await this._maybeClose(e);if(e.isDisposed){return true}if(s){if(!i){const s=F.contextProperty.get(e);if(!s){return true}if((t=s.contentsModel)===null||t===void 0?void 0:t.writable){await s.save()}else{await s.saveAs()}}if(e.isDisposed){return true}e.dispose()}return s}onDelete(e){e.dispose();return Promise.resolve(void 0)}_maybeClose(e){var t;const s=F.contextProperty.get(e);if(!s){return Promise.resolve([true,true])}let n=F.widgetsProperty.get(s);if(!n){return Promise.resolve([true,true])}n=(0,v.toArray)((0,v.filter)(n,e=>{const t=F.factoryProperty.get(e);if(!t){return false}return t.readOnly===false}));const r=F.factoryProperty.get(e);if(!r){return Promise.resolve([true,true])}const a=s.model;if(!a.dirty||n.length>1||r.readOnly){return Promise.resolve([true,true])}const o=e.title.label;const c=((t=s.contentsModel)===null||t===void 0?void 0:t.writable)?"Save":"Save as";return(0,i.showDialog)({title:"Save your work",body:`Save changes in "${o}" before closing?`,buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:"Discard"}),i.Dialog.okButton({label:c})]}).then(e=>[e.button.accept,e.button.displayType==="warn"])}_widgetDisposed(e){const t=F.contextProperty.get(e);if(!t){return}const s=F.widgetsProperty.get(t);if(!s){return}v.ArrayExt.removeFirstOf(s,e);if(!s.length){t.dispose()}}_onWidgetDisposed(e){const t=F.disposablesProperty.get(e);t.dispose()}_onFileChanged(e){const t=F.widgetsProperty.get(e);(0,v.each)(t,e=>{void this.setCaption(e)})}_onPathChanged(e){const t=F.widgetsProperty.get(e);(0,v.each)(t,e=>{void this.setCaption(e)})}}var F;(function(e){e.contextProperty=new P.AttachedProperty({name:"context",create:()=>undefined});e.factoryProperty=new P.AttachedProperty({name:"factory",create:()=>undefined});e.widgetsProperty=new P.AttachedProperty({name:"widgets",create:()=>[]});e.disposablesProperty=new P.AttachedProperty({name:"disposables",create:()=>new y.DisposableSet})})(F||(F={}));class W{constructor(e){this._activateRequested=new p.Signal(this);this._contexts=[];this._isDisposed=false;this._autosave=true;this._autosaveInterval=120;this.registry=e.registry;this.services=e.manager;this._dialogs=e.sessionDialogs||i.sessionContextDialogs;this._opener=e.opener;this._when=e.when||e.manager.ready;const t=new M({registry:this.registry});t.activateRequested.connect(this._onActivateRequested,this);this._widgetManager=t;this._setBusy=e.setBusy}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){this._autosave=e;this._contexts.forEach(t=>{const s=S.saveHandlerProperty.get(t);if(!s){return}if(e===true&&!s.isActive){s.start()}else if(e===false&&s.isActive){s.stop()}})}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){this._autosaveInterval=e;this._contexts.forEach(t=>{const s=S.saveHandlerProperty.get(t);if(!s){return}s.saveInterval=e||120})}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;p.Signal.clearData(this);this._contexts.forEach(e=>this._widgetManager.closeWidgets(e));this._widgetManager.dispose();this._contexts.length=0}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map(e=>this._widgetManager.closeWidgets(e))).then(()=>undefined)}closeFile(e){const t=this._contextsForPath(e).map(e=>this._widgetManager.closeWidgets(e));return Promise.all(t).then(e=>undefined)}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",s){return this._createOrOpenDocument("create",e,t,s)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then(()=>this.services.contents.delete(e)).then(()=>{this._contextsForPath(e).forEach(e=>this._widgetManager.deleteWidgets(e));return Promise.resolve(void 0)})}findWidget(e,t="default"){const s=n.PathExt.normalize(e);let i=[t];if(t==="default"){const e=this.registry.defaultWidgetFactory(s);if(!e){return undefined}i=[e.name]}else if(t===null){i=this.registry.preferredWidgetFactories(s).map(e=>e.name)}for(const n of this._contextsForPath(s)){for(const e of i){if(e!==null){const t=this._widgetManager.findWidget(n,e);if(t){return t}}}}return undefined}newUntitled(e){if(e.type==="file"){e.ext=e.ext||".txt"}return this.services.contents.newUntitled(e)}open(e,t="default",s,i){return this._createOrOpenDocument("open",e,t,s,i)}openOrReveal(e,t="default",s,i){const n=this.findWidget(e,t);if(n){this._opener.open(n,i||{});return n}return this.open(e,t,s,i||{})}overwrite(e,t){const s=`${t}.${_.UUID.uuid4()}`;const i=()=>this.rename(s,t);return this.rename(e,s).then(()=>this.deleteFile(t)).then(i,i)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const s=this.services.contents.normalize(e);return(0,v.find)(this._contexts,e=>e.path===s&&e.factoryName===t)}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter(e=>e.path===t)}_createContext(e,t,s){const i=(e,t)=>{this._widgetManager.adoptWidget(r,e);this._opener.open(e,t)};const n=this.services.contents.getModelDBFactory(e)||undefined;const r=new x.Context({opener:i,manager:this.services,factory:t,path:e,kernelPreference:s,modelDBFactory:n,setBusy:this._setBusy,sessionDialogs:this._dialogs});const a=new D({context:r,saveInterval:this.autosaveInterval});S.saveHandlerProperty.set(r,a);void r.ready.then(()=>{if(this.autosave){a.start()}});r.disposed.connect(this._onContextDisposed,this);this._contexts.push(r);return r}_onContextDisposed(e){v.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:s}=this;if(t==="default"){const i=s.defaultWidgetFactory(e);if(!i){return undefined}t=i.name}return s.getWidgetFactory(t)}_createOrOpenDocument(e,t,s="default",i,n){const r=this._widgetFactoryFor(t,s);if(!r){return undefined}const a=r.modelName||"text";const o=this.registry.getModelFactory(a);if(!o){return undefined}const c=this.registry.getKernelPreference(t,r.name,i);let l;let h=Promise.resolve(undefined);if(e==="open"){l=this._findContext(t,o.name)||null;if(!l){l=this._createContext(t,o,c);h=this._when.then(()=>l.initialize(false))}}else if(e==="create"){l=this._createContext(t,o,c);h=this._when.then(()=>l.initialize(true))}else{throw new Error(`Invalid argument 'which': ${e}`)}const d=this._widgetManager.createWidget(r,l);this._opener.open(d,n||{});h.catch(e=>{d.close()});return d}_onActivateRequested(e,t){this._activateRequested.emit(t)}}var S;(function(e){e.saveHandlerProperty=new P.AttachedProperty({name:"saveHandler",create:()=>undefined})})(S||(S={}));var A=s("tUVX");function E(e){return m().createElement(A.TextItem,{source:`Saving ${e.fileStatus}`})}const T=2e3;class I extends i.VDomRenderer{constructor(e){super(new I.Model(e.docManager))}render(){if(this.model===null||this.model.status===null){return null}else{return m().createElement(E,{fileStatus:this.model.status})}}}(function(e){class t extends i.VDomModel{constructor(e){super();this._onStatusChange=(e,t)=>{this._status=t;if(this._status==="completed"){setTimeout(()=>{this._status=null;this.stateChanged.emit(void 0)},T);this.stateChanged.emit(void 0)}else{this.stateChanged.emit(void 0)}};this._status=null;this._widget=null;this._status=null;this.widget=null;this._docManager=e}get status(){return this._status}get widget(){return this._widget}set widget(e){const t=this._widget;if(t!==null){const e=this._docManager.contextForWidget(t);if(e){e.saveState.disconnect(this._onStatusChange)}}this._widget=e;if(this._widget===null){this._status=null}else{const e=this._docManager.contextForWidget(this._widget);if(e){e.saveState.connect(this._onStatusChange)}}}}e.Model=t})(I||(I={}));function R(e){return m().createElement(A.TextItem,{source:e.name,title:e.fullPath})}class N extends i.VDomRenderer{constructor(e){super(new N.Model(e.docManager));this.node.title=this.model.path}render(){return m().createElement(R,{fullPath:this.model.path,name:this.model.name})}}(function(e){class t extends i.VDomModel{constructor(e){super();this._onTitleChange=e=>{const t=this._getAllState();this._name=e.label;this._triggerChange(t,this._getAllState())};this._onPathChange=(e,t)=>{const s=this._getAllState();this._path=t;this._name=n.PathExt.basename(t);this._triggerChange(s,this._getAllState())};this._path="";this._name="";this._widget=null;this._docManager=e}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(e){const t=this._widget;if(t!==null){const e=this._docManager.contextForWidget(t);if(e){e.pathChanged.disconnect(this._onPathChange)}else{t.title.changed.disconnect(this._onTitleChange)}}const s=this._getAllState();this._widget=e;if(this._widget===null){this._path="";this._name=""}else{const e=this._docManager.contextForWidget(this._widget);if(e){this._path=e.path;this._name=n.PathExt.basename(e.path);e.pathChanged.connect(this._onPathChange)}else{this._path="";this._name=this._widget.title.label;this._widget.title.changed.connect(this._onTitleChange)}}this._triggerChange(s,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(e,t){if(e[0]!==t[0]||e[1]!==t[1]){this.stateChanged.emit(void 0)}}}e.Model=t})(N||(N={}))}}]);
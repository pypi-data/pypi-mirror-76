(window["webpackJsonp_jupyterlab_application_top"]=window["webpackJsonp_jupyterlab_application_top"]||[]).push([[3469,7607],{wpYL:(t,e,i)=>{"use strict";i.r(e);i.d(e,{AddWidget:()=>n,TagTool:()=>h,TagWidget:()=>l});var s=i("aV2H");var a=i("Sxpi");class n extends s.Widget{constructor(){super();this.parent=null;this.input=document.createElement("input");this.addClass("tag");this.editing=false;this.buildTag()}buildTag(){const t=this.input||document.createElement("input");t.value="Add Tag";t.contentEditable="true";t.className="add-tag";t.style.width="49px";this.input=t;const e=document.createElement("div");e.className="tag-holder";e.appendChild(t);const i=a.addIcon.element({tag:"span",elementPosition:"center",height:"18px",width:"18px",marginLeft:"3px",marginRight:"-5px"});this.addClass("unapplied-tag");e.appendChild(i);this.node.appendChild(e)}onAfterAttach(){this.node.addEventListener("mousedown",this);this.input.addEventListener("keydown",this);this.input.addEventListener("focus",this);this.input.addEventListener("blur",this)}onBeforeDetach(){this.node.removeEventListener("mousedown",this);this.input.removeEventListener("keydown",this);this.input.removeEventListener("focus",this);this.input.removeEventListener("blur",this)}handleEvent(t){switch(t.type){case"mousedown":this._evtMouseDown(t);break;case"keydown":this._evtKeyDown(t);break;case"blur":this._evtBlur();break;case"focus":this._evtFocus();break;default:break}}_evtMouseDown(t){if(!this.editing){this.editing=true;this.input.value="";this.input.focus()}else if(t.target!==this.input){if(this.input.value!==""){const t=this.input.value;this.parent.addTag(t);this.input.blur();this._evtBlur()}}t.preventDefault()}_evtFocus(){if(!this.editing){this.input.blur()}}_evtKeyDown(t){const e=document.createElement("span");e.className="add-tag";e.innerHTML=this.input.value;document.body.appendChild(e);this.input.style.width=e.getBoundingClientRect().width+8+"px";document.body.removeChild(e);if(t.keyCode===13){const t=this.input.value;this.parent.addTag(t);this.input.blur();this._evtBlur()}}_evtBlur(){if(this.editing){this.editing=false;this.input.value="Add Tag";this.input.style.width="49px"}}}var d=i("3gBK");var o=i("QPP2");class l extends s.Widget{constructor(t){super();this.parent=null;this.applied=true;this.name=t;this.addClass("tag");this.buildTag()}buildTag(){const t=document.createElement("span");t.textContent=this.name;t.style.textOverflow="ellipsis";const e=document.createElement("div");e.className="tag-holder";e.appendChild(t);const i=a.checkIcon.element({tag:"span",elementPosition:"center",height:"18px",width:"18px",marginLeft:"5px",marginRight:"-3px"});if(this.applied){this.addClass("applied-tag")}else{this.addClass("unapplied-tag");i.style.display="none"}e.appendChild(i);this.node.appendChild(e)}onAfterAttach(){this.node.addEventListener("mousedown",this);this.node.addEventListener("mouseover",this);this.node.addEventListener("mouseout",this)}onBeforeDetach(){this.node.removeEventListener("mousedown",this);this.node.removeEventListener("mouseover",this);this.node.removeEventListener("mouseout",this)}handleEvent(t){switch(t.type){case"mousedown":this._evtClick();break;case"mouseover":this._evtMouseOver();break;case"mouseout":this._evtMouseOut();break;default:break}}onUpdateRequest(){var t;const e=(t=this.parent)===null||t===void 0?void 0:t.checkApplied(this.name);if(e!==this.applied){this.toggleApplied()}}toggleApplied(){var t,e;if(this.applied){this.removeClass("applied-tag");((t=this.node.firstChild)===null||t===void 0?void 0:t.lastChild).style.display="none";this.addClass("unapplied-tag")}else{this.removeClass("unapplied-tag");((e=this.node.firstChild)===null||e===void 0?void 0:e.lastChild).style.display="inline-block";this.addClass("applied-tag")}this.applied=!this.applied}_evtClick(){var t,e;if(this.applied){(t=this.parent)===null||t===void 0?void 0:t.removeTag(this.name)}else{(e=this.parent)===null||e===void 0?void 0:e.addTag(this.name)}this.toggleApplied()}_evtMouseOver(){this.node.classList.add("tag-hover")}_evtMouseOut(){this.node.classList.remove("tag-hover")}}class h extends o.NotebookTools.Tool{constructor(t,e){super();this.tagList=[];this.header=false;e;this.tracker=t;this.layout=new s.PanelLayout;this.createTagInput()}createTagInput(){const t=this.layout;const e=new n;e.id="add-tag";t.insertWidget(0,e)}checkApplied(t){var e;const i=(e=this.tracker)===null||e===void 0?void 0:e.activeCell;if(i){const e=i.model.metadata.get("tags");if(e){return e.includes(t)}}return false}addTag(t){var e;const i=(e=this.tracker)===null||e===void 0?void 0:e.activeCell;if(i){const e=i.model.metadata.get("tags")||[];let s=t.split(/[,\s]+/);s=s.filter(t=>t!==""&&!e.includes(t));i.model.metadata.set("tags",e.concat(s));this.refreshTags();this.loadActiveTags()}}removeTag(t){var e;const i=(e=this.tracker)===null||e===void 0?void 0:e.activeCell;if(i){const e=i.model.metadata.get("tags");let s=e.filter(e=>e!==t);i.model.metadata.set("tags",s);if(s.length===0){i.model.metadata.delete("tags")}this.refreshTags();this.loadActiveTags()}}loadActiveTags(){const t=this.layout;for(const e of t.widgets){e.update()}}pullTags(){var t,e;const i=(t=this.tracker)===null||t===void 0?void 0:t.currentWidget;const s=((e=i===null||i===void 0?void 0:i.model)===null||e===void 0?void 0:e.cells)||[];const a=(0,d.reduce)(s,(t,e)=>{const i=e.metadata.get("tags")||[];return[...t,...i]},[]);this.tagList=[...new Set(a)].filter(t=>t!=="")}refreshTags(){this.pullTags();const t=this.layout;const e=t.widgets.filter(t=>t.id!=="add-tag");e.forEach(t=>{if(!this.tagList.includes(t.name)){t.dispose()}});const i=e.map(t=>t.name);this.tagList.forEach(e=>{if(!i.includes(e)){const i=t.widgets.length-1;t.insertWidget(i,new l(e))}})}validateTags(t,e){e=e.filter(t=>typeof t==="string");e=(0,d.reduce)(e,(t,e)=>[...t,...e.split(/[,\s]+/)],[]);const i=[...new Set(e)].filter(t=>t!=="");t.model.metadata.set("tags",i);this.refreshTags();this.loadActiveTags()}onActiveCellChanged(){this.loadActiveTags()}onAfterShow(){this.refreshTags();this.loadActiveTags()}onAfterAttach(){if(!this.header){const t=document.createElement("header");t.textContent="Tags in Notebook";t.className="tag-header";this.parent.node.insertBefore(t,this.node);this.header=true}if(this.tracker.currentWidget){void this.tracker.currentWidget.context.ready.then(()=>{this.refreshTags();this.loadActiveTags()});this.tracker.currentWidget.model.cells.changed.connect(()=>{this.refreshTags();this.loadActiveTags()})}this.tracker.currentChanged.connect(()=>{this.refreshTags();this.loadActiveTags()})}onActiveCellMetadataChanged(){const t=this.tracker.activeCell.model.metadata.get("tags");let e=[];if(t===undefined){return}if(typeof t==="string"){e.push(t)}else{e=t}this.validateTags(this.tracker.activeCell,e)}}}}]);
(window["webpackJsonp_jupyterlab_application_top"]=window["webpackJsonp_jupyterlab_application_top"]||[]).push([[329],{XLpe:(t,e,s)=>{"use strict";s.r(e);s.d(e,{SettingEditor:()=>A,ISettingEditorTracker:()=>k});var i=s("Sxpi");var n=s("l37l");var r=s("aV2H");var o=s("yR1x");var a=s("QrjG");var d=s("V3w5");var c=s("s/A5");var h=s("zYbb");var l=s("H648");var u=s("JIWP");var g=s("W1TD");function p(t,e){const s=new _(t);const i=new u.InspectorPanel({initialContent:"Any errors will be listed here"});const n=new u.InspectionHandler({connector:s,rendermime:e||new g.RenderMimeRegistry({initialFactories:g.standardRendererFactories})});i.addClass("jp-SettingsDebug");i.source=n;n.editor=t.source;return i}class _ extends l.DataConnector{constructor(t){super();this._current=0;this._editor=t}fetch(t){return new Promise(e=>{const s=this._current=window.setTimeout(()=>{if(s!==this._current){return e(undefined)}const i=this._validate(t.text);if(!i){return e({data:{"text/markdown":"No errors found"},metadata:{}})}e({data:m.render(i),metadata:{}})},100)})}_validate(t){const e=this._editor;if(!e.settings){return null}const{id:s,schema:i,version:n}=e.settings;const r={composite:{},user:{}};const o=e.registry.validator;return o.validateData({data:r,id:s,raw:t,schema:i,version:n},false)}}var m;(function(t){function e(t){return{"text/markdown":t.map(s).join("")}}t.render=e;function s(t){var e;switch(t.keyword){case"additionalProperties":return`**\`[additional property error]\`**\n          \`${(e=t.params)===null||e===void 0?void 0:e.additionalProperty}\` is not a valid property`;case"syntax":return`**\`[syntax error]\`** *${t.message}*`;case"type":return`**\`[type error]\`**\n          \`${t.dataPath}\` ${t.message}`;default:return`**\`[error]\`** *${t.message}*`}}})(m||(m={}));class f extends r.SplitPanel{constructor(){super(...arguments);this.handleMoved=new c.Signal(this)}handleEvent(t){super.handleEvent(t);if(t.type==="mouseup"){this.handleMoved.emit(undefined)}}}const v="jp-SettingsRawEditor";const w="jp-SettingsRawEditor-user";const y="jp-mod-error";const S="System Defaults";const E="User Preferences";class C extends f{constructor(t){super({orientation:"horizontal",renderer:f.defaultRenderer,spacing:1});this._canRevert=false;this._canSave=false;this._commandsChanged=new c.Signal(this);this._settings=null;this._toolbar=new d.Toolbar;const{commands:e,editorFactory:s,registry:i}=t;this.registry=i;this._commands=e;const n=this._defaults=new h.CodeEditorWrapper({model:new h.CodeEditor.Model,factory:s});n.editor.model.value.text="";n.editor.model.mimeType="text/javascript";n.editor.setOption("readOnly",true);const r=this._user=new h.CodeEditorWrapper({model:new h.CodeEditor.Model,factory:s,config:{lineNumbers:true}});r.addClass(w);r.editor.model.mimeType="text/javascript";r.editor.model.value.changed.connect(this._onTextChanged,this);this._inspector=p(this,t.rendermime);this.addClass(v);this._onSaveError=t.onSaveError;this.addWidget(b.defaultsEditor(n));this.addWidget(b.userEditor(r,this._toolbar,this._inspector))}get canRevert(){return this._canRevert}get canSave(){return this._canSave}get commandsChanged(){return this._commandsChanged}get isDirty(){var t,e;return(e=this._user.editor.model.value.text!==((t=this._settings)===null||t===void 0?void 0:t.raw))!==null&&e!==void 0?e:""}get settings(){return this._settings}set settings(t){if(!t&&!this._settings){return}const e=t&&this._settings&&t.plugin===this._settings.plugin;if(e){return}const s=this._defaults;const i=this._user;if(this._settings){this._settings.changed.disconnect(this._onSettingsChanged,this)}if(t){this._settings=t;this._settings.changed.connect(this._onSettingsChanged,this);this._onSettingsChanged()}else{this._settings=null;s.editor.model.value.text="";i.editor.model.value.text=""}this.update()}get sizes(){return this.relativeSizes()}set sizes(t){this.setRelativeSizes(t)}get source(){return this._user.editor}dispose(){if(this.isDisposed){return}super.dispose();this._defaults.dispose();this._user.dispose()}revert(){var t,e;this._user.editor.model.value.text=(e=(t=this.settings)===null||t===void 0?void 0:t.raw)!==null&&e!==void 0?e:"";this._updateToolbar(false,false)}save(){if(!this.isDirty||!this._settings){return Promise.resolve(undefined)}const t=this._settings;const e=this._user.editor.model.value.text;return t.save(e).then(()=>{this._updateToolbar(false,false)}).catch(t=>{this._updateToolbar(true,false);this._onSaveError(t)})}onAfterAttach(t){b.populateToolbar(this._commands,this._toolbar);this.update()}onUpdateRequest(t){const e=this._settings;const s=this._defaults;const i=this._user;if(e){s.editor.refresh();i.editor.refresh()}}_onTextChanged(){const t=this._user.editor.model.value.text;const e=this._settings;this.removeClass(y);if(!e||e.raw===t){this._updateToolbar(false,false);return}const s=e.validate(t);if(s){this.addClass(y);this._updateToolbar(true,false);return}this._updateToolbar(true,true)}_onSettingsChanged(){var t,e;const s=this._settings;const i=this._defaults;const n=this._user;i.editor.model.value.text=(t=s===null||s===void 0?void 0:s.annotatedDefaults())!==null&&t!==void 0?t:"";n.editor.model.value.text=(e=s===null||s===void 0?void 0:s.raw)!==null&&e!==void 0?e:""}_updateToolbar(t=this._canRevert,e=this._canSave){const s=this._commands;this._canRevert=t;this._canSave=e;this._commandsChanged.emit([s.revert,s.save])}}var b;(function(t){function e(t){const e=new r.Widget;const s=e.layout=new r.BoxLayout({spacing:0});const i=new r.Widget;const n=new d.Toolbar;i.node.innerText=S;n.insertItem(0,"banner",i);s.addWidget(n);s.addWidget(t);return e}t.defaultsEditor=e;function s(t,e){const{registry:s,revert:i,save:n}=t;e.addItem("spacer",d.Toolbar.createSpacerItem());[i,n].forEach(t=>{const i=new d.CommandToolbarButton({commands:s,id:t});e.addItem(t,i)})}t.populateToolbar=s;function i(t,e,s){const i=new r.Widget;const n=i.layout=new r.BoxLayout({spacing:0});const o=new r.Widget;o.node.innerText=E;e.insertItem(0,"banner",o);n.addWidget(e);n.addWidget(t);n.addWidget(s);return i}t.userEditor=i})(b||(b={}));const x="jp-PluginEditor";class T extends r.Widget{constructor(t){super();this._settings=null;this._stateChanged=new c.Signal(this);this.addClass(x);const{commands:e,editorFactory:s,registry:i,rendermime:n}=t;const o=this.layout=new r.StackedLayout;const{onSaveError:a}=j;this.raw=this._rawEditor=new C({commands:e,editorFactory:s,onSaveError:a,registry:i,rendermime:n});this._rawEditor.handleMoved.connect(this._onStateChanged,this);o.addWidget(this._rawEditor)}get isDirty(){return this._rawEditor.isDirty}get settings(){return this._settings}set settings(t){if(this._settings===t){return}const e=this._rawEditor;this._settings=e.settings=t;this.update()}get state(){const t=this._settings?this._settings.id:"";const{sizes:e}=this._rawEditor;return{plugin:t,sizes:e}}set state(t){if(n.JSONExt.deepEqual(this.state,t)){return}this._rawEditor.sizes=t.sizes;this.update()}get stateChanged(){return this._stateChanged}confirm(){if(this.isHidden||!this.isAttached||!this.isDirty){return Promise.resolve(undefined)}return(0,d.showDialog)({title:"You have unsaved changes.",body:"Do you want to leave without saving?",buttons:[d.Dialog.cancelButton(),d.Dialog.okButton()]}).then(t=>{if(!t.button.accept){throw new Error("User canceled.")}})}dispose(){if(this.isDisposed){return}super.dispose();this._rawEditor.dispose()}onAfterAttach(t){this.update()}onUpdateRequest(t){const e=this._rawEditor;const s=this._settings;if(!s){this.hide();return}this.show();e.show()}_onStateChanged(){this.stateChanged.emit(undefined)}}var j;(function(t){function e(t){console.error(`Saving setting editor value failed: ${t.message}`);void(0,d.showDialog)({title:"Your changes were not saved.",body:t.message,buttons:[d.Dialog.okButton()]})}t.onSaveError=e})(j||(j={}));class z extends r.Widget{constructor(t){super();this._changed=new c.Signal(this);this._scrollTop=0;this._selection="";this.registry=t.registry;this.addClass("jp-PluginList");this._confirm=t.confirm;this.registry.pluginChanged.connect(()=>{this.update()},this)}get changed(){return this._changed}get scrollTop(){var t;return(t=this.node.querySelector("ul"))===null||t===void 0?void 0:t.scrollTop}get selection(){return this._selection}set selection(t){if(this._selection===t){return}this._selection=t;this.update()}handleEvent(t){switch(t.type){case"mousedown":this._evtMousedown(t);break;default:break}}onAfterAttach(t){this.node.addEventListener("mousedown",this);this.update()}onBeforeDetach(t){this.node.removeEventListener("mousedown",this)}onUpdateRequest(t){const{node:e,registry:s}=this;const i=this._selection;R.populateList(s,i,e);const n=e.querySelector("ul");if(n&&this._scrollTop!==undefined){n.scrollTop=this._scrollTop}}_evtMousedown(t){t.preventDefault();let e=t.target;let s=e.getAttribute("data-id");if(s===this._selection){return}if(!s){while(!s&&e!==this.node){e=e.parentElement;s=e.getAttribute("data-id")}}if(!s){return}this._confirm().then(()=>{this._scrollTop=this.scrollTop;this._selection=s;this._changed.emit(undefined);this.update()}).catch(()=>{})}}var R;(function(t){const e="jupyter.lab.setting-icon";const s="jupyter.lab.setting-icon-class";const n="jupyter.lab.setting-icon-label";function r(t,e,s){let i=s.data.user[t];if(!i){i=s.data.composite[t]}if(!i){i=s.schema[t]}if(!i){const{properties:s}=e.schema;i=s&&s[t]&&s[t].default}return typeof i==="string"?i:""}function d(t,d,h){const l=c(t).filter(t=>{const{schema:e}=t;const s=e["jupyter.lab.setting-deprecated"]===true;const i=Object.keys(e.properties||{}).length>0;const n=e.additionalProperties!==false;return!s&&(i||n)});const u=l.map(a=>{const{id:c,schema:h,version:l}=a;const u=`${h.description}\n${c}\n${l}`;const g=r(e,t,a);const p=r(s,t,a);const _=r(n,t,a);return o.createElement("li",{className:c===d?"jp-mod-selected":"","data-id":c,key:c,title:u},o.createElement(i.LabIcon.resolveReact,{icon:g||(p?undefined:i.settingsIcon),iconClass:(0,i.classes)(p,"jp-Icon"),title:_,tag:"span",stylesheet:"settingsEditor"}),o.createElement("span",null,h.title||c))});a.unmountComponentAtNode(h);a.render(o.createElement("ul",null,u),h)}t.populateList=d;function c(t){return Object.keys(t.plugins).map(e=>t.plugins[e]).sort((t,e)=>(t.schema.title||t.id).localeCompare(e.schema.title||e.id))}})(R||(R={}));const W={sizes:[1,3],container:{editor:"raw",plugin:"",sizes:[1,1]}};class A extends r.Widget{constructor(t){super();this._fetching=null;this._saving=false;this._state=n.JSONExt.deepCopy(W);this.addClass("jp-SettingEditor");this.key=t.key;this.state=t.state;const{commands:e,editorFactory:s,rendermime:i}=t;const o=this.layout=new r.PanelLayout;const a=this.registry=t.registry;const d=this._panel=new f({orientation:"horizontal",renderer:f.defaultRenderer,spacing:1});const c=this._instructions=new r.Widget;const h=this._editor=new T({commands:e,editorFactory:s,registry:a,rendermime:i});const l=()=>h.confirm();const u=this._list=new z({confirm:l,registry:a});const g=t.when;c.addClass("jp-SettingEditorInstructions");D.populateInstructionsNode(c.node);if(g){this._when=Array.isArray(g)?Promise.all(g):g}d.addClass("jp-SettingEditor-main");o.addWidget(d);d.addWidget(u);d.addWidget(c);f.setStretch(u,0);f.setStretch(c,1);f.setStretch(h,1);h.stateChanged.connect(this._onStateChanged,this);u.changed.connect(this._onStateChanged,this);d.handleMoved.connect(this._onStateChanged,this)}get canRevertRaw(){return this._editor.raw.canRevert}get canSaveRaw(){return this._editor.raw.canSave}get commandsChanged(){return this._editor.raw.commandsChanged}get settings(){return this._editor.settings}get source(){return this._editor.raw.source}dispose(){if(this.isDisposed){return}super.dispose();this._editor.dispose();this._instructions.dispose();this._list.dispose();this._panel.dispose()}revert(){this._editor.raw.revert()}save(){return this._editor.raw.save()}onAfterAttach(t){super.onAfterAttach(t);this._panel.hide();this._fetchState().then(()=>{this._panel.show();this._setState()}).catch(t=>{console.error("Fetching setting editor state failed",t);this._panel.show();this._setState()})}onCloseRequest(t){this._editor.confirm().then(()=>{super.onCloseRequest(t);this.dispose()}).catch(()=>{})}_fetchState(){if(this._fetching){return this._fetching}const{key:t,state:e}=this;const s=[e.fetch(t),this._when];return this._fetching=Promise.all(s).then(([t])=>{this._fetching=null;if(this._saving){return}this._state=D.normalizeState(t,this._state)})}async _onStateChanged(){this._state.sizes=this._panel.relativeSizes();this._state.container=this._editor.state;this._state.container.plugin=this._list.selection;try{await this._saveState()}catch(t){console.error("Saving setting editor state failed",t)}this._setState()}async _saveState(){const{key:t,state:e}=this;const s=this._state;this._saving=true;try{await e.save(t,s);this._saving=false}catch(i){this._saving=false;throw i}}_setLayout(){const t=this._editor;const e=this._panel;const s=this._state;t.state=s.container;requestAnimationFrame(()=>{e.setRelativeSizes(s.sizes)})}_setState(){const t=this._editor;const e=this._list;const s=this._panel;const{container:i}=this._state;if(!i.plugin){t.settings=null;e.selection="";this._setLayout();return}if(t.settings&&t.settings.id===i.plugin){this._setLayout();return}const n=this._instructions;this.registry.load(i.plugin).then(r=>{if(n.isAttached){n.parent=null}if(!t.isAttached){s.addWidget(t)}t.settings=r;e.selection=i.plugin;this._setLayout()}).catch(s=>{console.error(`Loading ${i.plugin} settings failed.`,s);e.selection=this._state.container.plugin="";t.settings=null;this._setLayout()})}}var D;(function(t){function e(t){a.render(o.createElement(o.Fragment,null,o.createElement("h2",null,o.createElement(i.jupyterIcon.react,{className:"jp-SettingEditorInstructions-icon",tag:"span",elementPosition:"center",height:"auto",width:"60px"}),o.createElement("span",{className:"jp-SettingEditorInstructions-title"},"Settings")),o.createElement("span",{className:"jp-SettingEditorInstructions-text"},"Select a plugin from the list to view and edit its preferences.")),t)}t.populateInstructionsNode=e;function s(t,e){if(!t){return n.JSONExt.deepCopy(W)}if(!("sizes"in t)||!r(t.sizes)){t.sizes=n.JSONExt.deepCopy(W.sizes)}if(!("container"in t)){t.container=n.JSONExt.deepCopy(W.container);return t}const s="container"in t&&t.container&&typeof t.container==="object"?t.container:{};t.container={plugin:typeof s.plugin==="string"?s.plugin:W.container.plugin,sizes:r(s.sizes)?s.sizes:n.JSONExt.deepCopy(W.container.sizes)};return t}t.normalizeState=s;function r(t){return Array.isArray(t)&&t.every(t=>typeof t==="number")}})(D||(D={}));const k=new n.Token("@jupyterlab/settingeditor:ISettingEditorTracker")}}]);
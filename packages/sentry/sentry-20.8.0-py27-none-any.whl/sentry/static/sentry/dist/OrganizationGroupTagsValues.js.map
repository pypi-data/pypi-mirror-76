{"version":3,"sources":["webpack:///./app/components/deviceName.tsx","webpack:///./app/components/dataExport.tsx","webpack:///./app/views/organizationGroupDetails/groupTagValues.tsx"],"names":["deviceNameMapper","model","iOSDeviceList","modelIdentifier","split","modelId","splice","join","modelName","generationByIdentifier","undefined","loadDeviceListModule","a","DeviceName","props","_isMounted","state","this","then","setState","value","children","deviceName","data-test-id","React","Component","ExportQueryType","DataExport","initialState","resetState","startDataExport","api","slug","organization","payload","queryType","queryInfo","inProgress","requestPromise","includeAllArgs","method","data","query_type","query_info","response","addSuccessMessage","status","t","err","message","responseJSON","detail","addErrorMessage","prevPayload","isEqual","disabled","icon","features","NewButton","size","priority","title","onClick","debounce","buttonProps","type","noTooltip","withApi","withOrganization","GroupTagValues","environment","environments","params","groupId","tagKey","query","group","orgId","tag","tagValueList","tagValueListPageLinks","sortedTagValueList","sortBy","property","reverse","length","heading","issuesPath","map","tagValue","tagValueIdx","pct","totalValues","percent","count","toFixed","key","className","ValueWrapper","to","pathname","user","avatarSize","hideEmail","name","email","StyledExternalLink","href","color","isUrl","date","lastSeen","Fragment","Header","HeaderTitle","HeaderButtons","gap","BrowserExportButton","project","id","IssuesByTag","TableHeader","width","pageLinks","AsyncComponent","ButtonBar","space","Button","p","ExternalLink"],"mappings":"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","file":"OrganizationGroupTagsValues.js","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\n\nimport {IOSDeviceList} from 'app/types/iOSDeviceList';\n\nexport function deviceNameMapper(model: string, iOSDeviceList): string {\n  const modelIdentifier = model.split(' ')[0];\n  const modelId = model\n    .split(' ')\n    .splice(1)\n    .join(' ');\n  const modelName = iOSDeviceList.generationByIdentifier(modelIdentifier);\n  return modelName === undefined ? model : modelName + ' ' + modelId;\n}\n\nexport async function loadDeviceListModule() {\n  return import(/* webpackChunkName: \"iOSDeviceList\" */ 'ios-device-list');\n}\n\ntype Props = {\n  value: string;\n  children?: (name: string) => React.ReactNode;\n};\n\ntype State = {\n  iOSDeviceList: IOSDeviceList | null;\n};\n/**\n * This is used to map iOS Device Names to model name.\n * This asynchronously loads the ios-device-list library because of its size\n */\nexport default class DeviceName extends React.Component<Props, State> {\n  static propTypes = {\n    value: PropTypes.string,\n    children: PropTypes.func,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      iOSDeviceList: null,\n    };\n  }\n\n  componentDidMount() {\n    // This is to handle react's warning on calling setState for unmounted components\n    // Since we can't cancel promises, we need to do this\n    this._isMounted = true;\n\n    // This library is very big, so we are codesplitting it based on size and\n    // the relatively small utility this library provides\n    loadDeviceListModule().then(iOSDeviceList => {\n      if (!this._isMounted) {\n        return;\n      }\n\n      this.setState({iOSDeviceList});\n    });\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  private _isMounted?: boolean;\n\n  render() {\n    const {value, children} = this.props;\n    const {iOSDeviceList} = this.state;\n\n    // value can be undefined, need to return null or else react throws\n    if (!value) {\n      return null;\n    }\n\n    // If library has not loaded yet, then just render the raw model string, better than empty\n    if (!iOSDeviceList) {\n      return value;\n    }\n\n    const deviceName = deviceNameMapper(value, iOSDeviceList);\n\n    return (\n      <span data-test-id=\"loaded-device-name\">\n        {children ? children(deviceName) : deviceName}\n      </span>\n    );\n  }\n}\n","import debounce from 'lodash/debounce';\nimport isEqual from 'lodash/isEqual';\nimport React from 'react';\n\nimport {Client} from 'app/api';\nimport {addErrorMessage, addSuccessMessage} from 'app/actionCreators/indicator';\nimport Feature from 'app/components/acl/feature';\nimport Button from 'app/components/button';\nimport {t} from 'app/locale';\nimport {Organization} from 'app/types';\nimport withApi from 'app/utils/withApi';\nimport FeatureBadge from 'app/components/featureBadge';\nimport withOrganization from 'app/utils/withOrganization';\n\n//! Coordinate with other ExportQueryType (src/sentry/data_export/base.py)\nexport enum ExportQueryType {\n  IssuesByTag = 'Issues-by-Tag',\n  Discover = 'Discover',\n}\n\ntype DataExportPayload = {\n  queryType: ExportQueryType;\n  queryInfo: any; // TODO(ts): Formalize different possible payloads\n};\n\ntype Props = {\n  api: Client;\n  disabled?: boolean;\n  organization: Organization;\n  payload: DataExportPayload;\n  icon?: React.ReactNode;\n};\n\ntype State = {\n  inProgress: boolean;\n};\n\nclass DataExport extends React.Component<Props, State> {\n  state = this.initialState;\n\n  componentDidUpdate({payload: prevPayload}) {\n    const {payload} = this.props;\n    if (!isEqual(prevPayload, payload)) this.resetState();\n  }\n\n  get initialState() {\n    return {\n      inProgress: false,\n    };\n  }\n\n  resetState = () => {\n    this.setState(this.initialState);\n  };\n\n  startDataExport = () => {\n    const {\n      api,\n      organization: {slug},\n      payload: {queryType, queryInfo},\n    } = this.props;\n\n    this.setState({inProgress: true});\n\n    api\n      .requestPromise(`/organizations/${slug}/data-export/`, {\n        includeAllArgs: true,\n        method: 'POST',\n        data: {\n          query_type: queryType,\n          query_info: queryInfo,\n        },\n      })\n      .then(([_data, _, response]) => {\n        addSuccessMessage(\n          response?.status === 201\n            ? t(\n                \"Sit tight. We'll shoot you an email when your data is ready for download.\"\n              )\n            : t(\"It looks like we're already working on it. Sit tight, we'll email you.\")\n        );\n      })\n      .catch(err => {\n        const message =\n          err?.responseJSON?.detail ??\n          \"We tried our hardest, but we couldn't export your data. Give it another go.\";\n        addErrorMessage(t(message));\n        this.setState({inProgress: false});\n      });\n  };\n\n  render() {\n    const {inProgress} = this.state;\n    const {children, disabled, icon} = this.props;\n    return (\n      <Feature features={['organizations:discover-query']}>\n        {inProgress ? (\n          <NewButton\n            size=\"small\"\n            priority=\"default\"\n            title=\"You can get on with your life. We'll email you when your data's ready.\"\n            {...this.props}\n            disabled\n            icon={icon}\n          >\n            {t(\"We're working on it...\")}\n          </NewButton>\n        ) : (\n          <NewButton\n            onClick={debounce(this.startDataExport, 500)}\n            disabled={disabled || false}\n            size=\"small\"\n            priority=\"default\"\n            title=\"Put your data to work. Start your export and we'll email you when it's finished.\"\n            icon={icon}\n            {...this.props}\n          >\n            {children ? children : t('Export All to CSV')}\n          </NewButton>\n        )}\n      </Feature>\n    );\n  }\n}\n\nconst NewButton = ({children, ...buttonProps}) => (\n  <Button {...buttonProps}>\n    {children}\n    <FeatureBadge type=\"new\" noTooltip />\n  </Button>\n);\n\nexport {DataExport};\nexport default withApi(withOrganization(DataExport));\n","import sortBy from 'lodash/sortBy';\nimport property from 'lodash/property';\nimport React from 'react';\nimport {RouteComponentProps} from 'react-router/lib/Router';\nimport styled from '@emotion/styled';\n\nimport {isUrl, percent} from 'app/utils';\nimport {t} from 'app/locale';\nimport AsyncComponent from 'app/components/asyncComponent';\nimport UserBadge from 'app/components/idBadge/userBadge';\nimport Button from 'app/components/button';\nimport ButtonBar from 'app/components/buttonBar';\nimport DeviceName from 'app/components/deviceName';\nimport ExternalLink from 'app/components/links/externalLink';\nimport GlobalSelectionLink from 'app/components/globalSelectionLink';\nimport {IconMail, IconOpen} from 'app/icons';\nimport DetailedError from 'app/components/errors/detailedError';\nimport Pagination from 'app/components/pagination';\nimport TimeSince from 'app/components/timeSince';\nimport DataExport, {ExportQueryType} from 'app/components/dataExport';\nimport space from 'app/styles/space';\nimport {Group, Tag, TagValue, Environment} from 'app/types';\n\ntype RouteParams = {\n  groupId: string;\n  orgId: string;\n  tagKey: string;\n};\n\ntype Props = {\n  group: Group;\n  environments: Environment[];\n} & RouteComponentProps<RouteParams, {}>;\n\ntype State = {\n  tag: Tag;\n  tagValueList: TagValue[];\n  tagValueListPageLinks: string;\n};\n\nclass GroupTagValues extends AsyncComponent<\n  Props & AsyncComponent['props'],\n  State & AsyncComponent['state']\n> {\n  getEndpoints(): [string, string, any?][] {\n    const {environments: environment} = this.props;\n    const {groupId, tagKey} = this.props.params;\n    return [\n      ['tag', `/issues/${groupId}/tags/${tagKey}/`],\n      [\n        'tagValueList',\n        `/issues/${groupId}/tags/${tagKey}/values/`,\n        {query: {environment}},\n      ],\n    ];\n  }\n\n  renderBody() {\n    const {\n      group,\n      params: {orgId, tagKey},\n      environments,\n    } = this.props;\n    const {tag, tagValueList, tagValueListPageLinks} = this.state;\n    const sortedTagValueList: TagValue[] = sortBy(\n      tagValueList,\n      property('count')\n    ).reverse();\n\n    if (sortedTagValueList.length === 0 && environments.length > 0) {\n      return (\n        <DetailedError\n          heading={t('Sorry, the tags for this issue could not be found.')}\n          message={t('No tags were found for the currently selected environments')}\n        />\n      );\n    }\n\n    const issuesPath = `/organizations/${orgId}/issues/`;\n\n    const children = sortedTagValueList.map((tagValue, tagValueIdx) => {\n      const pct = tag.totalValues\n        ? `${percent(tagValue.count, tag.totalValues).toFixed(2)}%`\n        : '--';\n      const query = tagValue.query || `${tag.key}:\"${tagValue.value}\"`;\n      return (\n        <tr key={tagValueIdx}>\n          <td className=\"bar-cell\">\n            <span className=\"label\">{pct}</span>\n          </td>\n          <td>\n            <ValueWrapper>\n              <GlobalSelectionLink\n                to={{\n                  pathname: issuesPath,\n                  query: {query},\n                }}\n              >\n                {tag.key === 'user' ? (\n                  <UserBadge user={tagValue} avatarSize={20} hideEmail />\n                ) : (\n                  <DeviceName value={tagValue.name} />\n                )}\n              </GlobalSelectionLink>\n              {tagValue.email && (\n                <StyledExternalLink href={`mailto:${tagValue.email}`}>\n                  <IconMail size=\"xs\" color=\"gray500\" />\n                </StyledExternalLink>\n              )}\n              {isUrl(tagValue.value) && (\n                <StyledExternalLink href={tagValue.value}>\n                  <IconOpen size=\"xs\" color=\"gray500\" />\n                </StyledExternalLink>\n              )}\n            </ValueWrapper>\n          </td>\n          <td>\n            <TimeSince date={tagValue.lastSeen} />\n          </td>\n        </tr>\n      );\n    });\n\n    return (\n      <React.Fragment>\n        <Header>\n          <HeaderTitle>{tag.key === 'user' ? t('Affected Users') : tag.name}</HeaderTitle>\n          <HeaderButtons gap={1}>\n            <BrowserExportButton\n              size=\"small\"\n              priority=\"default\"\n              href={`/${orgId}/${group.project.slug}/issues/${group.id}/tags/${tagKey}/export/`}\n            >\n              {t('Export Page to CSV')}\n            </BrowserExportButton>\n            <DataExport\n              payload={{\n                queryType: ExportQueryType.IssuesByTag,\n                queryInfo: {\n                  project: group.project.id,\n                  group: group.id,\n                  key: tagKey,\n                },\n              }}\n            />\n          </HeaderButtons>\n        </Header>\n        <table className=\"table table-striped\">\n          <thead>\n            <tr>\n              <TableHeader width={20}>%</TableHeader>\n              <th />\n              <TableHeader width={300}>{t('Last Seen')}</TableHeader>\n            </tr>\n          </thead>\n          <tbody>{children}</tbody>\n        </table>\n        <Pagination pageLinks={tagValueListPageLinks} />\n        <p>\n          <small>\n            {t('Note: Percentage of issue is based on events seen in the last 7 days.')}\n          </small>\n        </p>\n      </React.Fragment>\n    );\n  }\n}\nconst Header = styled('div')`\n  display: flex;\n  align-items: center;\n  margin: 0 0 20px;\n`;\n\nconst HeaderTitle = styled('h3')`\n  margin: 0;\n`;\n\nconst HeaderButtons = styled(ButtonBar)`\n  align-items: stretch;\n  margin: 0px ${space(1.5)};\n`;\n\nconst BrowserExportButton = styled(Button)`\n  display: flex;\n  align-items: center;\n`;\n\nconst TableHeader = styled('th')<{width: number}>`\n  width: ${p => p.width}px;\n`;\nconst ValueWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n`;\nconst StyledExternalLink = styled(ExternalLink)`\n  margin-left: ${space(0.5)};\n`;\n\nexport {GroupTagValues};\nexport default GroupTagValues;\n"],"sourceRoot":""}
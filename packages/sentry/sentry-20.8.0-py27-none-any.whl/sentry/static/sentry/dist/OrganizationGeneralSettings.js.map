{"version":3,"sources":["webpack:///./app/components/sentryDocumentTitle.tsx","webpack:///./app/components/links/linkWithConfirmation.tsx","webpack:///./app/utils/slugify.tsx","webpack:///./app/views/settings/organization/permissionAlert.tsx","webpack:///./app/data/forms/organizationGeneralSettings.tsx","webpack:///./app/views/settings/organizationGeneralSettings/organizationSettingsForm.tsx","webpack:///./app/views/settings/organizationGeneralSettings/index.tsx"],"names":["SentryDocumentTitle","props","_title","title","objSlug","children","LinkWithConfirmation","this","className","disabled","otherProps","href","classNames","React","PureComponent","slugify","str","toLowerCase","replace","PermissionAlert","access","hasAccess","type","icon","size","t","formGroups","fields","name","required","label","help","transformInput","saveOnBlur","saveMessageAlertType","saveMessage","choices","initialData","availableRoles","map","r","id","has","visible","features","OrganizationSettingsForm","organization","slug","onSave","authProvider","state","endpoint","jsonFormSettings","additionalFieldProps","hasSsoEnabled","Set","location","data-test-id","apiMethod","apiEndpoint","allowUndo","onSubmitSuccess","_resp","model","onSubmitError","addErrorMessage","forms","organizationSettingsFields","description","to","allowGravatar","updateOrganization","AsyncComponent","withOrganization","OrganizationGeneralSettings","handleRemoveOrganization","api","params","addLoadingMessage","removeAndRedirectToRemainingOrganization","orgId","successMessage","errorMessage","handleSave","prevData","data","changeOrganizationSlug","browserHistory","hasProjects","projects","length","Fragment","isDefault","priority","message","tct","noMargin","project","key","onConfirm","Component","withApi"],"mappings":"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","file":"OrganizationGeneralSettings.js","sourcesContent":["import React, {FunctionComponent} from 'react';\nimport DocumentTitle from 'react-document-title';\n\ntype DocumentTitleProps = {\n  // Main page title\n  title: string;\n  // Organization or project slug to give title some context\n  objSlug: string;\n  children?: React.ReactNode;\n};\n\nconst SentryDocumentTitle: FunctionComponent<DocumentTitleProps> = (\n  props: DocumentTitleProps\n) => {\n  const _title = `${props.title} - ${props.objSlug} - Sentry`;\n  return <DocumentTitle title={_title}>{props.children}</DocumentTitle>;\n};\n\nexport default SentryDocumentTitle;\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport Button from 'app/components/button';\nimport Confirm from 'app/components/confirm';\n\ntype Props = {\n  message: React.ReactNode;\n  title: string;\n  onConfirm: () => void;\n  disabled?: boolean;\n  className?: string;\n  priority?: React.ComponentProps<typeof Button>['priority'];\n};\n\n/**\n * <Confirm> is a more generic version of this component\n */\nclass LinkWithConfirmation extends React.PureComponent<Props> {\n  render() {\n    const {className, disabled, title, children, ...otherProps} = this.props;\n    return (\n      <Confirm {...otherProps} disabled={disabled}>\n        <a href=\"#\" className={classNames(className || '', {disabled})} title={title}>\n          {children}\n        </a>\n      </Confirm>\n    );\n  }\n}\n\nexport default LinkWithConfirmation;\n","// XXX: This is NOT an exhaustive slugify function\n// Only forces lowercase and replaces spaces with hyphens\nexport default function slugify(str: any): string {\n  return typeof str === 'string' ? str.toLowerCase().replace(' ', '-') : '';\n}\n","import PropTypes from 'prop-types';\nimport React from 'react';\n\nimport {t} from 'app/locale';\nimport Access from 'app/components/acl/access';\nimport Alert from 'app/components/alert';\nimport {IconWarning} from 'app/icons';\n\ntype Props = React.ComponentPropsWithoutRef<typeof Alert> &\n  Pick<React.ComponentProps<typeof Access>, 'access'>;\n\nconst PermissionAlert = ({access = ['org:write'], ...props}: Props) => (\n  <Access access={access}>\n    {({hasAccess}) =>\n      !hasAccess && (\n        <Alert type=\"warning\" icon={<IconWarning size=\"sm\" />} {...props}>\n          {t(\n            'These settings can only be edited by users with the organization owner or manager role.'\n          )}\n        </Alert>\n      )\n    }\n  </Access>\n);\n\nPermissionAlert.propTypes = {\n  access: PropTypes.arrayOf(PropTypes.string),\n};\n\nexport default PermissionAlert;\n","import {t} from 'app/locale';\nimport slugify from 'app/utils/slugify';\nimport {JsonFormObject} from 'app/views/settings/components/forms/type';\nimport {MemberRole} from 'app/types';\n\n// Export route to make these forms searchable by label/help\nexport const route = '/settings/:orgId/';\n\nconst formGroups: JsonFormObject[] = [\n  {\n    // Form \"section\"/\"panel\"\n    title: t('General'),\n    fields: [\n      {\n        name: 'slug',\n        type: 'string',\n        required: true,\n        label: t('Name'),\n        help: t('A unique ID used to identify this organization'),\n        transformInput: slugify,\n\n        saveOnBlur: false,\n        saveMessageAlertType: 'info',\n        saveMessage: t(\n          'You will be redirected to the new organization slug after saving'\n        ),\n      },\n      {\n        name: 'name',\n        type: 'string',\n        required: true,\n\n        label: t('Display Name'),\n        help: t('This is the name that users will see for the organization'),\n      },\n      {\n        name: 'isEarlyAdopter',\n        type: 'boolean',\n        label: t('Early Adopter'),\n        help: t(\"Opt-in to new features before they're released to the public\"),\n      },\n    ],\n  },\n\n  {\n    title: 'Membership',\n    fields: [\n      {\n        name: 'defaultRole',\n        type: 'array',\n        required: true,\n        label: t('Default Role'),\n        // seems weird to have choices in initial form data\n        choices: ({initialData} = {}) =>\n          initialData?.availableRoles?.map((r: MemberRole) => [r.id, r.name]) ?? [],\n        help: t('The default role new members will receive'),\n        disabled: ({access}) => !access.has('org:admin'),\n      },\n      {\n        name: 'openMembership',\n        type: 'boolean',\n        required: true,\n        label: t('Open Membership'),\n        help: t('Allow organization members to freely join or leave any team'),\n      },\n      {\n        name: 'eventsMemberAdmin',\n        type: 'boolean',\n        label: t('Grant Members Events Admin'),\n        help: t(\n          'Allow members to delete events (including the delete & discard action) by granting them the `event:admin` scope.'\n        ),\n      },\n      {\n        name: 'attachmentsRole',\n        type: 'array',\n        choices: ({initialData = {}}) =>\n          initialData?.availableRoles?.map((r: MemberRole) => [r.id, r.name]) ?? [],\n        label: t('Attachments Access'),\n        help: t(\n          'Permissions required to download event attachments, such as native crash reports or log files.'\n        ),\n        visible: ({features}) => features.has('event-attachments'),\n      },\n    ],\n  },\n];\n\nexport default formGroups;\n","import {RouteComponentProps} from 'react-router/lib/Router';\nimport {Location} from 'history';\nimport React from 'react';\n\nimport {addErrorMessage} from 'app/actionCreators/indicator';\nimport {updateOrganization} from 'app/actionCreators/organizations';\nimport AsyncComponent from 'app/components/asyncComponent';\nimport AvatarChooser from 'app/components/avatarChooser';\nimport Form from 'app/views/settings/components/forms/form';\nimport JsonForm from 'app/views/settings/components/forms/jsonForm';\nimport organizationSettingsFields from 'app/data/forms/organizationGeneralSettings';\nimport withOrganization from 'app/utils/withOrganization';\nimport Link from 'app/components/links/link';\nimport EmptyMessage from 'app/views/settings/components/emptyMessage';\nimport {t} from 'app/locale';\nimport {Panel, PanelHeader} from 'app/components/panels';\nimport {Organization, Scope} from 'app/types';\n\ntype Props = {\n  location: Location;\n  organization: Organization;\n  access: Set<Scope>;\n  initialData: Organization;\n  onSave: (previous: Organization, updated: Record<string, any>) => void;\n} & RouteComponentProps<{orgId: string}, {}>;\n\ntype State = AsyncComponent['state'] & {\n  authProvider: object;\n};\n\nclass OrganizationSettingsForm extends AsyncComponent<Props, State> {\n  getEndpoints(): Array<[string, string]> {\n    const {organization} = this.props;\n    return [['authProvider', `/organizations/${organization.slug}/auth-provider/`]];\n  }\n\n  render() {\n    const {initialData, organization, onSave, access} = this.props;\n    const {authProvider} = this.state;\n    const endpoint = `/organizations/${organization.slug}/`;\n\n    const jsonFormSettings = {\n      additionalFieldProps: {hasSsoEnabled: !!authProvider},\n      features: new Set(organization.features),\n      access,\n      location: this.props.location,\n      disabled: !access.has('org:write'),\n    };\n\n    return (\n      <Form\n        data-test-id=\"organization-settings\"\n        apiMethod=\"PUT\"\n        apiEndpoint={endpoint}\n        saveOnBlur\n        allowUndo\n        initialData={initialData}\n        onSubmitSuccess={(_resp, model) => {\n          // Special case for slug, need to forward to new slug\n          if (typeof onSave === 'function') {\n            onSave(initialData, model.initialData);\n          }\n        }}\n        onSubmitError={() => addErrorMessage('Unable to save change')}\n      >\n        <JsonForm {...jsonFormSettings} forms={organizationSettingsFields} />\n\n        <Panel>\n          <PanelHeader>{t('Security & Privacy')}</PanelHeader>\n          <EmptyMessage\n            title={t('Security & Privacy has moved')}\n            description={\n              <Link to={`/settings/${organization.slug}/security-and-privacy/`}>\n                {t('Go to Security & Privacy')}\n              </Link>\n            }\n          />\n        </Panel>\n\n        <AvatarChooser\n          type=\"organization\"\n          allowGravatar={false}\n          endpoint={`${endpoint}avatar/`}\n          model={initialData}\n          onSave={updateOrganization}\n          disabled={!access.has('org:write')}\n        />\n      </Form>\n    );\n  }\n}\n\nexport default withOrganization(OrganizationSettingsForm);\n","import {RouteComponentProps} from 'react-router/lib/Router';\nimport {browserHistory} from 'react-router';\nimport React from 'react';\n\nimport {Client} from 'app/api';\nimport {Organization} from 'app/types';\nimport {Panel, PanelHeader} from 'app/components/panels';\nimport {addLoadingMessage} from 'app/actionCreators/indicator';\nimport {\n  changeOrganizationSlug,\n  removeAndRedirectToRemainingOrganization,\n  updateOrganization,\n} from 'app/actionCreators/organizations';\nimport {t, tct} from 'app/locale';\nimport Field from 'app/views/settings/components/forms/field';\nimport LinkWithConfirmation from 'app/components/links/linkWithConfirmation';\nimport PermissionAlert from 'app/views/settings/organization/permissionAlert';\nimport SentryDocumentTitle from 'app/components/sentryDocumentTitle';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport TextBlock from 'app/views/settings/components/text/textBlock';\nimport withApi from 'app/utils/withApi';\nimport withOrganization from 'app/utils/withOrganization';\n\nimport OrganizationSettingsForm from './organizationSettingsForm';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n} & RouteComponentProps<{orgId: string}, {}>;\n\nclass OrganizationGeneralSettings extends React.Component<Props> {\n  handleRemoveOrganization = () => {\n    const {api, organization, params} = this.props;\n    if (!organization) {\n      return;\n    }\n\n    addLoadingMessage();\n    removeAndRedirectToRemainingOrganization(api, {\n      orgId: params.orgId,\n      successMessage: `${organization.name} is queued for deletion.`,\n      errorMessage: `Error removing the ${organization.name} organization`,\n    });\n  };\n\n  handleSave = (prevData: Organization, data: Record<string, any>) => {\n    if (data.slug && data.slug !== prevData.slug) {\n      changeOrganizationSlug(prevData, data);\n      browserHistory.replace(`/settings/${data.slug}/`);\n    } else {\n      // This will update OrganizationStore (as well as OrganizationsStore\n      // which is slightly incorrect because it has summaries vs a detailed org)\n      updateOrganization(data);\n    }\n  };\n\n  render() {\n    const {organization, params} = this.props;\n    const {orgId} = params;\n    const access = new Set(organization.access);\n    const hasProjects = organization.projects && !!organization.projects.length;\n\n    return (\n      <React.Fragment>\n        <SentryDocumentTitle title={t('General Settings')} objSlug={orgId} />\n        <div>\n          <SettingsPageHeader title={t('Organization Settings')} />\n          <PermissionAlert />\n\n          <OrganizationSettingsForm\n            {...this.props}\n            initialData={organization}\n            access={access}\n            onSave={this.handleSave}\n          />\n\n          {access.has('org:admin') && !organization.isDefault && (\n            <Panel>\n              <PanelHeader>{t('Remove Organization')}</PanelHeader>\n              <Field\n                label={t('Remove Organization')}\n                help={t(\n                  'Removing this organization will delete all data including projects and their associated events.'\n                )}\n              >\n                <div>\n                  <LinkWithConfirmation\n                    className=\"btn btn-danger\"\n                    priority=\"danger\"\n                    title={t('Remove %s organization', organization && organization.name)}\n                    message={\n                      <div>\n                        <TextBlock>\n                          {tct(\n                            'Removing the organization, [name] is permanent and cannot be undone! Are you sure you want to continue?',\n                            {\n                              name: organization && <strong>{organization.name}</strong>,\n                            }\n                          )}\n                        </TextBlock>\n\n                        {hasProjects && (\n                          <div>\n                            <TextBlock noMargin>\n                              {t(\n                                'This will also remove the following associated projects:'\n                              )}\n                            </TextBlock>\n                            <ul className=\"ref-projects\">\n                              {organization.projects.map(project => (\n                                <li key={project.slug}>{project.slug}</li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n                      </div>\n                    }\n                    onConfirm={this.handleRemoveOrganization}\n                  >\n                    {t('Remove Organization')}\n                  </LinkWithConfirmation>\n                </div>\n              </Field>\n            </Panel>\n          )}\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withApi(withOrganization(OrganizationGeneralSettings));\n"],"sourceRoot":""}
/*!
 * Copyright 2016 - 2019  Ternaris.
 * SPDX-License-Identifier: AGPL-3.0-only
 */

const t=/(?=^(?:[1-9]\d{3}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1\d|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[1-9]\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-02-29)T(?:[01]\d|2[0-3]):[0-5]\d:[0-5]\d(?:[,.]\d+)?(?:Z|[+-][01]\d:[0-5]\d)?$)(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:[,.]\d+)?)(.*)/;var e=t=>{const e=t.toString();return e.length<2?`0${e}`:e};function i(t){return 4800*t/146097}const s={s:45,m:45,h:22,d:26,M:11};class n{constructor(t){this.diff=t}as(t){switch(t){case"y":return i(this.diff/864e5)/12;case"M":return i(this.diff/864e5);case"w":return this.diff/6048e5;case"d":return this.diff/864e5;case"h":return this.diff/36e5;case"m":return this.diff/6e4;case"s":return this.diff/1e3;case"ms":return this.diff;default:throw new Error("Unknown unit "+t)}}}const l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};class r{constructor(e){if("number"==typeof e){this.d=new Date(e);const i=this.d.getTimezoneOffset(),s=`${i<0?"+":"-"}${Math.abs(i)/60>>0}:${Math.abs(i)%60}`;this.o=t.exec(`${this.d.toISOString().slice(0,-1)}${s}`)}else if("string"==typeof e)this.d=new Date(e),this.o=t.exec(e);else if(e instanceof r)this.d=new Date(e.d);else{if(e)throw new Error(`Bad moment initialization: ${e}`);{this.d=new Date;const e=this.d.getTimezoneOffset(),i=`${e<0?"+":"-"}${Math.abs(e)/60>>0}:${Math.abs(e)%60}`;this.o=t.exec(`${this.d.toISOString().slice(0,-1)}${i}`)}}this.dddd=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.ddd=this.dddd.map(t=>t.slice(0,3)),this.dd=this.dddd.map(t=>t.slice(0,2)),this.MMMM=["January","Februray","March","April","May","June","July","August","September","October","November","December"],this.MMM=this.MMMM.map(t=>t.slice(0,3))}clone(){return new r(this)}monthDays(t,e){return new Date(t,e,0).getDate()}get year(){return this.d.getFullYear()}set year(t){this.d.setFullYear(t)}get month(){return this.d.getMonth()+1}set month(t){const e=this.monthDays(this.year,t);this.date>e&&(this.date=e),this.d.setMonth(t-1)}get date(){return this.d.getDate()}set date(t){this.d.setDate(t)}get hour(){return this.d.getHours()}set hour(t){this.d.setHours(t)}get minute(){return this.d.getMinutes()}set minute(t){this.d.setMinutes(t)}get second(){return this.d.getSeconds()}set second(t){this.d.setSeconds(t)}get millisecond(){return this.d.getMilliseconds()}set millisecond(t){this.d.setMilliseconds(t)}get weekday(){return this.d.getDay()}set weekday(t){const e=t-this.weekday;this.date=this.date+e}add(t,e){return"week"===e&&(t*=7,e="date"),this[e]=this[e]+t,this}startOf(t){switch(t){case"year":this.month=1;case"month":this.date=1;case"week":case"date":this.hour=0;case"hour":this.minute=0;case"minute":this.second=0;case"second":this.millisecond=0}return"week"===t&&(this.weekday=0),this}endOf(t){return this.startOf(t).add(1,t).add(-1,"millisecond")}formatClassic(t){t=t||"YYYY-MM-DDTHH:mm:ssZ";const i={MMMM:()=>this.MMMM[this.month-1],MMM:()=>this.MMM[this.month-1],MM:()=>e(this.month),M:()=>this.month,DD:()=>e(this.date),D:()=>this.date,dddd:()=>this.dddd[this.weekday],ddd:()=>this.ddd[this.weekday],dd:()=>this.dd[this.weekday],d:()=>this.weekday,YYYY:()=>this.year,YY:()=>this.year%100,HH:()=>e(this.hour),H:()=>this.hour,hh:()=>e(this.hour%12),h:()=>this.hour%12,mm:()=>e(this.minute),m:()=>this.minute,ss:()=>e(this.second),s:()=>this.second,LL:()=>`${this.MMMM[this.month-1]} ${this.date} ${this.year}`,LT:()=>`${e(this.hour)}:${e(this.minute)}`,Z:()=>{const t=this.d.getTimezoneOffset();return`${t<=0?"+":"-"}${e(Math.abs(t)/60>>0)}:${e(Math.abs(t)%60)}`}},s=new RegExp(`${Object.keys(i).join("|")}|.`,"g");return t.replace(s,t=>i[t]?i[t]():t)}format(t,i){t=t||"YYYY-MM-DDTHH:mm:ssZZ";const s={timeZone:i,timeZoneName:"short",formatMatcher:"basic"},n=()=>{const t=(this.d-new Date(this.format("YYYY-MM-DDTHH:mm:ss",i)+"+0000"))/6e4;return`${t<=0?"+":"-"}${e(Math.abs(t)/60>>0)}:${e(Math.abs(t)%60)}`},l={},r={MMMM:t=>(t.month="long","{month}"),MMM:t=>(t.month="short","{month}"),MM:t=>(t.month="2-digit","{month}"),M:t=>(t.month="numeric","{month}"),DD:t=>(t.day="2-digit","{day}"),D:t=>(t.day="numeric","{day}"),dddd:t=>(t.weekday="long","{weekday}"),ddd:t=>(t.weekday="short","{weekday}"),dd:t=>(t.weekday="narrow","{weekday}"),YYYY:t=>(t.year="numeric","{year}"),YY:t=>(t.year="2-digit","{year}"),HH:t=>(t.hour="2-digit",l.hour=t=>e(+t),t.hourCycle="h23","{hour}"),H:t=>(t.hour="numeric",l.hour=t=>`${+t}`,t.hourCycle="h23","{hour}"),hh:t=>(t.hour="2-digit",l.hour=t=>e(+t),t.hourCycle="h12","{hour}"),h:t=>(t.hour="numeric",l.hour=t=>`${+t}`,t.hourCycle="h12","{hour}"),mm:t=>(t.minute="2-digit",l.minute=t=>e(+t),"{minute}"),m:t=>(t.minute="numeric",l.minute=t=>`${+t}`,"{minute}"),ss:t=>(t.second="2-digit",l.second=t=>e(+t),"{second}"),s:t=>(t.second="numeric",l.second=t=>`${+t}`,"{second}"),LL:t=>(t.month="long",t.day="numeric",t.year="numeric","{month} {day} {year}"),LT:t=>(t.hour="2-digit",t.minute="2-digit",t.day="2-digit","{hour}:{minute} {dayPeriod}"),z:()=>"{timeZoneName}",ZZ:()=>(l.timeZoneName=n,"{timeZoneName}")},a=new RegExp(`${Object.keys(r).join("|")}|.`,"g"),o=t.replace(a,t=>r[t]?r[t](s):t),c=Intl.DateTimeFormat([],s).formatToParts(this.d);return c.push({type:"dayPeriod",value:""}),o.replace(/{([^}]+)}/g,(function(t,e){return(l[e]||(t=>t))(c.find(t=>t.type===e).value)})).trim()}valueOf(){return this.d.valueOf()}fromNow(){return function(t){const e=t<0,i=new n(Math.abs(t)),r=Math.round,a=r(i.as("s")),o=r(i.as("m")),c=r(i.as("h")),h=r(i.as("d")),d=r(i.as("M")),u=r(i.as("y")),m=a<s.s&&["s",a]||o<=1&&["m"]||o<s.m&&["mm",o]||c<=1&&["h"]||c<s.h&&["hh",c]||h<=1&&["d"]||h<s.d&&["dd",h]||d<=1&&["M"]||d<s.M&&["MM",d]||u<=1&&["y"]||["yy",u];let I=l[m[0]].replace(/%d/i,m[1]);return l[e?"future":"past"].replace(/%s/i,I)}(Date.now()-this.d.valueOf())}toJSON(){return this.format()}toString(){return""+this.d.valueOf()}}class a{constructor(t){this.fn=t}}class o{constructor(t){this.content=t}}function c(t){const e=`action${t.type}`,i=t.currentTarget.getAttribute(`data-${e}`);console.assert(i,`No action id found for ${t.type} for`,t.currentTarget);const{action:s,args:n}=this.actions[`${t.type}-${i}`],l=this.ctx;let r;const a="function"==typeof(r="function"==typeof s?s:l.scope.evalExpression(s,{}))?r:l[r];console.assert(a,`There is no action ${r} on ${l.__oid__}`),a.apply(l,n.map(t=>this.evalExpression(t,{})).concat([t]))}var h={action:new a((function([t]){let e=t,i=[];"function"!=typeof t&&([e,...i]=t);const s=i.filter(t=>"on"===t.name)[0],n=i.filter(t=>"capture"===t.name)[0],l=s?s.value:"click";i=i.filter(t=>"on"!==t.name&&"capture"!==t.name);const r=this.ctx.getOwner().actions.id++;return(this.actions||(this.actions={}))[`${l}-${r}`]={action:e,args:i},this.handleEvent=this.ctx.getOwner().asyncEvent(c),{name:`data-action${l}`,value:r,listener:[l,this,!!n]}})),"muc-if":new a((function([t],e){for(let i=0,s=t.length;i<s;i++){const s=t[i];if(!s)return i;if(this.evalExpression(s,e))return i}return-1})),"muc-loop":new a((function([t],e){for(let t of Object.keys(e))delete e[t],e[`${t}.@each`]=!0;return t})),curry:new a((function(t){return(...e)=>(e=e.map(t=>({type:"Literal",value:t})),this.evalExpression({type:"Expression",value:t[0][0].value.concat(e)},{}))})),set:new a((function(t){return this.setPath(t[0][0].value,t[1])})),setter:new a((function(t){const e=t[0];return(...i)=>{this.setPath(e,t.slice(1).concat(i)[0])}})),cast:new a((function(t){const e={string:t=>String(t),number:t=>Number(t),boolean:t=>Boolean(t),moment:t=>new r(t)},i=t[0],s=t[1];return t=>s(e[i](t))})),fn:new a((function(t){return(...e)=>t[0].apply(this.ctx,t.slice(1).concat(e))})),concat:new a(t=>t.join("")),if:new a(t=>{const e=t[0],i=t[1],s=t[2];return e?i:s}),"is-equal":new a(t=>t[0]===t[1]),"is-greater":new a(t=>t[0]>t[1]),contains:new a(t=>!!t[0]&&-1!==t[0].indexOf(t[1])),upper:new a(t=>`${t}`.toUpperCase()),not:new a(t=>!t[0]),and:new a(t=>t.every(t=>t)),or:new a(t=>t.some(t=>t)),increment:new a(t=>t[0]+(t[1]||1)),"print-relatime":new a(t=>new r(t[0]).fromNow()),"format-timedelta":new a(([t])=>{if(null===t)return"";const i=(t=t/1e3>>0)/3600>>0,s=(t%=3600)/60>>0;return t%=60,i?`${i}h ${e(s)}m ${e(t)}s`:s?`${s}m ${e(t)}s`:`${t}s`}),"format-date":new a(([t,e])=>t?new r(t).format(e||"YYYY-MM-DD"):""),"format-datetime":new a(([t,e])=>t?new r(t).format(e||"YYYY-MM-DD HH:mm:ss"):""),divide:new a(([t,e])=>t/e),"format-localestring":new a(([t,e])=>t.toLocaleString(navigator.language,{style:e,currency:"EUR"})),"format-float":new a(([t,e])=>{e="number"==typeof e?e:2;const i=Math.pow(10,e);return(t*i>>0)/i}),"format-html":new a(([t])=>new o(t)),"format-icon":new a(([t])=>t?new o(`<span class="glyphicon glyphicon-${t.icon} ${t.classes}" title="${t.title}"></span>`):""),"format-link":new a(t=>{const e=(t=t[0]||{}).external?" target=_blank":"",i=t.href,s=t.title;return new o(`<a href="${i}" ${e}>${s}</a>`)}),"format-pill":new a(t=>new o(`<span class="badge">${t}</span>`)),"format-route":new a((t,e)=>{(t=t[0]||{}).route=t.route||"",e["ctx.__owner__.router.currentQuery"]=!0;const i=window.location.search;return new o(`<a href="${window.location.pathname}${i||""}#/${t.route.replace(".","/")}/${t.id}">${t.title}</a>`)}),"format-filesize":new a(t=>{if(0===t[0])return"0.00 B";const e=Math.floor(Math.log(t[0])/Math.log(1024));return(t[0]/Math.pow(1024,e)).toFixed(2)+" "+" KMGTP".charAt(e)+"B"}),"format-string":new a(t=>t[0]),"format-int":new a(t=>t[0]),stringify:new a(t=>JSON.stringify(...t)),"is-promise":new a(([t])=>t instanceof Promise),get:new a(([t,e])=>t[e]),zip:new a(([t,e])=>{if(!t)return[];const i=t.instance?t.instance.constructor:t.constructor;return i.from(t.map((s,n)=>i.from([t[n],e[n]])))})};const d={uuid:Symbol("uuid"),watchers:Symbol("watcher"),watched:Symbol("watched")};let u=0;class m{constructor(t,e,i){this.keys=t,this.get=e,this.set=i}}function I(...t){let e=t.pop(),i=null;return"object"==typeof e&&(i=e.set,e=e.get),new m(t,e,i)}function g(t){return t instanceof x||t instanceof v}function b(t,e,i,s){const n=t[d.watched][/^[0-9]+/.test(e)?"@each":e];if(n)for(let[t,l]of Object.entries(n)){l.subtree._hasLeaf&&(s||i)&&("@each"===e?(i.forEach(e=>{g(e)&&f(e.instance,l.origin,l.subtree,t)}),s.forEach(e=>{g(e)&&p(e.instance,l.origin,l.subtree,t)})):(g(i)&&f(i.instance,l.origin,l.subtree,t),g(s)&&p(s.instance,l.origin,l.subtree,t)));const n=l.origin,r=n.target,a=n.property,o=r[d.watchers][a];o.cached&&(o.cached=!1,o.notify&&o.notify(r,e,i,s),b(r,a))}}function p(t,e,i,s){const n=t[d.watched];for(let l in i){const r=i[l],a=`${s}.${l}`;if(n[l]||(n[l]={}),n[l][a])n[l][a].ref++;else if(n[l][a]={ref:1,origin:e,subtree:r},r._hasLeaf)if("@each"===l)for(let i=0,s=t.length;i<s;i++){const s=t[i];g(s)&&p(s.instance,e,r,a)}else{const i=t[d.watchers][l],s=i?i.value:t[l];g(s)&&p(s.instance,e,r,a)}}}function f(t,e,i,s){const n=t[d.watched];for(let l in i){const r=i[l],a=`${s}.${l}`;if(!--n[l][a].ref&&(delete n[l][a],r._hasLeaf))if("@each"===l)for(let i=0,s=t.length;i<s;i++){const s=t[i];g(s)&&f(s.instance,e,r,a)}else{const i=t[d.watchers][l],s=i?i.value:t[l];g(s)&&f(s.instance,e,r,a)}}}const G={};function Z(t){const e=t.join("");if(!G[e]){const i={};Object.defineProperty(i,"_hasLeaf",{value:!1,enumerable:!1,writable:!0}),t.forEach(t=>{const e=t.split(".");let s=i;for(let t=0,i=e.length;t<i;t++){const i=e[t];s._hasLeaf=!0,s[i]||(s[i]={},Object.defineProperty(s[i],"_hasLeaf",{value:!1,enumerable:!1,writable:!0})),s=s[i]}}),G[e]=i}return G[e]}function Y(t,e,i){t[d.watchers][e]={keys:i.keys,value:null,cached:!1,notify:i.notify};const s=t[d.watchers][e];Object.defineProperty(t,e,{get(){if(!s.cached){const n=s.value;if(s.value=i.get.apply(t),s.value instanceof Promise){const i=s.promise=s.value;s.promise.then(n=>{i===s.promise&&(s.value=n,b(t,e,s.promise,s.value),s.cached=!0)},n=>{i===s.promise&&(s.value={error:n},b(t,e,s.promise,s.value),s.cached=!0)})}b(t,e,n,s.value),s.cached=!0}return s.value},set(t){i.set&&i.set.apply(this,arguments);const s=this[d.watchers][e];s.cached=!0,s.value=t},configurable:!0}),i.keys.length&&p(t,{target:t,property:e,wdesc:s},Z(i.keys),`${t[d.uuid]}:${e}`),t[d.watched][e]&&b(t,e,"","")}function y(t,e,i){const s=t[d.watchers][e];if(i.length!==s.keys.length||i.some(t=>!~s.keys.indexOf(t))){const n={target:t,property:e,wdesc:s};s.keys.length&&f(t,n,Z(s.keys),`${t[d.uuid]}:${e}`),i.length&&p(t,n,Z(i),`${t[d.uuid]}:${e}`),t[d.watchers][e].keys=i,t[d.watchers][e].cached=!1}}function W(t,e){const i=t[d.watchers][e];console.assert(i,`${e} is not defined on ${t.__oid__}`);const s={target:t,property:e,wdesc:i};i.keys.length&&f(t,s,Z(i.keys),`${t[d.uuid]}:${e}`),delete t[d.watchers][e],delete t[e]}const X={push(t){return this.splice(this.length,0,t)},pop(){return this.splice(this.length-1,1)},unshift(t){return this.splice(0,0,t)},shift(){return this.splice(0,1)}},w={set(t,e,i){const s=t[e];return s===i||(b(t,e,s,i),t[e]=i,!0)},get(t,e,i){if("splice"===e)return function(e,i,...s){const n=t.splice.apply(t,arguments);return b(t,"@each",n,s),s.length!==n.length&&b(t,"length"),n};if("string"==typeof e&&"-"===e[0]){let s=Number(e);if(s<0)return e=String(t.length+s),Reflect.get(t,e,i)}return X[e]||t[e]}};class v extends Array{constructor(){return super(),Object.defineProperties(this,{[d.watchers]:{enumerable:!1,value:{}},[d.watched]:{enumerable:!1,value:{}},[d.uuid]:{enumerable:!1,value:u++},instance:{enumerable:!1,value:this}}),new Proxy(this,w)}static create(t){return t instanceof Array?v.from(t):new v}}const N={set(t,e,i,s){if(i instanceof m&&Y(s,e,i),t[d.watched][e]&&!(i instanceof m)){let n;if(t[d.watchers][e]?(n=t[d.watchers][e].value,t[d.watchers][e].cached=!0):n=t[e],n===i)return!0;b(s,e,n,i)}return i instanceof m||Reflect.set(t,e,i,s),!0}};class x{constructor(){return Object.defineProperties(this,{[d.watchers]:{enumerable:!1,value:{}},[d.watched]:{enumerable:!1,value:{}},[d.uuid]:{enumerable:!1,value:u++},instance:{enumerable:!1,value:this}}),new Proxy(this,N)}init(){}dispose(){}static create(t){const e=new this;return Object.assign(e,t),e.init(),e}getOwner(){return this.__owner__}get __oid__(){return`${this.constructor.name}(${this[d.uuid]})`}}const B=t=>/[A-Za-z]/.test(t),C=t=>/[A-Z]/.test(t),L=t=>/[0-9]/.test(t),R=t=>/[0-9A-Fa-f]/.test(t),j=t=>/[\t\n\f ]/.test(t),V={nbsp:" ",times:"×",laquo:"«",raquo:"»",lt:"<",gt:">"},z=["br","img","input"],P=String.fromCharCode(0),S=-1,k={data(){const t=this.consume();if("&"===t)this.additionalAllowedCharacter=null,this.emit({type:"Literal",value:this.characterReference()});else if("<"===t)this.state="tagOpen";else{if(t===P)throw new Error("NULL in data state");t===S?this.emit({type:"EOF"}):"{"===t&&"{"===this.peek()?(this.pos++,this.returnState="data",this.state="mustache"):this.emit({type:"Literal",value:t})}},tagOpen(){const t=this.consume();if("!"===t&&"-"===this.peek()&&"-"===this.peek(1))this.pos+=2,this.commentToken="",this.state="commentStart";else if("/"===t)this.state="endTagOpen";else if(C(t))this.token={type:"StartTag",name:t.toLowerCase(),attrs:[]},this.state="tagName";else{if(!B(t))throw new Error(`Parse error: tagname expected got: '${t}'`);this.token={type:"StartTag",name:t,attrs:[]},this.state="tagName"}},endTagOpen(){const t=this.consume();if(C(t))this.token={type:"EndTag",name:t.toLowerCase(),attrs:[]},this.state="tagName";else{if(!B(t))throw">"===t?new Error("Parse error: empty close tag"):t===S?new Error("Parse error: end tag not closed before EOF"):new Error(`Parse error: tagname expected got: '${t}'`);this.token={type:"EndTag",name:t,attrs:[]},this.state="tagName"}},tagName(){const t=this.consume();if(j(t))this.state="beforeAttributeName";else if("/"===t)this.state="selfClosingStartTag";else if(">"===t)this.state="data",this.emit(this.token);else if(C(t))this.token.name+=t.toLowerCase();else{if(t===P)throw new Error("Parse error: NULL in tagname");if(t===S)throw new Error("Parse error: EOF in tagname");this.token.name+=t}},beforeAttributeName(){const t=this.consume();if(j(t));else if("/"===t)this.state="selfClosingStartTag";else if(">"===t)this.state="data",this.emit(this.token);else if(C(t))this.attr={name:t,value:[]},this.token.attrs.push(this.attr),this.state="attributeName";else{if(t===P)throw new Error("Parse error: NULL at start of attribute name");if(/["'<=]/.test(t))throw new Error(`Parse error: Attribute name cannot start with ${t}`);if(t===S)throw new Error("Parse error: EOF in tag");"{"===t&&"{"===this.peek()?(this.pos++,this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.returnState="beforeAttributeName",this.state="mustache"):(this.attr={name:t,value:[]},this.token.attrs.push(this.attr),this.state="attributeName")}},attributeName(){const t=this.consume();if(j(t))this.state="afterAttributeName";else if("/"===t)this.state="selfClosingStartTag";else if("="===t)this.state="beforeAttributeValue";else if(">"===t)this.state="data",this.emit(this.token);else if(C(t))this.attr.name+=t;else{if(t===P)throw new Error("Parse error: NULL in attribute name");if(/["'<]/.test(t))throw new Error(`Parse error: Attribute name cannot contain ${t}`);if(t===S)throw new Error("Parse error: EOF in attribute name");this.attr.name+=t}},afterAttributeName(){const t=this.consume();if(j(t));else if("/"===t)this.state="selfClosingStartTag";else if("="===t)this.state="beforeAttributeValue";else if(">"===t)this.state="data",this.emit(this.token);else if(C(t))this.attr={name:t,value:[]},this.token.attrs.push(this.attr),this.state="attributeName";else{if(t===P)throw new Error("Parse error: NULL after attribute name");if(/["'<]/.test(t))throw new Error(`Parse error: Char after attribute name cannot be ${t}`);if(t===S)throw new Error("Parse error: EOF in attribute name");"{"===t&&"{"===this.peek()?(this.pos++,this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.returnState="afterAttributeName",this.state="mustache"):(this.attr={name:t,value:[]},this.token.attrs.push(this.attr),this.state="attributeName")}},beforeAttributeValue(){const t=this.consume();if(j(t));else if('"'===t||"'"===t)this.q=t,this.state="attributeValueQ";else if("&"===t)this.pos--,this.state="attributeValueU";else{if(t===P)throw new Error("Parse error: NULL before attribute value");if(">"===t)throw new Error("Parse error: Expected attribute value");if(/[<=`]/.test(t))throw new Error(`Parse error: Char before attribute value cannot be ${t}`);if(t===S)throw new Error("Parse error: EOF before attribute value");"{"===t?(this.pos--,this.state="attributeValueU"):(this.attr.value.push({type:"Literal",value:t}),this.state="attributeValueU")}},attributeValueQ(){const t=this.consume();if(t===this.q)this.state="afterAttributeValueQ";else if("&"===t){this.additionalAllowedCharacter=this.q;const t=this.attr.value.slice(-1)[0];t&&"Literal"===t.type?t.value+=this.characterReference():this.attr.value.push({type:"Literal",value:this.characterReference()})}else{if(t===P)throw new Error("Parse error: NULL in attribute value");if(t===S)throw new Error("Parse error: EOF in attribute value");if("{"===t&&"{"===this.peek())this.pos++,this.returnState="attributeValueQ",this.state="mustache";else{const e=this.attr.value.slice(-1)[0];e&&"Literal"===e.type?e.value+=t:this.attr.value.push({type:"Literal",value:t})}}},attributeValueU(){const t=this.consume();if(j(t))this.state="beforeAttributeName";else if("&"===t){this.additionalAllowedCharacter=">";const t=this.attr.value.slice(-1)[0];t&&"Literal"===t.type?t.value+=this.characterReference():this.attr.value.push({type:"Literal",value:this.characterReference()})}else if(">"===t)this.state="data",this.emit(this.token);else{if(t===P)throw new Error("Parse error: NULL in attribute value");if(/["'<=`]/.test(t))throw new Error(`Parse error: Char in attribute value cannot be ${t}`);if(t===S)throw new Error("Parse error: EOF in attribute value");if("{"===t&&"{"===this.peek())this.pos++,this.returnState="attributeValueU",this.state="mustache";else{const e=this.attr.value.slice(-1)[0];e&&"Literal"===e.type?e.value+=t:this.attr.value.push({type:"Literal",value:t})}}},afterAttributeValueQ(){const t=this.consume();if(j(t))this.state="beforeAttributeName";else if("/"===t)this.state="selfClosingStartTag";else{if(">"!==t)throw t===S?new Error("Parse error: EOF after attribute value"):new Error(`Parse error: Unexpected token ${t} after attribute`);this.state="data",this.emit(this.token)}},selfClosingStartTag(){const t=this.consume();if(">"!==t)throw t===S?new Error("Parse error: EOF in self closing tag"):new Error("Parse error: Unexpected token / in self closing tag");this.token.selfClosing=!0,this.state="data",this.emit(this.token)},commentStart(){const t=this.consume();if("-"===t)this.state="commentStartDash";else{if(t===P)throw new Error("Parse error: NULL at comment start");if(">"===t)throw new Error("Parse error: > at comment start");if(t===S)throw new Error("Parse error: EOF at comment start");this.commentToken+=t,this.state="comment"}},commentStartDash(){const t=this.consume();if("-"===t)this.state="commentEnd";else{if(t===P)throw new Error("Parse error: NULL at comment start dash");if(">"===t)throw new Error("Unexpected token");if(t===S)throw new Error("Parse error: EOF at comment start dash");this.commentToken+=`-${t}`,this.state="comment"}},comment(){const t=this.consume();if("-"===t)this.state="commentEndDash";else{if(t===P)throw new Error("Parse error: NULL in comment");if(t===S)throw new Error("Parse error: EOF in comment");this.commentToken+=t}},commentEndDash(){const t=this.consume();if("-"===t)this.state="commentEnd";else{if(t===P)throw new Error("Parse error: NULL in comment end dash");if(t===S)throw new Error("Parse error: EOF in comment");this.commentToken+=`-${t}`,this.state="comment"}},commentEnd(){const t=this.consume();if(">"!==t)throw t===P?new Error("Parse error: NULL in comment end"):"!"===t?new Error("Parse error: ! at comment end"):"-"===t?new Error("Parse error: - at comment end"):t===S?new Error("Parse error: EOF at comment end"):new Error(`Parse error: '${t}' after -- at comment end`);this.state="data",this.emit({type:"comment",value:this.commentToken})},mustache(){const t=this.consume();if("!"===t)this.mtoken={type:"MustacheComment",value:""},this.state="mustacheComment";else{if("}"===t)throw new Error("Parse error: empty mustaches not allowed");this.mtoken={type:"MustacheContent",value:[]},this.mstack=[this.mtoken],this.mvalue=this.mstack[0].value,"#"===t?(this.mvalue.push({type:"BlockOpen",value:""}),this.state="mustacheBlockOpen"):"/"===t?(this.mvalue.push({type:"BlockClose",value:""}),this.mstack.push(),this.state="mustacheBlockClose"):(this.pos--,this.state="mustacheContent")}},mustacheComment(){const t=this.consume();if("}"===t&&"}"===this.peek()){if(this.pos++,"data"!==this.returnState)throw new Error("Cannot emit mustache comment inside tag");this.emit(this.mtoken),this.state=this.returnState}else this.mtoken.value+=t},mustacheBlockOpen(){const t=this.consume();if(j(t)||"}"===t)this.pos--,this.state="mustacheContent";else{if(!B(t))throw new Error(`Unexpected token '${t}'`);this.mvalue[0].value+=t}},mustacheBlockClose(){const t=this.consume();if("}"===t)this.pos--,this.state="mustacheContent";else{if(!B(t))throw new Error(`Unexpected token '${t}'`);this.mvalue[0].value+=t}},mustacheContent(){const t=this.consume();if("("===t){const t={type:"Expression",value:[]};this.mvalue.push(t),this.mvalue=t.value,this.mstack.unshift(t)}else if(")"===t){if(1===this.mstack.length)throw new Error('Stray ")" in mustache found');this.mstack.shift(),this.mvalue=this.mstack[0].value}else if('"'===t){const t={type:"Literal",value:""};this.mvalue.push(t),this.mstack.unshift(t),this.state="mustacheLiteral"}else if(L(t)){const e={type:"Literal",value:+t};this.mvalue.push(e),this.mstack.unshift(e),this.state="mustacheLiteralNumber"}else if("-"===t){const t={type:"Literal",value:0};this.mvalue.push(t),this.mstack.unshift(t),this.state="mustacheLiteralNegativeNumber"}else if(B(t)){const e={type:"Identifier",value:t};this.mvalue.push(e),this.mstack.unshift(e),this.state="mustacheIdentifier"}else if("|"===t){const t={type:"BlockParams",value:""};this.mvalue.push(t),this.mstack.unshift(t),this.state="mustacheBlockParams"}else if(j(t));else{if("}"!==t||"}"!==this.peek())throw new Error(`Mustache content broken "${t}"`);if(this.pos++,1!==this.mstack.length)throw new Error("Not all expressions closed");"data"===this.returnState?this.emit(this.mtoken):this.attr.value.push(this.mtoken),this.state=this.returnState}this.mname&&(this.mstack[0].name=this.mname,this.mname=null)},mustacheBlockParams(){const t=this.consume();"|"===t?(this.mstack.shift(),this.state="mustacheContent"):this.mstack[0].value+=t},mustacheLiteral(){const t=this.consume();'"'===t?(this.mstack.shift(),this.state="mustacheContent"):this.mstack[0].value+=t},mustacheLiteralNumber(){const t=this.consume();if(L(t))this.mstack[0].value*=10,this.mstack[0].value+=+t;else{if(!j(t)&&")"!==t&&"}"!==t)throw new Error(`Cannot parse digit ${t}`);this.pos--,this.mstack.shift(),this.state="mustacheContent"}},mustacheLiteralNegativeNumber(){const t=this.consume();if(L(t))this.mstack[0].value*=10,this.mstack[0].value+=+t;else{if(!j(t)&&")"!==t&&"}"!==t)throw new Error(`Cannot parse digit ${t}`);this.mstack[0].value*=-1,this.pos--,this.mstack.shift(),this.state="mustacheContent"}},mustacheIdentifier(){const t=this.consume(),e=["undefined","null","true","false"];if(j(t)||")"===t||"}"===t){this.pos--;const t=this.mstack[0];if(~e.indexOf(t.value)){t.type="Literal";const e=t.value[0];t.value="u"===e?void 0:"n"===e?null:"t"===e}this.mstack.shift(),this.state="mustacheContent"}else if("="===t)this.mname=this.mstack[0].value,this.mstack.shift(),this.mstack[0].value.pop(),this.state="mustacheContent";else{if(!(t=>/[0-9A-Za-z]/.test(t))(t)&&"-"!==t&&"."!==t&&"_"!==t)throw new Error(`Unexpected token "${t}"`);this.mstack[0].value+=t}}};class F{constructor({input:t}){this.input=t,this.pos=0,this.state="data"}consume(){return this.pos<this.input.length?this.input[this.pos++]:S}peek(t){return t=t||0,this.pos+t<this.input.length?this.input[this.pos+t]:S}characterReference(){var t=this.peek();if(j(t)||"<"===t||"&"===t||t===S||t===this.additionalAllowedCharacter)return"&";if("#"===t){let e,i;if(this.pos++,/[xX]/.test(this.peek())?(this.pos++,e=R,i=16):(e=L,i=10),!e(this.peek()))throw new Error("Numerical character reference expected");let s=0;for(t=this.consume();t!==S&&e(t);)s=s*i+parseInt(t,i),t=this.consume();if(";"!==t)throw new Error("Numerical character reference not terminated with ;");return String.fromCharCode(s)}{var e=t;let s=Object.keys(V).filter(e=>e[0]===t);for(;s.length;)e+=this.peek(e.length),s=s.filter(t=>t[e.length-1]===e.slice(-1));var i=e.slice(0,-1);return i in V?(this.pos+=e.length,V[i]):"&"}}emit(t){if("EndTag"===t.type){if(t.selfClosing)throw new Error("EndTags cannot be self-closing");if(t.attrs.length)throw new Error("EndTags cannot have attrs")}this.tokens.push(t)}tokenize(){for(this.tokens=[];!this.tokens.length||"EOF"!==this.tokens.slice(-1)[0].type;)k[this.state].call(this);return this.tokens.pop(),this.tokens}build(t){const e=[{name:"root",content:[],params:[]}],i=t=>("Identifier"===t.type?t.value=(t=>{const i=t.split(".")[0],s=[];for(let t=e.length-1;t>=0;t--)"loop"===e[t].type?s.push(e[t].params):"component"===e[t].type&&(s.push(e[t].params),s.push([]));for(let e=0,n=s.length;e<n;e++)if(~s[e].indexOf(i))return`${Array.from({length:e+1}).join("parent.")}${t}`;return`ctx.${t}`})(t.value):"Expression"===t.type||"Invocation"===t.type?t.value=t.value.map(i):"Attributes"===t.type&&(t.value=t.value.map(i)),t);for(let s of t)if("Literal"===s.type){const t=e.slice(-1)[0].content.slice(-1)[0];t&&"Literal"===t.type?t.value+=s.value:e.slice(-1)[0].content.push(s)}else if("StartTag"===s.type){let t=s.attrs.map(t=>"as"===t.name?t:(t.value=t.value.map(t=>("MustacheContent"===t.type&&(console.assert(t.value.length>0),t.value.length>1?t.type="Invocation":t=t.value[0]),t)),console.assert(t.value.length>0),t.value.length>1?t.value=i({type:"Expression",value:[{type:"Literal",value:"concat"}].concat(t.value)}):t.value=i(t.value[0]),t));const n=t.filter(t=>"as"===t.name),l={type:/-/.test(s.name)?"Component":"Tag",name:s.name,attributes:t.filter(t=>"as"!==t.name),params:n.length?n[0].value[0].value.split(" "):[],content:[]};e.slice(-1)[0].content.push(l),~z.indexOf(s.name)||s.selfClosing||e.push({type:s.name.includes("-")?"component":"tag",name:s.name,content:l.content,params:l.params})}else if("EndTag"===s.type){if(s.name!==e.slice(-1)[0].name)throw new Error(`Unexpected end tag ${s.name}`);e.pop()}else if("MustacheComment"===s.type||"comment"===s.type);else{if("MustacheContent"!==s.type)throw new Error(`Unknown type ${s.type}`);{const[t,...n]=s.value;if("Identifier"===t.type||"Expression"===t.type||"Literal"===t.type)if("else"===t.value){const t=e.slice(-1)[0];if("each"===t.name){if(n.length)throw new Error("Malformed else on each");const i=e.slice(-2)[0].content.slice(-1)[0];i.catchempty=[],t.content=i.catchempty}else{if("if"!==t.name)throw new Error(`Mustache else out of scope ${t.name}`);{if(n.length){if("if"!==n[0].value)throw new Error("else may only be followed by if");n.shift()}const s=e.slice(-2)[0].content.slice(-1)[0],l=n[0]?i(n[0]):null;s.branches.push([]),s.conditions.value[1].value.push(l),t.content=s.branches.slice(-1)[0]}}}else n.length?e.slice(-1)[0].content.push(i({type:"Invocation",value:s.value})):e.slice(-1)[0].content.push(i(t));else if("BlockOpen"===t.type){let s;if("each"===t.value){const l=(n.filter(t=>"BlockParams"===t.type)[0]||{value:""}).value.split(" ").filter(t=>t);s={type:"Loop",list:{type:"Expression",value:[{type:"Literal",value:"muc-loop"},i(n[0])]},params:l,content:[]},e.slice(-1)[0].content.push(s),e.push({type:"loop",name:t.value,content:s.content,params:l})}else"if"===t.value?(s={type:"Condition",attributes:i({type:"Attributes",value:n.slice(1)}).value,branches:[[]],conditions:{type:"Expression",value:[{type:"Literal",value:"muc-if"},{type:"Expression",value:[{type:"Literal",value:"noexpand"},i(n[0])]}]}},e.slice(-1)[0].content.push(s),e.push({name:t.value,content:s.branches[0]})):(s={type:"Block",name:t.value,attributes:n.map(i),content:[]},e.slice(-1)[0].content.push(s),e.push({name:t.value,content:s.content}))}else{if("BlockClose"!==t.type)throw new Error(`Do not know ${t.type}`);if(t.value!==e.slice(-1)[0].name)throw new Error(`Unexpected end tag ${t.value}`);e.pop()}}}if(1!==e.length)throw new Error(`Unclosed element ${e[1].name}`);return e[0].content}parse(){try{this.tokenize()}catch(t){const e=this.input.split("\n");let i=this.pos,s=0;for(;i>e[s].length;)i-=e[s].length+1,s++;const n=`Parser error at line: ${s+1} col: ${i} abs: ${this.pos}`;throw new Error(`Line content: ${e[s]}\n${n}\n${t.message}`)}return this.build(this.tokens)}}function H(t){return e=/[ <{]/.test(t)?t:decodeURIComponent(escape(atob(t))),new F({input:e}).parse();var e}const M={};class J extends x{constructor(){super()}subscope(t){return t.parent=this,J.create(t)}getHelper(t){const e=this.ctx.getOwner().helpers[t];if(!e)throw new Error(`Helper ${t} does not exist.`);return e}getPath(t){if(!M[t]){let e=t.split("."),i=[];if(2===e.length&&"ctx"===e[0])i.push(`return typeof obj.${t} !== 'undefined' ? obj.${t} : undefined;`);else{for(let t=0,s=(e=e.map(t=>/^-?[0-9]*$/.test(t)?`obj[${t}]`:`obj.${t}`)).length-1;t<s;t++)i.push(`if(obj) obj=${e[t]}; else return '';`);i.push(`return obj ? ${e[e.length-1]} : '';`)}M[t]=new Function("obj",i.join("\n"))}return M[t](this)}setPath(t,e){const i=t.split(".");let s=this;for(let n=0,l=i.length-1;n<l;n++)if("object"!=typeof(s=s[i[n]]))throw new Error(`Cannot set path ${t} to ${e}`);s[i[i.length-1]]=e}evaluate(t,e,i,s){if("Literal"===t.type)return~e.indexOf(t.value)||e.push(t.value),`__lit[${e.indexOf(t.value)}]`;if("Identifier"===t.type)return~i.indexOf(t.value)||i.push(t.value),`__ide[${i.indexOf(t.value)}]`;{if(console.assert("Expression"===t.type||"Invocation"===t.type),"path"===t.value[0].value)return e.push(t.value[1].value),`__lit[${e.length-1}]`;if("noexpand"===t.value[0].value)return e.push(t.value.slice(1)),`__lit[${e.length-1}]`;const n=`obj.getHelper(${this.evaluate(t.value[0],e,i,s)})`;return~s.indexOf(n)||s.push(n),`${`__con${s.indexOf(n)}`}.fn.call(obj, [${t.value.slice(1).map(t=>this.evaluate(t,e,i,s))}], triggers)`}}evalExpression(t,e){if("Literal"===t.type)return t.value;if("Identifier"===t.type)return e[t.value]=!0,this.getPath(t.value);if(!t.fn){const e=[],i=[],s=[],n=this.evaluate(t,e,i,s),l=[];for(let t in i)l.push(`triggers["${i[t]}"] = true;`);for(let t=0;t<s.length;t++)l.push(`const __con${t} = ${s[t]};`);l.push(`return ${n};`),t.fn=new Function("obj","triggers","__lit","__ide",l.join("\n")),t.__lit=e,t.__ide=i}return t.fn(this,e,t.__lit,t.__ide.map(t=>this.getPath(t)))}createUpdater(t,e,i,s,n){e.updaters.push([this.instance,i]);let l=!0;Y(this.instance,i,{get(){let t={};const e=this.evalExpression(s,t);n.apply(this,[e,l]),l=!1,y(this,i,Object.keys(t))},set:null,keys:[],notify:()=>{t.__dirty__.push([this,i,e.depth]),t.getOwner().asyncEvent(()=>{})()}}),this[i]}}function A(t,e,i,s,n,l,r,a,c,h){if(console.assert(n.ctx===a),console.assert(r===a.__owner__),"Condition"===i.type){t.leafs.push(e);const r=s.createTextNode("");c.appendChild(r),n.createUpdater(l,e,`${e.prefix}-condition`,i.conditions,(t,s)=>{if(e.branch!==t){e.unrender(!0),e.branch=t;const l=i.branches[e.branch];l&&(s?D(e,l,n,r.parentNode,null):e.renderEnter(l,n,r))}})}else if("Loop"===i.type){t.leafs.push(e);const r=s.createTextNode("");c.appendChild(r);const a=i.params[0]||"__itemname__",o=i.params[1]||"__indexname__";i.list.list=!0;const h=[];n.createUpdater(l,e,`${e.prefix}-loop`,i.list,(t,s)=>{if(t&&t.length){if(1===e.leafs.length&&i.catchempty)e.unrender(!0);else if(e.leafs.length){for(let s=t.length*i.content.length,n=e.leafs.length;s<n;s++)e.leafs[s].unrender(!0,!0);e.leafs.splice(t.length*i.content.length,e.leafs.length-t.length*i.content.length),h.splice(t.length,h.length-t.length)}for(let e=h.length,i=t.length;e<i;e++){const i=J.create({parent:n,[a]:t[e],[o]:e,ctx:n.ctx});h.push(i)}for(let e=0,i=t.length;e<i;e++)h[e][a]=t[e];for(let n=e.leafs.length/i.content.length,l=t.length;n<l;n++)s?D(e,i.content,h[n],r.parentNode,r):e.renderEnter(i.content,h[n],r)}else h.length&&(h.splice(0,h.length),e.unrender(!0)),i.catchempty&&!e.leafs.length&&(s?D(e,i.catchempty,n,r.parentNode,r):e.renderEnter(i.catchempty,n,r));const l=r;e.getElements().forEach(t=>r.parentNode.insertBefore(t,l))})}else if("Component"===i.type){t.leafs.push(e);const l=i.name,r=a.getOwner().components[l];if(!r)throw new Error(`Component ${l} does not exist`);const o={__doc__:s,__owner__:a.__owner__,__oast__:i,scope:n.subscope({}),leaf:e};i.attributes.forEach(t=>{"Literal"===t.value.type?o[t.name]=t.value.value:o[t.name]=I({get(){const e={},i=this.scope.parent.evalExpression(t.value,e);return y(this.instance,t.name,Object.keys(e).map(t=>`scope.parent.${t}`)),i},set:null})}),e.component=r.create(o),D(e,e.component.__ast__,e.component.scope,c,h),e.component.__render__()}else if("Identifier"===i.type&&"ctx.outlet"===i.value){t.leafs.push(e);const r=s.createTextNode("");c.appendChild(r),n.createUpdater(l,t,`${t.prefix}-outlet`,i,t=>{e.component&&e.unrender(!0),e.component=t,t&&(Object.assign(t,{__doc__:s,__owner__:a.__owner__,leaf:e}),D(e,e.component.__ast__,e.component.scope,r.parentNode,r),e.component.__render__())})}else if("Literal"===i.type)t.leafs.push(e),e.elements=[s.createTextNode(i.value)],c.insertBefore(e.elements[0],h);else if("Tag"===i.type){t.leafs.push(e),e.elements=[s.createElement(i.name)],c.insertBefore(e.elements[0],h);for(let t=0,s=i.attributes.length;t<s;t++){const s=i.attributes[t];if(s.name)"Literal"===s.value.type?e.elements[0].setAttribute(s.name,s.value.value):n.createUpdater(l,e,`${e.prefix}-${s.name}`,s.value,t=>{void 0!==t&&!1!==t?e.elements[0].setAttribute(s.name,t):e.elements[0].removeAttribute(s.name)});else{let t=null;n.createUpdater(l,e,`${e.prefix}-${Math.random()}`,s.value,i=>{i?(t=i.name,e.elements[0].setAttribute(t,i.value),i.listener&&e.elements[0].addEventListener(...i.listener)):t&&(e.elements[0].removeAttribute(t),t=null)})}}D(e,i.content,n,e.elements[0],null)}else{console.assert("Identifier"===i.type||"Expression"===i.type),t.leafs.push(e),e.elements=[s.createTextNode("")],c.appendChild(e.elements[0]);let r=0;n.createUpdater(l,e,`${e.prefix}-content`,i,t=>{const i=e.elements;if(t instanceof o){const n=s.createElement("div");n.innerHTML=t.content,e.elements=Array.from(n.children),e.elements.length||(e.elements=[s.createTextNode("")]),e.elements.forEach(t=>i[0].parentNode.insertBefore(t,i[0])),i.forEach(t=>t.remove()),r=0}else(void 0===t||t instanceof Promise)&&(t=""),1!==r?(e.elements=[s.createTextNode(t)],i[0].parentNode.insertBefore(e.elements[0],i[0]),i.forEach(t=>t.remove()),r=1):e.elements[0].textContent=t})}}function D(t,e,i,s,n){const l=i.ctx,r=l.__owner__,a=l.__doc__,{rootNode:o}=r;for(let c=0,h=e.length;c<h;c++){const h=e[c];A(t,new E(r,t.depth+1,`${t.prefix}-${c}`),h,a,i,o,r,l,s,n)}}class E{constructor(t,e,i){this.owner=t,this.depth=e,this.prefix=i,this.updaters=[],this.leafs=[],this.elements=null,this.component=null}render(t){if(this.component)return D(this,this.component.__ast__,this.component.scope,t,null),void this.component.__render__();throw new Error("Render on non component?")}renderEnter(t,e,i){const s=i.ownerDocument.createDocumentFragment();D(this,t,e,s,null);const n=[];Array.from(s.children).forEach(t=>{t.classList&&t.classList.contains("m-animate")&&n.push(t)}),n.length&&n.forEach(t=>{t.classList.add("m-animating","m-enter-from");const e=new x;e.owner=this.owner;let i=0;Y(e.instance,"enter",{get(){0===i&&(t.classList.remove("m-enter-from"),t.classList.add("m-enter-to")),i++},notify:()=>{this.owner.rootNode.__dirty__.push([e,"enter",this.depth]),this.owner.asyncEvent(()=>{})()},keys:["owner.now"]});const s=i=>{i.target===t&&(W(e.instance,"enter"),t.classList.remove("m-animating","m-enter-to"),t.removeEventListener("transitionend",s))};t.addEventListener("transitionend",s,!1),this.owner.rootNode.__dirty__.push([e,"enter",this.depth]),this.owner.asyncEvent(()=>{})()}),i.parentNode.insertBefore(s,i)}notifyUnrender(){this.component&&(this.component.__unrender__(),this.component.__route__||this.component.dispose(),this.component=null)}unrender(t,e){let i=[];if(t&&(i=this.getElements()),t&&!e||(this.updaters.forEach(t=>W(t[0],t[1])),this.updaters=[]),this.component&&this.notifyUnrender(),this.leafs.forEach(t=>t.unrender()),this.leafs=[],t){const t=[];i.forEach(e=>{e.classList&&e.classList.contains("m-animate")?t.push(e):e.remove()}),t.length&&t.forEach(t=>{t.classList.add("m-animating","m-leave-from");const e=new x;e.owner=this.owner;let i=0;Y(e.instance,"leave",{get(){0===i&&(t.classList.remove("m-leave-from"),t.classList.add("m-leave-to")),i++},notify:()=>{this.owner.rootNode.__dirty__.push([e,"leave",this.depth]),this.owner.asyncEvent(()=>{})()},keys:["owner.now"]});const s=i=>{i.target===t&&(W(e.instance,"leave"),t.removeEventListener("transitionend",s),t.remove())};t.addEventListener("transitionend",s,!1),this.owner.rootNode.__dirty__.push([e,"leave",this.depth]),this.owner.asyncEvent(()=>{})()})}}getElements(){return this.elements?this.elements:(this.component&&console.assert(this.component.leaf===this),this.leafs.reduce((t,e)=>t.concat(e.getElements()),[]))}}const T=new WeakMap;class _ extends x{constructor(){super(),this.template="<span>This is the default component template</span>",this.inDOM=!1,this.__ast__=I((function(){return T[this.template]||(T[this.template]=this.template?H(this.template):[]),T[this.template]})),this.__oast__=null,this.__dirty__=null,this.__inDOM__=!1}init(){super.init(),this.scope.ctx=this}dispose(){console.assert(!this.__inDOM__,`component ${this.__oid__} should be unrenderd before dispose`),console.assert(!this.__component_disposed__,`component ${this.__oid__} was already disposed`),this.__component_disposed__=!0,super.dispose()}initializeLeaf(){this.__dirty__=[],this.leaf=new E(this.getOwner(),0,"watch"),this.leaf.component=this}__render__(){console.assert(!this.__inDOM__,`Element ${this.__oid__} should not be in DOM for render`),this.__inDOM__=!0,this.didInsertElement()}__unrender__(){console.assert(this.__inDOM__,`Element ${this.__oid__} should be in DOM for unrender`),this.willRemoveElement(),this.__inDOM__=!1}didInsertElement(){}willRemoveElement(){}getAst(){return this.__oast__}getElements(){return this.leaf.getElements()}getElement(){for(let t of this.leaf.getElements())if(1===t.nodeType)return t}update(){const t=this.__dirty__;this.__dirty__=[],t.sort((t,e)=>t[2]<e[2]?-1:1);for(let e=0,i=t.length;e<i;e++)t[e][0][t[e][1]]}}class Q extends _{constructor(){super(),this.scope=J.create(),this.__route__=!0}modelHook(){}redirect(){}error(){}loading(){}didEnter(){}didLeave(){}willTransition(){}transitionTo(t){this.getOwner().router.transitionTo(t)}}var U={"link-to":class extends _{constructor(){super(),this.template="<a href={{chref}} class={{cclass}}><yield-block/></a>",this.chref=I("href","__owner__.router.currentQuery",(function(){const t=this.__owner__.router.currentQuery;return`${window.location.pathname}${t?`?${t}`:""}#/${this.href}`})),this.cclass=I("__owner__.router.currentRoute","href",(function(){return`${this.class||""} ${this.getOwner().router.currentRoute===this.href?"active":""}`.trim()}))}},"delegate-component":class extends _{init(){super.init();const{attributes:t,content:e}=this.getAst();this.__ast__=[{type:"Component",name:this.component,attributes:t.map(t=>({name:t.name,value:{type:"Identifier",value:`ctx.${t.name}`}})),params:[],content:e}]}},"yield-block":class extends _{init(){super.init();const{content:t,params:e}=this.scope.parent.ctx.getAst();this.__ast__=t,this.scope.ctx=this.scope.parent.parent.ctx;let i=function(t,e,i){for(let s of t)if(s[e]===i)return s;return null}(this.getAst().attributes,"name","params");i&&(i="Invocation"===i.value.type?i.value.value:[i.value],console.assert(e.length==e.length,"Component yield parameters do not match"),e.forEach((t,e)=>{if("Literal"===i[e].type)this.scope[t]=i[e].value;else{const s=i[e].value;Y(this.scope.instance,t,{get:()=>this.scope.getPath(`parent.${s}`),set:null,keys:[`parent.${s}`]})}}))}}};function O(t,e){if(!t)throw new Error(e)}class K extends x{constructor(){super(),this.ilen=0,this.olen=0,this.ops=v.create()}static fromJSON(t){const e=this.create();for(let i of t)switch(i.t){case"n":e.retain(i.n);break;case"i":e.insert(i.i);break;case"r":e.remove(i.r);break;default:O(!1,"Unknown operation: "+JSON.stringify(i))}return e}toJSON(){return this.ops}isNoop(){const t=this.ops.length;return 0===t||1===t&&"n"===this.ops[0].t}retain(t){if(O("number"==typeof t&&t>=0,"Retain expects a positive integer."),t>0){this.ilen+=t,this.olen+=t;const e=this.ops,i=e[-1];i&&"n"===i.t?i.n+=t:e.push({t:"n",n:t})}return this}insert(t){if(O(t[Symbol.iterator],"Insert expects an iterable"),t.length){this.olen+=t.length;const e=this.ops,i=e[-1];if(i&&"i"===i.t)i.i=i.i.concat(Array.from(t));else if(i&&"r"===i.t){const i=e[-2];i&&"i"===i.t?i.i=i.i.concat(Array.from(t)):e.splice(e.length-1,0,{t:"i",i:Array.from(t)})}else e.push({t:"i",i:Array.from(t)})}return this}remove(t){if(O(t[Symbol.iterator],"Remove expects an iterable"),t.length){this.ilen+=t.length;var e=this.ops[-1];e&&"r"===e.t?e.r=e.r.concat(Array.from(t)):this.ops.push({t:"r",r:Array.from(t)})}return this}invert(){const t=this.constructor.create();for(let e of this.ops)"n"===e.t?t.retain(e.n):"i"===e.t?t.remove(e.i):t.insert(e.r);return t}apply(t){O(t.length===this.ilen,`Apply length mismatch ${t.length} !== ${this.ilen}`);let e=Array.from(t),i=[],s=0;for(let t of this.ops)"n"===t.t?(O(s+t.n<=e.length,"Input is too short."),i=i.concat(e.slice(s,s+t.n)),s+=t.n):"i"===t.t?i=i.concat(t.i):(O(!0,"Removal does not match content."),s+=t.r.length);return O(s===t.length,`Apply operation did not consume complete input. ${s} ${t.length} ${JSON.stringify(this.ops)}`),"string"==typeof t?i.join(""):t.constructor.from(i)}update(t){if(O(t.length===this.ilen,`Apply length mismatch ${t.length} !== ${this.ilen}`),t instanceof Array){let e=0;for(let i of this.ops)if("n"===i.t)O(e+i.n<=t.length,"Input is too short."),e+=i.n;else if("i"===i.t){let s=e,n=i.i.length;const l=4096;for(;n;)t.splice.apply(t,[s,0].concat(i.i.slice(s-e,s-e+l))),s+=l,n=n-l<0?0:n-l;e+=i.i.length}else O(!0,"Removal does not match content."),t.splice(e,i.r.length);return O(e===t.length,"Apply operation did not consume complete input."),t}return this.apply(t)}compose(t){O(this.olen===t.ilen,`Cannot compose due to length mismatch ${this.olen} !== ${t.ilen}.`);const e=this.ops,i=t.ops;let s=0,n=0,l=e[s++],r=i[n++];const a=this.constructor.create();for(;l||r;)l&&"r"===l.t?(a.remove(l.r),l=e[s++]):"i"===r.t?(a.insert(r.i),r=i[n++]):"n"===l.t?"n"===r.t?l.n>r.n?(a.retain(r.n),l={t:"n",n:l.n-r.n},r=i[n++]):l.n<r.n?(a.retain(l.n),r={t:"n",n:r.n-l.n},l=e[s++]):(a.retain(l.n),l=e[s++],r=i[n++]):l.n>r.r.length?(a.remove(r.r),l={t:"n",n:l.n-r.r.length},r=i[n++]):l.n<r.r.length?(a.remove(r.r.slice(0,l.n)),r={t:"r",r:r.r.slice(l.n)},l=e[s++]):(a.remove(r.r),l=e[s++],r=i[n++]):"n"===r.t?l.i.length>r.n?(a.insert(l.i.slice(0,r.n)),l={t:"i",i:l.i.slice(r.n)},r=i[n++]):l.i.length<r.n?(a.insert(l.i),r={t:"n",n:r.n-l.i.length},l=e[s++]):(a.insert(l.i),l=e[s++],r=i[n++]):l.i.length>r.r.length?(l={t:"i",i:l.i.slice(r.r.length)},r=i[n++]):l.i.length<r.r.length?(r={t:"r",r:r.r.slice(l.i.length)},l=e[s++]):(l=e[s++],r=i[n++]);return a}transform(t){O(this.ilen===t.ilen,"Both operations have to have the same base length");const e=this.ops,i=t.ops;let s=0,n=0,l=e[s++],r=i[n++];const a=this.constructor.create(),o=this.constructor.create();let c;for(;l||r;)l&&"i"===l.t?(a.insert(l.i),o.retain(l.i.length),l=e[s++]):r&&"i"===r.t?(a.retain(r.i.length),o.insert(r.i),r=i[n++]):"n"===l.t?"n"===r.t?(l.n>r.n?(c=r.n,l={t:"n",n:l.n-r.n},r=i[n++]):l.n<r.n?(c=l.n,r={t:"n",n:r.n-l.n},l=e[s++]):(c=r.n,l=e[s++],r=i[n++]),a.retain(c),o.retain(c)):(l.n>r.r.length?(c=r.r,l={t:"n",n:l.n-r.r.length},r=i[n++]):l.n<r.r.length?(c=r.r.slice(0,l.n),r={t:"r",r:r.r.slice(l.n)},l=e[s++]):(c=r.r,l=e[s++],r=i[n++]),o.remove(c)):"r"===r.t?l.r.length>r.r.length?(l={t:"r",r:l.r.slice(r.r.length)},r=i[n++]):l.r.length<r.r.length?(r={t:"r",r:r.r.slice(l.r.length)},l=e[s++]):(l=e[s++],r=i[n++]):(l.r.length>r.n?(c=l.r.slice(0,r.n),l={t:"r",r:l.r.slice(r.n)},r=i[n++]):l.r.length<r.n?(c=l.r,r={t:"n",n:r.n-l.r.length},l=e[s++]):(c=l.r,l=e[s++],r=i[n++]),a.remove(c));return[a,o]}}class $ extends Q{constructor(){super(),this.template="PHdpZGdldC13YWl0aW5nIGljb249Imxpc3QtcmljaCIgYWNsPXRydWUgdXNlcj17e2FwcC51c2VyfX0gZTQwMT0iU2lnbiBpbiB0byBhY2Nlc3MgZGV0YWlscyIgZTQwMz0iVXNlciB7e2FwcC51c2VyfX0gaXMgbm90IHBlcm1pdHRlZCB0byBhY2Nlc3MgZGV0YWlscyBmb3IgZGF0YXNldCB7e3BhcmFtcy5pZH19IiBlNDA0PSJEYXRhc2V0IHt7cGFyYW1zLmlkfX0gZG9lcyBub3QgZXhpc3QiPiA8d2lkZ2V0LW1vZGFsIG9wZW49e3tydW5SZXN9fSBzZXRPcGVuPXt7ImZuIiBjbG9zZVJ1bn19IHRpdGxlPSJEYXRhc2V0IG5vZGUgcnVuIiBhcz0idGFyZ2V0Ij4ge3sjaWYgKCJpcy1lcXVhbCIgdGFyZ2V0ICJib2R5Iil9fSA8ZGl2PiB7eyNpZiBydW5SZXMud2FpdGluZ319IHt7cnVuUmVzLndhaXRpbmd9fSB7e2Vsc2UgaWYgcnVuUmVzLmVycm9yc319IHt7cnVuUmVzLmVycm9yc319IHt7ZWxzZX19IHt7I2lmICgiaXMtZXF1YWwiIHJ1blJlcy5zdGF0dXMgMCl9fSA8ZGl2IGNsYXNzPSJ0ZXh0LXN1Y2Nlc3MiPlRoZSBub2RlIHJ1biBoYXMgc3VjY2Vzc2Z1bGx5IGZpbmlzaGVkLjwvZGl2PiB7e2Vsc2V9fSA8ZGl2PkFuIGVycm9yIG9jY3VyZWQgZHVyaW5nIHRoZSBub2RlIHJ1bjwvZGl2PiB7ey9pZn19IDxkaXY+UmF3IG91dHB1dCBvZiBjb21tYW5kOjwvZGl2PiA8cHJlPi0tLWJlZ2luLS0tPGJyPnt7cnVuUmVzLnN0ZG91dH19PGJyPnt7cnVuUmVzLnN0ZGVycn19PGJyPi0tLWVuZC0tLTwvcHJlPiB7ey9pZn19IDwvZGl2PiB7e2Vsc2V9fSA8YnV0dG9uIHR5cGU9ImNsb3NlIiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgiZm4iIGNsb3NlUnVuKX19PkNsb3NlPC9idXR0b24+IHt7L2lmfX0gPC93aWRnZXQtbW9kYWw+IDxkaXYgY2xhc3M9ImRldGFpbCI+IDxkaXYgY2xhc3M9ImJyZWFkY3J1bWJzIj4gPG9sIGNsYXNzPSJicmVhZGNydW1iIj4gPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0iPjxsaW5rLXRvIGhyZWY9ImNvbGxlY3Rpb24ve3ttb2RlbC5jb2xsZWN0aW9ufX0iPk92ZXJ2aWV3PC9saW5rLXRvPjwvbGk+IDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIGFjdGl2ZSI+e3ttb2RlbC50aXRsZX19PC9saT4gPC9vbD4ge3sjaWYgKCJpcy1lcXVhbCIgdHlwZSAiZGF0YXNldCIpfX0gPHNwYW4+IHt7I2lmIGFjbC50YWd9fSA8d2lkZ2V0LXRhZyBjbGFzcz0iYnRuIGJ0bi14cyBidG4tb3V0bGluZS1zZWNvbmRhcnkiIGRpc2FibGVkPXt7Im5vdCIgYXBwLnVzZXJ9fSB0YWdzPXt7bW9kZWwudGFnc319IGFsbHRhZ3M9e3ttb2RlbC5hbGxfa25vd25fdGFnc319IGFsdEFjdGlvbj17eyJmbiIgb3BlblNpZ25pbn19IGNoYW5nZUFjdGlvbj17eyJmbiIgcmV0YWd9fSBtZW51Q2xhc3M9ImRyb3Bkb3duLW1lbnUtcmlnaHQiIC8+IHt7L2lmfX0ge3sjaWYgYWNsLmNvbW1lbnR9fSA8d2lkZ2V0LWNvbW1lbnQgY2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBkaXNhYmxlZD17eyJub3QiIGFwcC51c2VyfX0gY2hhbmdlQWN0aW9uPXt7ImZuIiBYY29tbWVudH19IG1lbnVDbGFzcz0iZHJvcGRvd24tbWVudS1yaWdodCIgLz4ge3svaWZ9fSB7eyNpZiBhY2wuZG93bmxvYWRfcmF3fX0ge3sjaWYgbGlzdEZldGNoZWR9fSA8d2lkZ2V0LWNsaXBib2FyZCBjbGFzcz0iYnRuIGJ0bi14cyBidG4tb3V0bGluZS1zZWNvbmRhcnkiIG1vZGVsPXt7Y29weUZpbGVsaXN0fX0gLz4gPHdpZGdldC1jbGlwYm9hcmQgY2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBtb2RlbD17e2NvcHlVcmxsaXN0fX0gLz4ge3tlbHNlfX0gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImdldEZpbGVsaXN0Iil9fT4gZmV0Y2ggZmlsZSBsaXN0cyA8L2J1dHRvbj4ge3svaWZ9fSB7ey9pZn19IHt7I2lmIGFjbC5kZWxldGV9fSA8YnV0dG9uLWNvbmZpcm0gYnV0dG9uQ2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBhY3Rpb25CdXR0b25DbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLWRhbmdlciIgdGl0bGU9IkRpc2NhcmQgZGF0YXNldCIgdGV4dD0iQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIG1hcmsgZGF0YXNldCB7e3BhcmFtcy5pZH19IGZvciBkZWxldGlvbj8gSWYgdGhlIGNvcnJlc3BvbmRpbmcgZmlsZXMgc3RpbGwgZXhpc3RzIG9uIGRpc2ssIHRoZXkgd291bGQgYmUgcmUtYWRkZWQgYXMgbmV3IGRhdGFzZXQgZHVyaW5nIHRoZSBuZXh0IHNjYW4uIFRoZSBkaXNjYXJkZWQgZGF0YXNldCB3b3VsZCBiZSBkZWxldGVkIGR1cmluZyB0aGUgbmV4dCBjbGVhbnVwIGFuZCBpdHMgdGFncyBhbmQgY29tbWVudHMgd291bGQgYmUgSVJSRVZPQ0FCTFkgZ29uZS4iIGFjdGlvbj17eyJmbiIgZGVsZXRlfX0gY29uZmlybVRleHQ9IkRpc2NhcmQgZGF0YXNldCI+IERpc2NhcmQgZGF0YXNldCA8L2J1dHRvbi1jb25maXJtPiA8IS0tYnV0dG9uIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIge3siYWN0aW9uIiAoImZuIiBydW5Ob2Rlcyl9fT5SdW4gbm9kZXM8L2J1dHRvbi0tPiB7ey9pZn19IDwvc3Bhbj4ge3svaWZ9fSA8L2Rpdj4gPG0taHNjcm9sbD4gPHVsIGNsYXNzPSJuYXYgbmF2LXRhYnMiPiB7eyNpZiBtb2RlbC5zdW1tYXJ5fX0gPGxpIGNsYXNzPSJuYXYtaXRlbSI+PGEgaHJlZj0iIyIgY2xhc3M9Im5hdi1saW5rIHt7ImlmIiAoImlzLWVxdWFsIiB0YWJpbmRleCAic3VtbWFyeSIpICJhY3RpdmUifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInNldHRhYiIgInN1bW1hcnkiKX19PlN1bW1hcnk8L2E+PC9saT4ge3svaWZ9fSB7eyNlYWNoIG1vZGVsLnNlY3Rpb25zIGFzIHxzZWN0aW9uIGluZGV4fH19IDxsaSBjbGFzcz0ibmF2LWl0ZW0iPjxhIGhyZWY9IiMiIGNsYXNzPSJuYXYtbGluayB7eyJpZiIgKCJpcy1lcXVhbCIgdGFiaW5kZXggaW5kZXgpICJhY3RpdmUifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInNldHRhYiIgaW5kZXgpfX0+e3tzZWN0aW9uLnRpdGxlfX08L2E+PC9saT4ge3svZWFjaH19IDwvdWw+IDwvbS1oc2Nyb2xsPiA8ZGl2IGNsYXNzPSJjYXJkIj4gPGRpdiBjbGFzcz0iY2FyZC1ib2R5IHRhYi1jb250ZW50Ij4ge3sjaWYgbW9kZWwuc3VtbWFyeX19IDxkaXYgcm9sZT0idGFicGFuZWwiIGNsYXNzPSJ0YWItcGFuZSB7eyJpZiIgKCJpcy1lcXVhbCIgdGFiaW5kZXggInN1bW1hcnkiKSAiYWN0aXZlIn19Ij4gPGRpdiBjbGFzcz0ieGNhcmQiPiA8ZGl2IGNsYXNzPSJ4Y2FyZC1ib2R5Ij4ge3sjZWFjaCBtb2RlbC5zdW1tYXJ5LndpZGdldHMgYXMgfHdpZGdldHx9fSA8ZGl2IGNsYXNzPSJjYXJkIHdpZGdldC1jb250YWluZXIiPiA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPiA8aDM+e3t3aWRnZXQuY2FwdGlvbn19PC9oMz4gPHdpZGdldC1sb2FkZXIgbW9kZWw9e3t3aWRnZXR9fSAvPiA8L2Rpdj4gPC9kaXY+IHt7L2VhY2h9fSA8aHIgLz4gPGRpdj4gVGFnZ2VkIDx1bCBjbGFzcz0ibGlzdC1pbmxpbmUgdGFnZ2VkIj57eyNlYWNoIG1vZGVsLnRhZ3MgYXMgfHRhZ3x9fTxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+PHNwYW4gY2xhc3M9ImJhZGdlIj57e3RhZ319PC9zcGFuPjwvbGk+e3svZWFjaH19PC91bD4ge3sjaWYgYWNsLnRhZ319IDx3aWRnZXQtdGFnIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgZGlzYWJsZWQ9e3sibm90IiBhcHAudXNlcn19IHRhZ3M9e3ttb2RlbC50YWdzfX0gYWxsdGFncz17e21vZGVsLmFsbF9rbm93bl90YWdzfX0gYWx0QWN0aW9uPXt7ImZuIiBvcGVuU2lnbmlufX0gY2hhbmdlQWN0aW9uPXt7ImZuIiByZXRhZ319IC8+IHt7L2lmfX0gPC9kaXY+IDxociAvPiB7eyNlYWNoIG1vZGVsLmNvbW1lbnRzIGFzIHxjb21tZW50fH19IDxkaXYgY2xhc3M9ImNvbW1lbnQgY2FyZCI+IDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIj4gPHN0cm9uZz57e2NvbW1lbnQuYXV0aG9yfX08L3N0cm9uZz4gY29tbWVudGVkIDx0aW1lIGRhdGV0aW1lPSJ7e2NvbW1lbnQudGltZUFkZGVkfX0iIGlzPSJyZWxhdGl2ZS10aW1lIiB0aXRsZT0ie3tjb21tZW50LnRpbWVBZGRlZH19IiA+e3soInByaW50LXJlbGF0aW1lIiBjb21tZW50LnRpbWVBZGRlZCl9fTwvdGltZT4gPC9kaXY+IDxkaXYgY2xhc3M9ImNvbW1lbnQtY29udGVudCBjYXJkLWJvZHkiPiB7e2NvbW1lbnQudGV4dH19IDwvZGl2PiA8L2Rpdj4ge3svZWFjaH19IHt7I2lmIGFjbC5jb21tZW50fX0gPGRpdiBjbGFzcz0iY29tbWVudCBjYXJkIj4gPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4gPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+IHt7I2lmIGFwcC51c2VyfX0gPGlucHV0LXRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJMZWF2ZSBhIGNvbW1lbnQiIHZhbHVlPXt7Y29tbWVudH19IHJvd3M9NSBjaGFuZ2VBY3Rpb249e3siY3VycnkiICgibm9leHBhbmQiICgic2V0IiAoIm5vZXhwYW5kIiBjb21tZW50KSkpfX0gLz4ge3tlbHNlfX0gPGlucHV0LXRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJTaWduIGluIHRvIGNvbW1lbnQiIHZhbHVlPXt7Y29tbWVudH19IHJvd3M9NSBjaGFuZ2VBY3Rpb249e3siY3VycnkiICgibm9leHBhbmQiICgic2V0IiAoIm5vZXhwYW5kIiBjb21tZW50KSkpfX0gZGlzYWJsZWQ9ImRpc2FibGVkIiAvPiB7ey9pZn19IDwvZGl2PiB7eyNpZiBhcHAudXNlcn19IDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAic2F2ZUNvbW1lbnQiKX19PiBDb21tZW50IDwvYnV0dG9uPiB7ey9pZn19IDwvZGl2PiA8L2Rpdj4ge3svaWZ9fSA8L2Rpdj4gPC9kaXY+IDwvZGl2PiB7ey9pZn19IHt7I2VhY2ggbW9kZWwuc2VjdGlvbnMgYXMgfHNlY3Rpb24gaW5kZXh8fX0gPGRpdiByb2xlPSJ0YWJwYW5lbCIgY2xhc3M9InRhYi1wYW5lIHt7ImlmIiAoImlzLWVxdWFsIiB0YWJpbmRleCBpbmRleCkgImFjdGl2ZSJ9fSI+IHt7I2lmICgiaXMtZXF1YWwiIHRhYmluZGV4IGluZGV4KX19IHt7I2lmICgiaXMtZ3JlYXRlciIgc2VjdGlvbi53aWRnZXRzLmxlbmd0aCAxKX19IHt7I2VhY2ggc2VjdGlvbi53aWRnZXRzIGFzIHx3aWRnZXR8fX0gPGRpdiBjbGFzcz0ieGNhcmQgd2lkZ2V0LWNvbnRhaW5lciI+IDxkaXYgY2xhc3M9InhjYXJkLWJvZHkiPiB7eyNpZiB3aWRnZXQuY2FwdGlvbn19IDxoMz57e3dpZGdldC5jYXB0aW9ufX08L2gzPiB7ey9pZn19IDx3aWRnZXQtbG9hZGVyIG1vZGVsPXt7d2lkZ2V0fX0gLz4gPC9kaXY+IDwvZGl2PiB7ey9lYWNofX0ge3tlbHNlfX0ge3sjaWYgc2VjdGlvbi53aWRnZXRzLjAuY2FwdGlvbn19IDxoMz57e3NlY3Rpb24ud2lkZ2V0cy4wLmNhcHRpb259fTwvaDM+IHt7L2lmfX0gPHdpZGdldC1sb2FkZXIgbW9kZWw9e3tzZWN0aW9uLndpZGdldHMuMH19IC8+IHt7L2lmfX0ge3svaWZ9fSA8L2Rpdj4ge3svZWFjaH19IDwvZGl2PiA8L2Rpdj4gPC9kaXY+IDwvd2lkZ2V0LXdhaXRpbmc+",this.type="dataset",this.app=I((function(){return this.getOwner().lookup("application-route")})),this.comment="",this.modelId=null,this.model=I("params","app.user",(async function(){const{id:t}=this.params,e=await this.app.api({url:`${this.type}/${t}`});return this.baseurl="marv/api/dataset"+("dataset"===this.type?`/${t}`:""),document.title=`MARV > ${"dataset"===this.type?t.slice(0,10):this.type}`,this.rebaseUrls(e),this.app.activeCollection=e.collection,this.modelId!==t&&(this.tabindex=e.summary?"summary":0,this.modelId=t),e.comments=v.create(e.comments),e.tags=v.create(e.tags),this.listFetched=!1,x.create(e)})),this.acl=I("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach(e=>t[e.replace("-","_")]=!0),t}))}getFilelist(){this.app.getFilelist([this.model.id]).then(t=>{this.copyFilelist={data:t.paths.join("\n"),title:"file paths"},this.copyUrllist={data:t.urls.map(t=>`${this.app.apiEndpoint}${t}`).join("\n"),title:"URLs"},this.listFetched=!0})}toggleControls(){this.controlsOpen=!this.controlsOpen}saveComment(){this.comment&&(this.app.comment({[this.model.id]:{add:[this.comment]}}).then(()=>this.reloadModel()),this.comment="")}settab(t,e){this.tabindex=t,e.preventDefault()}openSignin(){this.app.openSignin()}retag(t){const e={},i={};t.added.forEach(t=>e[t]=[this.model.id]),t.removed.forEach(t=>i[t]=[this.model.id]),this.app.tag({[this.model.collection]:{add:e,remove:i}}).then(()=>this.reloadModel())}Xcomment(t){this.app.comment({[this.model.id]:{add:[t]}}).then(()=>this.reloadModel())}delete(){this.app.delete([this.model.id]).then(()=>{this.getOwner().lookup("collection-route").reloadModel(),this.transitionTo({route:"index"})})}async runNodes(){this.runRes={waiting:"Waiting for node run to complete"},this.runRes=await this.app.api({url:"v1/trigger",method:["POST"],data:{action:"run",setid:this.params.id}})}closeRun(){this.runRes&&0===this.runRes.status&&this.reloadModel(),this.runRes=!1}rebaseUrls(t){const e=(t.summary?[t.summary]:[]).concat(t.sections),{sessionid:i}=this.app,s=i?`?access_token=${i}`:"",n=t=>{t.forEach(t=>{t.data&&("image"===t.type?/^data:/.test(t.data.src)||(t.data.src=`${this.baseurl}/${t.data.src}${s}`):"gallery"===t.type?t.data.images.forEach(t=>{/^data:/.test(t.src)||(t.src=`${this.baseurl}/${t.src}${s}`)}):"table"===t.type?t.data.columns.forEach((e,i)=>{"rellink"===e.formatter&&(e.formatter="link",t.data.rows.forEach(t=>{/^data:/.test(t.values[i].href)||(t.values[i].href=`${this.baseurl}/${t.values[i].href}${s}`)}))}):"video"===t.type?/^data:/.test(t.data.src)||(t.data.src=`${this.baseurl}/${t.data.src}${s}`):"dropdown"===t.type&&n(t.data.widgets))})};e.forEach(t=>n(t.widgets))}modelHook(t){this.app.lastDetailHash=location.hash,this.params=t}reloadModel(){this.params={id:this.params.id},this.getOwner().lookup("collection-route").reloadModel()}}function q(){return Array.from({length:16},(t,e)=>33825>>e&1)}function tt(t,e,i,s){const n=Math.tan(.5*(Math.PI-t)),l=1/(i-s);return[n/e,0,0,0,0,n,0,0,0,0,(i+s)*l,-1,0,0,i*s*l*2,0]}function et(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}function it(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}function st(t,e){const[i,s,n,l,r,a,o,c,h,d,u,m,I,g,b,p]=t,[f,G,Z,Y,y,W,X,w,v,N,x,B,C,L,R,j]=e;return[f*i+G*r+Z*h+Y*I,f*s+G*a+Z*d+Y*g,f*n+G*o+Z*u+Y*b,f*l+G*c+Z*m+Y*p,y*i+W*r+X*h+w*I,y*s+W*a+X*d+w*g,y*n+W*o+X*u+w*b,y*l+W*c+X*m+w*p,v*i+N*r+x*h+B*I,v*s+N*a+x*d+B*g,v*n+N*o+x*u+B*b,v*l+N*c+x*m+B*p,C*i+L*r+R*h+j*I,C*s+L*a+R*d+j*g,C*n+L*o+R*u+j*b,C*l+L*c+R*m+j*p]}function nt(t,e){const[i,s,n]=t,[l,r,a]=e;return[s*a-n*r,n*l-i*a,i*r-s*l]}function lt(t){const[e,i,s]=t;var n=(e**2+i**2+s**2)**.5;return n>1e-5?[e/n,i/n,s/n]:[0,0,0]}function rt(t,e,i){const s=lt((l=t,[(n=e)[0]-l[0],n[1]-l[1],n[2]-l[2]]));var n,l;const r=lt(nt(s,i)),a=lt(nt(r,s));return st([r[0],a[0],-s[0],0,r[1],a[1],-s[1],0,r[2],a[2],-s[2],0,0,0,0,1],et(-t[0],-t[1],-t[2]))}function at(t,e,i){/^#/.test(i)||(i=atob(i));const s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(`Error compiling "${i}" -- "${t.getShaderInfoLog(s)}"`);return s}function ot(t,e,i,s,n){const l=t.createProgram();if(t.attachShader(l,at(t,t.VERTEX_SHADER,e)),t.attachShader(l,at(t,t.FRAGMENT_SHADER,i)),t.linkProgram(l),!t.getProgramParameter(l,t.LINK_STATUS))throw new Error(`Error linking "${e+i}" -- "${t.getProgramInfoLog(l)}"`);return l}class ct extends _{constructor(){super(),this.template="PGNhbnZhcz48eWllbGQtYmxvY2sgcGFyYW1zPXt7Z2wgYWRkIHJlbW92ZSB3b3JsZH19IC8+e3tnbHlSZW5kZXJ9fTwvY2FudmFzPg==",this.children=v.create(),this.add=t=>this.children.push(t),this.remove=t=>this.children.splice(this.children.indexOf(t),1),this.width=0,this.height=0,this.gl=I((function(){const t=this.getElement().querySelector("canvas"),e={};let i=t.getContext("webgl2",e)||t.getContext("experimental-webgl2",e);if(!i){if(!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e))){const e=t.getContext("2d");return t.width=t.clientWidth,t.height=t.clientHeight,e.font="48px serif",e.fillText("No WebGL 1.0 support detected",50,50,t.width-200),null}i.shaderSource=(t,e)=>(e=e.replace(/#version 300 es/,""),e=/precision/.test(e)?e.replace(/^ *in /gm,"varying ").replace(/^ *out [^;]*;/gm,"").replace(/outColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("):e.replace(/^ *in /gm,"attribute ").replace(/^ *out /gm,"varying "),WebGLRenderingContext.prototype.shaderSource.call(i,t,e));const s=i.getExtension("OES_vertex_array_object");i.bindVertexArray=(...t)=>s.bindVertexArrayOES(...t),i.createVertexArray=(...t)=>s.createVertexArrayOES(...t)}return i})),this.dirty=I("world","localDirty","children.@each.dirty",(function(){return this.oldWorld!==this.world?(this.oldWorld=this.world,!0):!!this.localDirty||this.children.some(t=>t.dirty)})),this.glyRender=I("__owner__.now","world",(function(){this.gl&&(this.resize(),this.dirty&&this.animate())})),this.clearColor=I("model.bgcolor",(function(){const t=this.model&&this.model.bgcolor;if(t&&t.length){if("string"==typeof t){const e=parseInt(t.slice(1),16);return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]}return t.map(t=>t/255)}return[0,0,0,1]})),this.world=q()}init(){super.init(),this.resizeCb=this.getOwner().asyncEvent(()=>this.resize())}resize(){if(!this.gl)return;const t=this.gl.canvas,e=window.devicePixelRatio,i=t.clientWidth*e,s=t.clientHeight*e;t.width===i&&t.height===s||(this.width=t.width=i,this.height=t.height=s)}animate(){const{gl:t}=this;t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(...this.clearColor),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);const e=this.getOwner().now;this.glRender(e),this.localDirty=!1,this.children.forEach(t=>{t.glRender(e),t.dirty=!1}),this.dirty=!1}glRender(){}didInsertElement(){this.gl&&(this.getOwner().addAfterRender(()=>this.resize()),window.addEventListener("resize",this.resizeCb),function(t){const e=t.getOwner(),i=t.gl.canvas;let s=!1,n=!1;const l=e.asyncEvent(e=>{if(!s){const{clientX:i,clientY:s}=e,{x:n,y:l,width:r,height:a}=e.target.getClientRects()[0];t.mousemove(i-n-r/2,s-l-a/2)}});i.addEventListener("mousemove",l);const r=e.asyncEvent(l=>{if(0!==l.button)return;s=!0,n=!1;let r=l.clientX,a=l.clientY;const o=e.asyncEvent(e=>{const i=e.clientX-r,s=e.clientY-a;r=e.clientX,a=e.clientY,n=!0,t.panAndZoom(i,-s,0)}),c=e.asyncEvent(e=>{if(i.removeEventListener("mousemove",o),document.removeEventListener("mouseup",c),s=!1,!n){const{clientX:i,clientY:s}=e,{x:n,y:l,width:r,height:a}=e.target.getClientRects()[0];t.click(i-n-r/2,s-l-a/2)}});i.addEventListener("mousemove",o),document.addEventListener("mouseup",c),l.stopPropagation(),l.preventDefault()});i.addEventListener("mousedown",r);const a=e.asyncEvent(e=>{const s=(i.clientWidth>>1)-e.offsetX,n=(i.clientHeight>>1)-e.offsetY;t.panAndZoom(s,-n,e.deltaY<0?-1:1),e.stopPropagation(),e.preventDefault()});i.addEventListener("wheel",a)}(this))}willRemoveElement(){this.gl&&(window.removeEventListener("resize",this.resizeCb),cancelAnimationFrame(this.reqid))}mousemove(){}click(){}}class ht extends x{init(){super.init(),this.stack=[],this.currentTransition=null,this.currentRoute=null}locationToPath(){if("object"!=typeof window)return{query:null,path:null};const t={},e=window.location.search.substr(1).split("&").filter(t=>t);for(let i=0,s=e.length;i<s;i++){const s=e[i],n=s.substr(0,s.indexOf("=")),l=s.slice(n.length+1);t[n]=l}let i=window.location.hash;return"#"===i[0]&&(i=i.slice(1)),{query:t,path:i}}pathToStack({path:t,query:e}){const i=t.split("/").filter(t=>!!t.length),s=(t,i)=>{return i.map(i=>{const n=t.slice(0),l=("string"==typeof i.path?i.path:i.name).split("/"),r={};let a=0;for(let s=0,o=l.length;s<o;s++){let o=l[s];if(""!==o){if(a*=10,"*"===o[0])return a+=3,a*=Math.pow(10,t.length-1),r[o.slice(1)]=n.join("/"),{score:a,stack:[{route:i,dynamics:r,query:e}]};if(":"===o[0])a+=2,r[o.slice(1)]=n.shift();else{if(o!==n[0])return{score:1/0};a+=1,n.shift()}}}const o=s(n,i.routes||[])||{score:1/0};return o.score!==1/0?(a*=Math.pow(10,n.length),{score:a+=o.score,stack:[{route:i,dynamics:r,query:e}].concat(o.stack)}):n.length?o:{score:a,stack:[{route:i,dynamics:r,query:e}]}}).sort((t,e)=>t.score-e.score)[0]};return s(i,this.routes).stack}async performTransition(t){const e=(t,e)=>{if(t.route!=e.route)return!1;if(t.model&&t.model!=e.model)return!1;console.assert(Object.keys(t.dynamics).length===Object.keys(e.dynamics).length);for(let[i,s]of Object.entries(t.dynamics))if(s!==e.dynamics[i])return!1;for(let[i,s]of Object.entries(t.route.queryParams||{}))if(s.refreshModel&&t.query[i]!==e.query[i])return!1;return!0};let i=0;for(;t[i]&&this.stack[i]&&e(t[i],this.stack[i]);)i++;const s=t=>`${this.stack.slice(0,t+1).map(t=>t.route.name).join("-")}-route`,n=e=>`${t.slice(0,e+1).map(t=>t.route.name).join("-")}-route`,l={aborted:!1,abort(){this.aborted=!0},stack:t};for(let t=this.stack.length-1;t>=i;t--){const e=this.stack[t];if(this.getOwner().lookup(`${e.route.name}-route`).willTransition(l),l.aborted)return}for(let e=0;e<i;e++){const i=this.getOwner().lookup(n(e));for(let s of Object.keys(t[e].route.queryParams||{}))i[s]=t[e].query[s]}for(let e=i;e<t.length;e++){const i=t[e],s=this.getOwner().lookup(n(e));for(let t of Object.keys(i.route.queryParams||{}))s[t]=i.query[t];i.model&&!i.model.fake||(i.model=await s.modelHook(i.dynamics))}for(let t=this.stack.length-1;t>=i;t--){const e=this.getOwner().lookup(s(t));let n;this.stack.pop(),(n=0===i?this.getOwner().lookup("application-route"):this.getOwner().lookup(s(t-1))).outlet=null,n.getOwner().update(),e.didLeave()}for(;i<t.length;i++){this.stack[i]=t[i];const e=this.getOwner().lookup(s(i));let n;t[i].model&&(e.model=t[i].model),(n=0===i?this.getOwner().lookup("application-route"):this.getOwner().lookup(s(i-1))).outlet=e,n.getOwner().update(),e.didEnter()}this.currentQuery=Object.entries(this.stack[0].query).map(([t,e])=>`${t}=${e.replace(/&/,"%26")}`).join("&"),this.currentRoute=this.stack.map(t=>t.route.name).join(".")}updateFromLocation(){return this.performTransition(this.pathToStack(this.locationToPath()))}stackToLocation(t){const e=[];for(let i of Object.entries(t[0].query))e.push(`${i[0]}=${i[1].replace(/&/,"%26")}`);let i="";return e.length&&(i+=`?${e.join("&")}`),i+"#/"+t.map(t=>void 0!==t.route.path?t.route.path:t.route.name).map((e,i)=>e.split("/").map(e=>":"===e[0]?t[i].dynamics[e.slice(1)]:e)).reduce((t,e)=>t.concat(e),[]).filter(t=>t).join("/")}async transitionTo({route:t,models:e,query:i}){t=t||this.currentRoute,e=e||[],i=Object.assign(this.locationToPath().query,i);const s=t.split(".");for(;e.length<s.length;)e.unshift(void 0);const n=[];let l=this.routes;for(let t=0,r=s.length;t<r;t++){const r=l.filter(e=>e.name===s[t])[0];l=r.routes;const a=e[t],o={};Object.assign(o,this.stack[t].route===r&&this.stack[t].dynamics),(void 0!==r.path?r.path:r.name).split("/").forEach(t=>{a&&":"===t[0]&&(o[t.slice(1)]=a[t.slice(1)])}),n.push({route:r,dynamics:o,query:i,model:a})}this.__ff45__=await this.performTransition(n),window.history.pushState(null,null,this.stackToLocation(n))}}const dt=32,ut=7,mt=256;function It(t,e,i,s){let n=e+1;if(n===i)return 1;if(s(t[n++],t[e])<0){for(;n<i&&s(t[n],t[n-1])<0;)n++;!function(t,e,i){for(i--;e<i;){const s=t[e];t[e++]=t[i],t[i--]=s}}(t,e,n)}else for(;n<i&&s(t[n],t[n-1])>=0;)n++;return n-e}function gt(t,e,i,s,n){for(s===e&&s++;s<i;s++){let i=t[s],l=e,r=s;for(;l<r;){const e=l+r>>>1;n(i,t[e])<0?r=e:l=e+1}let a=s-l;switch(a){case 4:t[l+4]=t[l+3];case 3:t[l+3]=t[l+2];case 2:t[l+2]=t[l+1];case 1:t[l+1]=t[l];break;default:for(;a>0;)t[l+a]=t[l+a-1],a--}t[l]=i}}function bt(t,e,i,s,n,l){let r=0,a=0,o=1;if(l(t,e[i+n])>0){for(a=s-n;o<a&&l(t,e[i+n+o])>0;)r=o,(o=1+(o<<1))<=0&&(o=a);o>a&&(o=a),r+=n,o+=n}else{for(a=n+1;o<a&&l(t,e[i+n-o])<=0;)r=o,(o=1+(o<<1))<=0&&(o=a);o>a&&(o=a);const s=r;r=n-o,o=n-s}for(r++;r<o;){const s=r+(o-r>>>1);l(t,e[i+s])>0?r=s+1:o=s}return o}function pt(t,e,i,s,n,l){let r=0,a=0,o=1;if(l(t,e[i+n])<0){for(a=n+1;o<a&&l(t,e[i+n-o])<0;)r=o,(o=1+(o<<1))<=0&&(o=a);o>a&&(o=a);const s=r;r=n-o,o=n-s}else{for(a=s-n;o<a&&l(t,e[i+n+o])>=0;)r=o,(o=1+(o<<1))<=0&&(o=a);o>a&&(o=a),r+=n,o+=n}for(r++;r<o;){const s=r+(o-r>>>1);l(t,e[i+s])<0?o=s:r=s+1}return o}class ft{constructor(t,e){this.array=t,this.compare=e;const i=this.length=t.length;this.minGallop=ut;const s=i<2*mt?i>>>1:mt;this.tmp=new Array(s),this.stackSize=0;const n=this.length<120?5:this.length<1542?10:this.length<119151?19:40;this.runStart=new Array(n),this.runLength=new Array(n)}pushRun(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}}forceMergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}}mergeAt(t){let e=this.compare,i=this.array,s=this.runStart[t],n=this.runLength[t],l=this.runStart[t+1],r=this.runLength[t+1];this.runLength[t]=n+r,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;let a=pt(i[l],i,s,n,0,e);s+=a,0!==(n-=a)&&0!==(r=bt(i[s+n-1],i,l,r,r-1,e))&&(n<=r?this.mergeLow(s,n,l,r):this.mergeHigh(s,n,l,r))}mergeLow(t,e,i,s){let n=this.compare,l=this.array,r=this.tmp;for(let i=0;i<e;i++)r[i]=l[t+i];let a=0,o=i,c=t;if(l[c++]=l[o++],0==--s){for(let t=0;t<e;t++)l[c+t]=r[a+t];return}if(1===e){for(let t=0;t<s;t++)l[c+t]=l[o+t];return void(l[c+s]=r[a])}let h=this.minGallop;for(;;){let t=0,i=0,d=!1;do{if(n(l[o],r[a])<0){if(l[c++]=l[o++],i++,t=0,0==--s){d=!0;break}}else if(l[c++]=r[a++],t++,i=0,1==--e){d=!0;break}}while((t|i)<h);if(d)break;do{if(0!==(t=pt(l[o],r,a,e,0,n))){for(let e=0;e<t;e++)l[c+e]=r[a+e];if(c+=t,a+=t,(e-=t)<=1){d=!0;break}}if(l[c++]=l[o++],0==--s){d=!0;break}if(0!==(i=bt(r[a],l,o,s,0,n))){for(let t=0;t<i;t++)l[c+t]=l[o+t];if(c+=i,o+=i,0===(s-=i)){d=!0;break}}if(l[c++]=r[a++],1==--e){d=!0;break}h--}while(t>=ut||i>=ut);if(d)break;h<0&&(h=0),h+=2}if(this.minGallop=h<1?1:h,1===e){for(let t=0;t<s;t++)l[c+t]=l[o+t];l[c+s]=r[a]}else{if(0===e)throw new Error("Comparison method violates conditions");for(let t=0;t<e;t++)l[c+t]=r[a+t]}}mergeHigh(t,e,i,s){let n=this.compare,l=this.array,r=this.tmp;for(let t=0;t<s;t++)r[t]=l[i+t];let a=t+e-1,o=s-1,c=i+s-1,h=0,d=0;if(l[c--]=l[a--],0==--e){h=c-(s-1);for(let t=0;t<s;t++)l[h+t]=r[t];return}if(1===s){d=(c-=e)+1,h=(a-=e)+1;for(let t=e-1;t>=0;t--)l[d+t]=l[h+t];return void(l[c]=r[o])}let u=this.minGallop;for(;;){let i=0,m=0,I=!1;do{if(n(r[o],l[a])<0){if(l[c--]=l[a--],i++,m=0,0==--e){I=!0;break}}else if(l[c--]=r[o--],m++,i=0,1==--s){I=!0;break}}while((i|m)<u);if(I)break;do{if(0!==(i=e-pt(r[o],l,t,e,e-1,n))){e-=i,d=(c-=i)+1,h=(a-=i)+1;for(let t=i-1;t>=0;t--)l[d+t]=l[h+t];if(0===e){I=!0;break}}if(l[c--]=r[o--],1==--s){I=!0;break}if(0!==(m=s-bt(l[a],r,0,s,s-1,n))){s-=m,d=(c-=m)+1,h=(o-=m)+1;for(let t=0;t<m;t++)l[d+t]=r[h+t];if(s<=1){I=!0;break}}if(l[c--]=l[a--],0==--e){I=!0;break}u--}while(i>=ut||m>=ut);if(I)break;u<0&&(u=0),u+=2}if(this.minGallop=u<1?1:u,1===s){d=(c-=e)+1,h=(a-=e)+1;for(let t=e-1;t>=0;t--)l[d+t]=l[h+t];l[c]=r[o]}else{if(0===s)throw new Error("Comparison method violates conditions");h=c-(s-1);for(let t=0;t<s;t++)l[h+t]=r[t]}}}function Gt(t,e,i,s){i||(i=0),s||(s=t.length);let n=s-i;if(n<2)return;let l=0;if(n<dt)return void gt(t,i,s,i+(l=It(t,i,s,e)),e);const r=new ft(t,e),a=function(t){let e=0;for(;t>=dt;)e|=1&t,t>>=1;return t+e}(n);do{if((l=It(t,i,s,e))<a){const s=n<=a?n:a;gt(t,i,i+s,i+l,e),l=s}r.pushRun(i,l),r.mergeRuns(),i+=l,n-=l}while(0!==n);r.forceMergeRuns()}function Zt(t,e,i,s){for(;i<s;){const n=i+s>>>1;t[n]<e?i=n+1:s=n}return i}function Yt(t,e,i,s){for(;i<s;){const n=i+s>>>1;t[n]<=e?i=n+1:s=n}return i}function yt(t){return[0,t.length]}function Wt(t,e){const i=new Array(e.length);for(let s=0,n=e.length;s<n;s++)i[s]=t[e[s]];return i}class Xt extends x{constructor(t,e=32){super(),console.assert(e<=32,"no support for wide matrix"),this.data=new Uint32Array(t),this.gen=0}extend(t){const e=new Uint32Array(this.data.length+t);e.set(this.data),this.data=e}clear(t){const e=~(1<<t);for(let t=0,i=this.data.length;t<i;t++)this.data[t]&=e;this.gen++}isIn(t,e=-1){return!(this.data[t]&e)}update(t){this.data=t.update(this.data),this.gen++}subarray(t){const e=1<<t,i=~e;return{pos:e,neg:i,set:(t,s)=>{s?this.data[t]|=e:this.data[t]&=i,this.gen++},isIn:t=>this.isIn(t),isGIn:t=>!(this.data[t]&i)}}}class wt{constructor(t){return new Uint32Array(t||0)}}const vt=[t=>t+1,t=>t-1,()=>0];class Nt extends x{constructor(){super(),this.reduceFn=vt,this.orderFn=t=>t,this.linear=v.create(),this.count=[],this.acount=[],this.state=[],this.pending=new K,Y(this.instance,"faux",{keys:["dim.lastUpdate"],notify:(t,e,i,s)=>{this.faux,"lastUpdate"===e&&(this.pending=this.pending.compose(s))},get(){}}),this.faux,this.groups=I("pending","dim.xf.filters.gen",(function(){const t=this.pending;this.pending=(new K).retain(t.olen);const e=this.dim.rows,i=this.linear,s=(t,e)=>{const s=this.dim.rowIndex[t],n=this.state[t]<<1|(this.state[t]=this.dim.filters.isGIn(s)),l=i[e];2===n?(l.value=this.reduceFn[1](l.value,this.dim.xf.data[s]),this.count[e]--):1===n&&(l.value=this.reduceFn[0](l.value,this.dim.xf.data[s]),this.count[e]++)},n=(t,e)=>{const i=typeof t;return i===typeof e?t<e:t===xt||e!==xt&&("string"===i||void 0)},l=(t,e)=>"object"==typeof t?+t!=+e:t!==e;let r=0,a=0;for(let o of t.ops)if("n"===o.t)for(let t=0,l=o.n;t<l;t++){const t=this.mapFn(e[r]);for(;n(i[a].key,t);)a++;s(r++,a)}else if("i"===o.t){this.state.splice.apply(this.state,[r,0].concat(o.i.map(()=>!0)));let t,c,h=i.length;for(let d=0,u=o.i.length;d<u;d++){if(l(t,e[r])){t=e[r];const s=this.mapFn(e[r]);for(;a<h&&n(i[a].key,s);)a++;(c=i[a])&&!l(s,c.key)||(c=x.create({key:s,value:this.reduceFn[2]()}),i.splice(a,0,c),h=i.length,this.count.splice(a,0,0),this.acount.splice(a,0,0),console.assert(c===i[a],"added group does not match"))}c.value=this.reduceFn[0](c.value,this.dim.xf.data[this.dim.rowIndex[r]],!0),this.count[a]++,this.acount[a]++,s(r++,a)}}else if("r"===o.t){a=0;for(let t=0;t<o.r.length;t++){const e=this.mapFn(o.r[t][0]);for(;n(i[a].key,e);)a++;console.assert(!l(e,i[a].key));const s=i[a];this.state[r+t]||(s.value=this.reduceFn[0](s.value,o.r[t][1]),this.count[a]++),s.value=this.reduceFn[1](s.value,o.r[t][1],!0),this.count[a]--,this.acount[a]--,0===this.acount[a]&&(i.splice(a,1),this.count.splice(a,1),this.acount.splice(a,1))}this.state.splice(r,o.r.length)}return this.linear}))}static create(t,e=(t=>t)){const i=super.create({dim:t,mapFn:e});return i.pending.insert(t.rows),i}filterRange(){return[this.mapFn(this.dim.rows[this.dim.lo]),this.mapFn(this.dim.rows[this.dim.hi])]}size(){return this.groups.length}reduce(t,e,i){return this.reduceFn=[t,e,i],this.linear.splice(0,this.linear.length),this.count=[],this.acount=[],this.state=[],this.pending=(new K).insert(this.dim.rows),this}reduceCount(){return this.reduce(...vt)}reduceSum(t){return this.reduce((e,i)=>e+t(i),(e,i)=>e-t(i),()=>0)}order(t){return this.orderFn=t,this}orderNatural(){return this.orderFn=t=>t,this}top(t){const e=this.groups,i=e.filter((t,e)=>this.count[e]).sort((t,e)=>{const i=this.orderFn(t.value),s=this.orderFn(e.value);return i<s?-1:i>s?1:-1}).reverse(),s=e.filter((t,e)=>!this.count[e]).sort((t,e)=>{const i=this.orderFn(t.value),s=this.orderFn(e.value);return i<s?-1:i>s?1:t<e?-1:1});return i.concat(s).slice(0,t).map(t=>({key:t.key===xt?null:t.key,value:t.value}))}all(){return this.groups}calcGroups(){return this.groups}dispose(){}}const xt=null;class Bt extends x{constructor(){super(),this.filterFx=yt,this.filterFn=()=>!0,this.lo=this.hi=0,this.rowsPerValue=new wt,this.rows=[],this.rowIndex=new wt,this.rowHidden=new wt,this.groups=Array(32)}static create(t,e,i){const s=super.create({xf:t,filters:e});return s.accessor=t=>{const e="function"==typeof i?i(t):new Function("d",`return d.${i};`)(t);return"function"==typeof e?e.apply(t):e},s.update((new K).insert(t.data)),s}update(t){let e=0,i=(new K).retain(this.rows.length);for(let s of t.ops)"n"===s.t?e+=s.n:"i"===s.t?(i=i.compose(this.insert(e,s.i)),e+=s.i.length):i=i.compose(this.remove(e,s.r));this.lastUpdate=i}remove(t,e){const i=e.length,s=new K,n=new wt(this.rowsPerValue.length-i);if(n.set(this.rowsPerValue.slice(0,t)),n.set(this.rowsPerValue.slice(t+i),t),this.rowsPerValue=n,!this.rowsPerValue.length)return s.remove(this.rows.map((t,i)=>[t,e[i]])),this.rows=[],this.rowIndex=new wt(0),this.rowHidden=new wt(0),s;let l=0;for(let n=0,r=this.rows.length;n<r;n++){const r=this.rowIndex[n];t<=r&&r<t+i?(l++,s.remove([[this.rows[n],e[r-t]]])):s.retain(1)}const r=[],a=new wt(this.rows.length-l),o=new wt(this.rows.length-l);for(let e=0,s=0,n=this.rows.length;e<n;e++){const n=this.rowIndex[e];t<=n&&n<t+i||(r[s]=this.rows[e],a[s]=n>=t+i?n-i:n,o[s]=this.rowHidden[e],s++)}return this.rows=r,this.rowIndex=a,this.rowHidden=o,s}insert(t,e){const i=new K,s=e.map(this.accessor),n=new wt(e.length);let l,r,a=[];if(s[0]instanceof Array){for(let t=0,e=s.length;t<e;t++)n[t]=s[t].length||1;const t=n.reduce((t,e)=>t+e,0);l=new wt(t);let e=0;for(let t=0,i=s.length;t<i;t++)s[t].length?s[t].forEach(i=>{a.push(i),l[e++]=t}):(a.push(xt),l[e++]=t);console.assert(e===t,"should be identical")}else n.fill(1),a=s.slice().concat(a),l=Uint32Array.from(s,(t,e)=>e);r=new wt(a.length);const o=Array.from(l,(t,e)=>e);Gt(o,(t,e,i)=>{let s=a[t],n=a[e];return i&&(console.log("cmp",s,n,t,e),s===n?console.log(0):typeof s==typeof n?console.log(s<n?-1:1):s===xt?console.log(-1):n===xt?console.log(1):"string"==typeof s&&"number"==typeof n?console.log(-1):"number"==typeof s&&"string"==typeof n&&console.log(1)),s===n?0:typeof s==typeof n?(s.valueOf&&(s=s.valueOf(),n=n.valueOf()),s<n?-1:s>n?1:0):s===xt?-1:n===xt?1:"string"==typeof s&&"number"==typeof n?-1:"number"==typeof s&&"string"==typeof n?1:s<n}),a=Wt(a,o),l.set(Wt(l,o));const c=this.rows.length,h=a.length,d=new wt(this.rowsPerValue.length+e.length),u=[],m=new wt(c+h),I=new wt(c+h);for(let i=0;i<c;i++)this.rowIndex[i]>=t&&(this.rowIndex[i]+=e.length);for(let e=0;e<h;e++)l[e]+=t;d.set(this.rowsPerValue.subarray(0,t),0),d.set(n,t),d.set(this.rowsPerValue.subarray(t),t+e.length);let g=0,b=0,p=0;const[f,G]=this.filterFx(a),Z=[];for(;b<c&&p<h;g++)this.rows[b]<=a[p]?(u[g]=this.rows[b],I[g]=this.rowHidden[b],m[g]=this.rowIndex[b],i.retain(1),b++):(u[g]=a[p],I[g]=r[p],m[g]=l[p],i.insert([a[p]]),p<f?(Z.push(g),this.lo++,this.hi++):p<G?(this.filterFn(a[p])||Z.push(g),this.hi++):Z.push(g),p++);for(i.retain(c-b);b<c;b++,g++)u[g]=this.rows[b],I[g]=this.rowHidden[b],m[g]=this.rowIndex[b];for(i.insert(a.slice(p));p<h;p++,g++)u[g]=a[p],I[g]=r[p],m[g]=l[p],p<f?(Z.push(g),this.lo++,this.hi++):p<G?(this.filterFn(a[p])||Z.push(g),this.hi++):Z.push(g);return this.rowsPerValue=d,this.rows=u,this.rowIndex=m,this.rowHidden=I,Z.forEach(t=>this.hide(t)),i}setFilter(t,e){this.filters.set(t,e)}filter(t){return null==t?this.filterAll():Array.isArray(t)?this.filterRange(t):"function"==typeof t?this.filterFunction(t):this.filterExact(t)}filterExact(t){return this.filterFx=function(t){return function(e){const i=e.length;return[Zt(e,t,0,i),Yt(e,t,0,i)]}}(t),this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterRange(t){return this.filterFx=function(t){const[e,i]=t;return function(t){const s=t.length;return[Zt(t,e,0,s),Zt(t,i,0,s)]}}(t),this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterAll(){return this.filterFx=yt,this.filterFn=()=>!0,this.filterFlipper(this.filterFx(this.rows))}filterFunction(t){return this.filterFx=yt,this.filterFn=t,this.filterFlipper(this.filterFx(this.rows))}hide(t){if(!this.rowHidden[t]){const e=this.rowIndex[t];this.rowsPerValue[e]--,this.rowsPerValue[e]||this.setFilter(e,!0),this.rowHidden[t]=1}}show(t){if(this.rowHidden[t]){const e=this.rowIndex[t];this.rowsPerValue[e]++,1===this.rowsPerValue[e]&&this.setFilter(e,!1),this.rowHidden[t]=0}}filterFlipper([t,e]){for(let e=0;e<t;e++)this.hide(e);for(let i=t;i<e;i++)this.filterFn(this.rows[i])?this.show(i):this.hide(i);for(let t=e;t<this.rows.length;t++)this.hide(t);this.lo=t,this.hi=e}top(t,e=0){if(t<=0)return[];return Array.from(this.rowIndex.filter(t=>this.filters.isIn(t))).map(t=>this.xf.data[t]).reverse().slice(e,t+e)}bottom(t,e=0){if(t<=0)return[];return Array.from(this.rowIndex.filter(t=>this.filters.isIn(t))).map(t=>this.xf.data[t]).slice(e,t+e)}group(t){return Nt.create(this,t)}groupAll(){return{g:Nt.create(this,()=>0),value(){const t=this.g.all();return t.length?t[0].value:this.g.reduceFn[2]()},reduceCount(){return this.g.reduceCount(),this},reduceSum(...t){return this.g.reduceSum(...t),this},reduce(...t){return this.g.reduce(...t),this},dispose(){return this.g.dispose(),this}}}dispose(){this.xf.disposeDimension(this)}}class Ct extends x{constructor(t){super(),this.data=t||[],this.n=this.data.length,this.filters=new Xt(this.n),this.dimmask=0,this.dimensions=Array(32),this.allFilteredA=I("filters.gen",(function(){return v.from(this.allFiltered())}))}add(t){const e=(new K).retain(this.n).insert(t);this.n+=t.length,e.update(this.data),this.filters.extend(t.length);for(let t of this.dimensions)t&&t.update(e);return this}remove(){this.removeElements(this.allFiltered())}removeElements(t){const e=new K;for(let i=0;i<this.n;i++)~t.indexOf(this.data[i])?e.remove([this.data[i]]):e.retain(1);this.n+=e.olen-e.ilen,e.update(this.data),this.filters.update(e);for(let t of this.dimensions)t&&t.update(e)}clear(){const t=new K;t.remove(this.data),this.n=0,t.update(this.data),this.filters.update(t);for(let e of this.dimensions)e&&e.update(t)}dimension(t){const e=~this.dimmask&-~this.dimmask,i=Math.log(e)/Math.log(2)|0;return this.dimmask|=e,this.dimensions[i]=Bt.create(this,this.filters.subarray(i),t)}disposeDimension(t){const e=this.dimensions.indexOf(t);this.dimensions[e]=void 0,this.dimmask^=1<<e,this.filters.clear(e)}groupAll(){return this.dimension(()=>0).groupAll()}size(){return this.n}all(){return this.data}allFiltered(){const t=[];for(let e=0;e<this.data.length;e++)this.filters.isIn(e)&&t.push(this.data[e]);return t}isElementFiltered(t,e=[]){let i=-1;return e.forEach(t=>{i^=1<<this.dimensions.indexOf(t)}),this.filters.isIn(t,i)}}const Lt="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIwLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkViZW5lXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSI2NHB4IiBoZWlnaHQ9IjEycHgiIHZpZXdCb3g9IjAgMCA2NCAxMiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjQgMTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRkZGRkZGO30KPC9zdHlsZT4KPGc+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNC4xLDNIMS4zVjEuMkg5VjNINi4zdjcuOEg0LjFWM3oiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05LjgsMS4yaDYuM1YzaC00djEuOWgzLjR2MS44aC0zLjRWOWg0LjF2MS44SDkuOFYxLjJ6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjIuOCwxMC44bC0xLjktMy41aC0xLjJ2My41aC0yLjNWMS4ySDIxYzIuMSwwLDMuOSwwLjcsMy45LDNjMCwxLjQtMC43LDIuMy0xLjgsMi44bDIuMiwzLjlMMjIuOCwxMC44CgkJTDIyLjgsMTAuOHogTTE5LjcsNS42aDEuMWMxLjIsMCwxLjgtMC41LDEuOC0xLjRTMjIsMi45LDIwLjgsMi45aC0xLjFDMTkuNywyLjksMTkuNyw1LjYsMTkuNyw1LjZ6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjYuMSwxLjJoMi4zTDMxLDZsMSwyLjFsMCwwYy0wLjEtMS0wLjMtMi40LTAuMy0zLjVWMS4yaDIuMXY5LjZoLTIuM0wyOSw2bC0xLTIuMWgtMC4xCgkJQzI4LDUsMjguMiw2LjMsMjguMiw3LjR2My40SDI2VjEuMkgyNi4xeiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTQwLjEsOC41SDM3bC0wLjYsMi4zaC0yLjNsMy4xLTkuNkg0MGwzLjEsOS42aC0yLjRMNDAuMSw4LjV6IE0zOS43LDYuOGwtMC4yLTAuOWMtMC4zLTEtMC41LTIuMS0wLjgtMy4xCgkJaC0wLjFjLTAuMiwxLTAuNSwyLjEtMC44LDMuMWwtMC4yLDAuOUgzOS43eiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTQ4LjgsMTAuOGwtMS45LTMuNWgtMS4ydjMuNWgtMi4zVjEuMkg0N2MyLjEsMCwzLjksMC43LDMuOSwzYzAsMS40LTAuNywyLjMtMS44LDIuOGwyLjIsMy45TDQ4LjgsMTAuOAoJCUw0OC44LDEwLjh6IE00NS43LDUuNmgxLjFjMS4yLDAsMS44LTAuNSwxLjgtMS40UzQ4LDIuOSw0Ni44LDIuOWgtMS4xVjUuNnoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01Mi4xLDEuMmgyLjN2OS42aC0yLjNWMS4yeiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTU2LjUsOC4xYzAuNywwLjYsMS42LDEsMi40LDFjMC45LDAsMS40LTAuNCwxLjQtMC45YzAtMC42LTAuNi0wLjgtMS40LTEuMmwtMS4zLTAuNWMtMS0wLjQtMi0xLjItMi0yLjYKCQljMC0xLjYsMS41LTIuOSwzLjUtMi45YzEuMSwwLDIuNCwwLjQsMy4yLDEuM2wtMS4xLDEuNGMtMC43LTAuNS0xLjMtMC44LTIuMS0wLjhzLTEuMywwLjMtMS4zLDAuOXMwLjcsMC44LDEuNSwxLjFsMS4zLDAuNQoJCWMxLjIsMC41LDIsMS4zLDIsMi42YzAsMS42LTEuNCwzLTMuNywzYy0xLjMsMC0yLjctMC41LTMuNy0xLjRMNTYuNSw4LjF6Ii8+CjwvZz4KPC9zdmc+Cg==",Rt="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIwLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkViZW5lXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSI3MHB4IiBoZWlnaHQ9IjM1cHgiIHZpZXdCb3g9IjAgMCA3MCAzNSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNzAgMzU7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRkZGRkZGO30KPC9zdHlsZT4KPGc+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMTAuMiw2LjdIMTNsMS42LDQuM2wwLjYsMS43aDAuMWwwLjYtMS43bDEuNi00LjNoMi44djEwLjRoLTIuNlYxNGMwLTEuMSwwLjItMi43LDAuNC0zLjdIMThsLTAuOSwyLjQKCQlsLTEuNCwzLjVoLTFsLTEuNC0zLjVsLTAuOC0yLjRoLTAuMWMwLjEsMSwwLjQsMi43LDAuNCwzLjd2My4xaC0yLjVWNi43SDEwLjJ6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjcuNiwxNC45aC0yLjlsLTAuNSwyLjJoLTIuOGwzLjItMTAuNGgzLjNMMzEsMTcuMWgtMi45TDI3LjYsMTQuOXogTTI3LjEsMTIuOGwtMC4yLTAuNwoJCWMtMC4zLTEtMC41LTIuMy0wLjgtMy4zSDI2Yy0wLjIsMS4xLTAuNSwyLjMtMC43LDMuM2wtMC4yLDAuN0gyNy4xeiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTM3LjcsMTcuMWwtMS44LTMuNWgtMS4xdjMuNUgzMlY2LjdoNGMyLjIsMCw0LjIsMC44LDQuMiwzLjRjMCwxLjUtMC43LDIuNS0xLjcsM2wyLjMsNEgzNy43eiBNMzQuOCwxMS41aDEKCQljMS4xLDAsMS43LTAuNSwxLjctMS40cy0wLjYtMS4yLTEuNy0xLjJoLTFWMTEuNXoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MC42LDYuN2gyLjlsMS4xLDQuNWMwLjMsMS4xLDAuNSwyLjIsMC44LDMuM2gwLjFjMC4zLTEuMSwwLjUtMi4yLDAuOC0zLjNsMS4xLTQuNWgyLjhMNDcsMTcuMWgtMy4zCgkJTDQwLjYsNi43eiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTE0LjQsMjguMWwtMS45LTMuM2gtMS40djMuM2gtMXYtNy45aDIuNWMxLjYsMCwyLjcsMC42LDIuNywyLjJjMCwxLjItMC43LDItMS44LDIuMmwyLDMuNEwxNC40LDI4LjEKCQlMMTQuNCwyOC4xeiBNMTEuMSwyNGgxLjNjMS4yLDAsMS45LTAuNSwxLjktMS41cy0wLjctMS40LTEuOS0xLjRoLTEuM1YyNHoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xNi40LDI0LjJjMC0yLjUsMS40LTQsMy40LTRzMy40LDEuNSwzLjQsNHMtMS40LDQuMS0zLjQsNC4xQzE3LjgsMjguMywxNi40LDI2LjcsMTYuNCwyNC4yeiBNMjIuMSwyNC4yCgkJYzAtMi0wLjktMy4yLTIuMy0zLjJzLTIuMywxLjItMi4zLDMuMnMwLjksMy4yLDIuMywzLjJDMjEuMiwyNy40LDIyLjEsMjYuMSwyMi4xLDI0LjJ6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMjQuNywyMC4zSDI3YzEuNiwwLDIuNywwLjUsMi43LDEuOWMwLDAuOC0wLjQsMS41LTEuNCwxLjdsMCwwYzEuMiwwLjIsMS44LDAuOCwxLjgsMS45YzAsMS41LTEuMiwyLjMtMywyLjMKCQloLTIuNXYtNy44SDI0Ljd6IE0yNi45LDIzLjZjMS4zLDAsMS45LTAuNSwxLjktMS40UzI4LjIsMjEsMjcsMjFoLTEuMnYyLjZIMjYuOXogTTI3LjEsMjcuM2MxLjMsMCwyLjEtMC41LDIuMS0xLjYKCQljMC0xLTAuOC0xLjQtMi4xLTEuNGgtMS40djNIMjcuMXoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0zMS4yLDI0LjJjMC0yLjUsMS40LTQsMy40LTRzMy40LDEuNSwzLjQsNHMtMS40LDQuMS0zLjQsNC4xQzMyLjYsMjguMywzMS4yLDI2LjcsMzEuMiwyNC4yeiBNMzYuOSwyNC4yCgkJYzAtMi0wLjktMy4yLTIuMy0zLjJjLTEuNCwwLTIuMywxLjItMi4zLDMuMnMwLjksMy4yLDIuMywzLjJDMzYsMjcuNCwzNi45LDI2LjEsMzYuOSwyNC4yeiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTQwLjksMjEuMWgtMi40di0wLjhoNS44djAuOGgtMi40djdoLTFDNDAuOSwyOC4xLDQwLjksMjEuMSw0MC45LDIxLjF6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNDUuNiwyMC4zaDF2Ny45aC0xVjIwLjN6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNTEuNywyMC4xYzAuOSwwLDEuNywwLjUsMi4xLDFsLTAuNiwwLjZjLTAuNC0wLjQtMC45LTAuNy0xLjYtMC43Yy0xLjUsMC0yLjUsMS4yLTIuNSwzLjJzMC45LDMuMiwyLjQsMy4yCgkJYzAuNywwLDEuMy0wLjMsMS44LTAuOWwwLjYsMC42Yy0wLjYsMC43LTEuNCwxLjEtMi40LDEuMWMtMiwwLTMuNS0xLjUtMy41LTQuMUM0OC4yLDIxLjcsNDkuNywyMC4xLDUxLjcsMjAuMXoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01NS4xLDI2LjRjMC42LDAuNiwxLjMsMSwyLjIsMWMxLDAsMS42LTAuNSwxLjYtMS4zcy0wLjYtMS4xLTEuMy0xLjRsLTEuMS0wLjVjLTAuNy0wLjMtMS42LTAuOS0xLjYtMgoJCWMwLTEuMiwxLjEtMi4xLDIuNS0yLjFjMC45LDAsMS44LDAuNCwyLjMsMWwtMC41LDAuNmMtMC41LTAuNS0xLjEtMC43LTEuOC0wLjdjLTAuOSwwLTEuNSwwLjQtMS41LDEuMmMwLDAuOCwwLjcsMSwxLjMsMS4zCgkJbDEuMSwwLjVjMC45LDAuNCwxLjYsMC45LDEuNiwyLjFzLTEsMi4yLTIuNywyLjJjLTEuMSwwLTIuMS0wLjUtMi43LTEuMkw1NS4xLDI2LjR6Ii8+CjwvZz4KPC9zdmc+Cg==";const jt=t=>t;function Vt(t,e){do{if(t===e)return!0;e=e.parentElement}while(e.parentElement);return!1}const zt=/^\s*([0-9.]+)\s*([kmgtpezy][b]?)?\s*$/i,Pt=["b","k","m","g","t","p","e","z","y"];function St(t){if(""===t)return"";{const e=zt.exec(t);return!e||isNaN(e[1])?NaN:(t=+e[1],e[2]&&(t*=Math.pow(2,10*Pt.indexOf(e[2][0].toLowerCase()))),Math.floor(t))}}const kt=/^\s*(?:(\d+)\s*h)?\s*(?:(\d+)\s*m)?\s*(?:(\d+)\s*s?)?\s*$/;function Ft(t){if(""===t)return"";{const e=kt.exec(t);return e?3600*(e[1]||0)+60*(e[2]||0)+1*(e[3]||0):NaN}}const Ht="I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMzIGFfbm9ybWFsOwogaW4gdmVjNCBhX2NvbG9yOwoKIHVuaWZvcm0gbWF0NCB1X21hdHJpeDsKIHVuaWZvcm0gdmVjMiB1X3NjYWxlOwogdW5pZm9ybSB2ZWM0IHVfY29sb3I7Cgogb3V0IHZlYzQgdl9jb2xvcjsKIG91dCBmbG9hdCBwb3M7Cgogdm9pZCBtYWluKCkgewogZ2xfUG9zaXRpb24gPSB2ZWM0KGFfbm9ybWFsLnh5ICogdV9zY2FsZSwgMCwgMCkgKyB1X21hdHJpeCAqIGFfcG9zaXRpb247CiBwb3MgPSBhX25vcm1hbC56OwogaWYgKHVfY29sb3IudyA9PSAwLikgewogdl9jb2xvciA9IGFfY29sb3I7CiB9IGVsc2Ugewogdl9jb2xvciA9IHVfY29sb3I7CiB9CiB9",Mt="I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiBmbG9hdCBwb3M7CiBpbiB2ZWM0IHZfY29sb3I7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiBmbG9hdCBsaW5zdGVwKGZsb2F0IGVkZ2UwLCBmbG9hdCBlZGdlMSwgZmxvYXQgdmFsdWUpIHsKIGZsb2F0IHQgPSBjbGFtcCgodmFsdWUgLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuLCAxLik7CiByZXR1cm4gdDsKIH0KCiB2b2lkIG1haW4oKSB7CiBmbG9hdCBhcG9zID0gYWJzKHBvcyk7CgogZmxvYXQgZnAgPSAwLjI7CiBhcG9zID0gMS4gLSBsaW5zdGVwKDEuLWZwLCAxLiwgYXBvcyk7Cgogb3V0Q29sb3IgPSB2ZWM0KHZfY29sb3IueHl6ICogYXBvcywgYXBvcyk7CiB9",Jt="I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMzIGFfbm9ybWFsOwogaW4gdmVjNCBhX2NvbG9yOwoKIHVuaWZvcm0gbWF0NCB1X21hdHJpeDsKIHVuaWZvcm0gdmVjMiB1X29yaWdpbjsKIHVuaWZvcm0gdmVjNCB1X2NvbG9yOwoKIG91dCB2ZWMzIHZfbm9ybWFsOwogb3V0IHZlYzQgdl9jb2xvcjsKCiB2b2lkIG1haW4oKSB7CiBnbF9Qb3NpdGlvbiA9IHVfbWF0cml4ICogYV9wb3NpdGlvbjsKIGdsX1BvaW50U2l6ZSA9IDMuOwogdl9ub3JtYWwgPSBhX25vcm1hbDsKIGlmICh1X2NvbG9yLncgPT0gMC4pIHsKIHZfY29sb3IgPSBhX2NvbG9yOwogfSBlbHNlIHsKIHZfY29sb3IgPSB1X2NvbG9yOwogfQogfQ==",At="I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiB2ZWM0IHZfY29sb3I7CiBpbiB2ZWMzIHZfbm9ybWFsOwogb3V0IHZlYzQgb3V0Q29sb3I7CiB2b2lkIG1haW4oKSB7CiAvKnZlYzMgbm9ybWFsID0gbm9ybWFsaXplKHZfbm9ybWFsKTsKIGZsb2F0IGxpZ2h0ID0gZG90KG5vcm1hbCwgbm9ybWFsaXplKHZlYzMoLTEuLCAtMS4sIDEpKSk7Cgogb3V0Q29sb3IgPSB2X2NvbG9yOwogaWYgKGRvdCh2X25vcm1hbCwgdmVjMygxLiwgMS4sIDEuKSkgIT0gMC4pIHsKIG91dENvbG9yLnJnYiAqPSBsaWdodCArIDAuNzsKIH0qLwogb3V0Q29sb3IgPSB2X2NvbG9yOwogfQ==",Dt="I3ZlcnNpb24gMzAwIGVzCiBpbiBmbG9hdCBhX2luZGV4OwoKIHVuaWZvcm0gdmVjNCB1X3Bvc2l0aW9uOwogdW5pZm9ybSBmbG9hdCB1X2NvdW50OwogdW5pZm9ybSBtYXQ0IHVfbWF0cml4OwogdW5pZm9ybSB2ZWMyIHVfc2NhbGU7CiB1bmlmb3JtIHZlYzQgdV9jb2xvcjsKCiBvdXQgdmVjNCB2X2NvbG9yOwogb3V0IGZsb2F0IHBvczsKCiB2ZWMyIHJvdChmbG9hdCBhbmdsZSkKIHsKIGZsb2F0IHMgPSBzaW4oYW5nbGUpOwogZmxvYXQgYyA9IGNvcyhhbmdsZSk7CiByZXR1cm4gdmVjMihjLCBzKTsKIH0KCiB2b2lkIG1haW4oKSB7CiBpZiAoYV9pbmRleCA9PSAwLikgewogZ2xfUG9zaXRpb24gPSB1X21hdHJpeCAqIHVfcG9zaXRpb247CiBwb3MgPSAwLjsKIH0gZWxzZSB7CiBnbF9Qb3NpdGlvbiA9IHZlYzQocm90KChhX2luZGV4IC0gMS4pIC8gdV9jb3VudCkgKiB1X3NjYWxlLCAwLCAwKSArIHVfbWF0cml4ICogdV9wb3NpdGlvbjsKIHBvcyA9IDEuOwogfQogdl9jb2xvciA9IHVfY29sb3I7CiB9",Et="I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiBmbG9hdCBwb3M7CiBpbiB2ZWM0IHZfY29sb3I7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiBmbG9hdCBsaW5zdGVwKGZsb2F0IGVkZ2UwLCBmbG9hdCBlZGdlMSwgZmxvYXQgdmFsdWUpIHsKIGZsb2F0IHQgPSBjbGFtcCgodmFsdWUgLSBlZGdlMCkgLyAoZWRnZTEgLSBlZGdlMCksIDAuLCAxLik7CiByZXR1cm4gdDsKIH0KCiB2b2lkIG1haW4oKSB7CiBmbG9hdCBhcG9zID0gYWJzKHBvcyk7CgogZmxvYXQgZnAgPSAwLjE7CiBhcG9zID0gMS4gLSBsaW5zdGVwKDEuLWZwLCAxLiwgYXBvcyk7Cgogb3V0Q29sb3IgPSB2ZWM0KHZfY29sb3IueHl6ICogYXBvcywgYXBvcyk7CiB9",Tt=([t,e],[i,s])=>{if(t===i&&e===s)return null;const n=e-s,l=i-t,r=(n**2+l**2)**.5;return[n/r,l/r]};const _t="I3ZlcnNpb24gMzAwIGVzCiBpbiB2ZWM0IGFfcG9zaXRpb247CiBpbiB2ZWMyIGFfdGV4Y29vcmQ7CgogdW5pZm9ybSBtYXQ0IHVfbWF0cml4OwoKIG91dCB2ZWMyIHZfdGV4Y29vcmQ7Cgogdm9pZCBtYWluKCkgewogZ2xfUG9zaXRpb24gPSB1X21hdHJpeCAqIGFfcG9zaXRpb247CiB2X3RleGNvb3JkID0gdmVjMihhX3Bvc2l0aW9uLngsIDEuLWFfcG9zaXRpb24ueSk7CiB9",Qt="I3ZlcnNpb24gMzAwIGVzCiBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCiBpbiB2ZWMyIHZfdGV4Y29vcmQ7CiB1bmlmb3JtIHNhbXBsZXIyRCB1X3RleHR1cmU7CiBvdXQgdmVjNCBvdXRDb2xvcjsKCiB2b2lkIG1haW4oKSB7CiBvdXRDb2xvciA9IHRleHR1cmUodV90ZXh0dXJlLCB2X3RleGNvb3JkKTsKIH0=",Ut=Float32Array.from([0,0,1,0,0,1,1,1]);const Ot=/^marv-partial:/;const Kt=Math.PI;function $t([t,e]){return e=e*Kt/180,[(1+(t=t*Kt/180)/Kt)/2,(1+Math.log(Math.tan(e)+1/Math.cos(e))/Kt)/2]}const qt=class extends x{constructor(){super(),this.id=1,this.components=U,this.helpers=h,this.services={},this.initializers={},this.singletons={},this.rootElement="body",this.actions={id:0},this.loops=[],this.afterRender=[]}documentReady(){const t=document.querySelector(this.rootElement)||document.body;for(let t of Object.values(this.initializers))t.apply(this);return this.router=ht.create({__owner__:this,routes:this.routes}),this.rootNode=this.lookup("application-route"),this.rootNode.__doc__=document,this.rootNode.initializeLeaf(),this.rootNode.modelHook(),this.rootNode.leaf.render(t),window.onpopstate=()=>this.router.updateFromLocation(),this.router.updateFromLocation()}lookup(t){if(!this.singletons[t]){let e=this.components[t];this.singletons[t]=e?e.create({__name:t,tagName:t,__owner__:this}):Q.create({__name:t,__owner__:this,template:`Autogenerated routable component ${t} <div class="${t}">{{outlet}}</div>`})}return this.singletons[t]}init(){if(~["interactive","complete"].indexOf(document.readyState))setTimeout(()=>this.documentReady(),0);else{const t=document.onreadystatechange;document.onreadystatechange=()=>{t&&t(),~["interactive","complete"].indexOf(document.readyState)&&(document.onreadystatechange=t,this.documentReady())}}}scheduleRunLoop(){this.reqid||(this.reqid=requestAnimationFrame(()=>{this.update()}))}asyncEvent(t){const e=this;return function(i){t.call(this,i),e.scheduleRunLoop()}}addAfterRender(t){this.afterRender.push(t)}update(){this.loops.pop(),this.now=Date.now(),this.reqid=null,this.rootNode.update(),this.afterRender.forEach(t=>t()),this.afterRender=[]}async ajax(t){const e=t.method||"GET",i=Object.assign({},t.headers);let s,n,l=t.url;if("GET"===e&&t.data){const e=[];for(let[i,s]of Object.entries(t.data))e.push(`${i}=${encodeURIComponent(s)}`);l+=`?${e.join("&")}`}"GET"!==e&&t.data&&(i["Content-Type"]="application/json;charset=UTF-8",s=JSON.stringify(t.data));try{n=await fetch(l,{method:e,headers:i,body:s})}catch(t){throw{status:600,error:"Cannot connect to server"}}if(n.ok)return"arraybuffer"===t.responseType?await n.arrayBuffer():"raw"===t.responseType?n:await n.json();{let t;try{t=await n.json()}catch(e){t="error not json"}throw{status:n.status,error:t}}}saveData(t,e){const i=document.createElement("a");document.body.appendChild(i),i.style="display: none";const s=window.URL.createObjectURL(t);i.href=s,i.download=e,i.click(),window.URL.revokeObjectURL(s),i.remove()}}.create({version:"20.08.0+ce"});qt.components["application-route"]=class extends Q{constructor(){super(),this.template="e3sjaWYgaW5zZWN1cmV9fSA8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC1kYW5nZXIgdW5lbmNyeXB0ZWQiIHJvbGU9ImFsZXJ0Ij5Zb3VyIE1BUlYgaW5zdGFsbGF0aW9uIGlzIG5vdCBzZWN1cmVkLiBQbGVhc2UgbWFrZSBzdXJlIHlvdXIgd2Vic2VydmVyIHNlcnZlcyBNQVJWIG92ZXIgYW4gZW5jcnlwdGVkIGh0dHBzIGNvbm5lY3Rpb24uPC9kaXY+IHt7ZWxzZX19IDxkaXYgY2xhc3M9ImFwcCI+IDxuYXYgY2xhc3M9Im5hdmJhciBuYXZiYXItZXhwYW5kLXNtIG5hdmJhci1kYXJrIj4gPGxpbmstdG8gaHJlZj0iLyIgY2xhc3M9Im5hdmJhci1icmFuZCI+PGltZyBzcmM9Int7bWFydkxvZ299fSIgYWx0PSJNQVJWIFJvYm90aWNzIiB3aWR0aD0xMDA+PC9saW5rLXRvPiA8YnV0dG9uIGNsYXNzPSJuYXZiYXItdG9nZ2xlciIgdHlwZT0iYnV0dG9uIiBkYXRhLXRvZ2dsZT0iY29sbGFwc2UiIGRhdGEtdGFyZ2V0PSIjbmF2YmFyU3VwcG9ydGVkQ29udGVudCIgYXJpYS1jb250cm9scz0ibmF2YmFyU3VwcG9ydGVkQ29udGVudCIgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGFyaWEtbGFiZWw9IlRvZ2dsZSBuYXZpZ2F0aW9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIG5hdmJhck9wZW4pICgibm90IiBuYXZiYXJPcGVuKSkpfX0+IDxzcGFuIGNsYXNzPSJuYXZiYXItdG9nZ2xlci1pY29uIj48L3NwYW4+IDwvYnV0dG9uPiA8ZGl2IGNsYXNzPSJjb2xsYXBzZSBuYXZiYXItY29sbGFwc2Uge3siaWYiIG5hdmJhck9wZW4gInNob3cifX0iIGlkPSJuYXZiYXJTdXBwb3J0ZWRDb250ZW50Ij4gPHVsIGNsYXNzPSJuYXZiYXItbmF2IG1yLWF1dG8iPiA8bGkgY2xhc3M9Im5hdi1pdGVtIGRyb3Bkb3duIHt7ImlmIiBjb2xsZWN0aW9uc09wZW4gInNob3cifX0iPiA8YSBjbGFzcz0ibmF2LWxpbmsgZHJvcGRvd24tdG9nZ2xlIiByb2xlPSJidXR0b24iIGhyZWY9IiMiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgdG9nZ2xlQ29sbGVjdGlvbkNvbGxhcHNlKX19PkNvbGxlY3Rpb24ge3sjaWYgYWN0aXZlQ29sbGVjdGlvbn19KDxiPnt7YWN0aXZlQ29sbGVjdGlvbn19PC9iPil7ey9pZn19PHNwYW4gY2xhc3M9ImNhcmV0Ij48L3NwYW4+PC9hPiA8ZGl2IGNsYXNzPSJkcm9wZG93bi1tZW51IHt7ImlmIiBjb2xsZWN0aW9uc09wZW4gInNob3cifX0iPiB7eyNpZiBtb2RlbC5jb2xsZWN0aW9ucy5sZW5ndGh9fSB7eyNlYWNoIG1vZGVsLmNvbGxlY3Rpb25zIGFzIHxpdGVtfH19IDxhIGhyZWY9IiMvY29sbGVjdGlvbi97e2l0ZW0ubmFtZX19IiBjbGFzcz0iZHJvcGRvd24taXRlbSB7eyJpZiIgKCJpcy1lcXVhbCIgaXRlbS5uYW1lIGFjdGl2ZUNvbGxlY3Rpb24pICJhY3RpdmUifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgIm9wZW5Db2xsZWN0aW9uIiBpdGVtLm5hbWUpfX0+IHt7aXRlbS5uYW1lfX0gPC9hPiB7ey9lYWNofX0ge3tlbHNlfX0gPGEgY2xhc3M9ImRyb3Bkb3duLWl0ZW0iPk5vIGNvbGxlY3Rpb25zIGF2YWlsYWJsZTwvYT4ge3svaWZ9fSA8L2Rpdj4gPC9saT4ge3sjZWFjaCBvd25lci5oZWFkZXJsaW5rcyBhcyB8cm91dGV8fX0gPGxpIGNsYXNzPSJuYXYtaXRlbSI+IDxsaW5rLXRvIGNsYXNzPSJuYXYtbGluayIgaHJlZj0ie3tyb3V0ZS5yb3V0ZX19Ij57e3JvdXRlLnRleHR9fTwvbGluay10bz4gPC9saT4ge3svZWFjaH19IHt7I2lmIGFjbC5hZG1pbn19IDxsaSBjbGFzcz0ibmF2LWl0ZW0iPiA8bGluay10byBjbGFzcz0ibmF2LWxpbmsiIGhyZWY9ImFkbWluIj48d2lkZ2V0LWljb24gY2xhc3M9ImJhc2VsaW5lIiBjb2xvcj0id2hpdGUiIGdseXBoPSJ3cmVuY2giIC8+PC9saW5rLXRvPiA8L2xpPiB7ey9pZn19IDwvdWw+IDxmb3JtIGNsYXNzPSJmb3JtLWlubGluZSI+IDxidXR0b24gaWQ9InNpZ25pbiIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1saWdodCBidG4tc20iIHR5cGU9ImJ1dHRvbiIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoImlmIiB1c2VyICgiZm4iIHNldFNlc3Npb25pZCBudWxsKSAib3BlblNpZ25pbiIpKX19PlNpZ24ge3sjaWYgdXNlcn19b3V0IDxzdHJvbmc+e3t1c2VyfX08L3N0cm9uZz57e2Vsc2V9fWlue3svaWZ9fTwvYnV0dG9uPiA8L2Zvcm0+IDwvZGl2PiA8L25hdj4gPCEtLSA8ZGl2IGNsYXNzPSJwYWNlIHBhY2UtYWN0aXZlIj4gPGRpdiBjbGFzcz0icGFjZS1wcm9ncmVzcyIgZGF0YS1wcm9ncmVzcz0ie3tvd25lci54aHJQcm9ncmVzc319IiBkYXRhLXByb2dyZXNzLXRleHQ9Int7b3duZXIueGhyUHJvZ3Jlc3N9fSUiIHN0eWxlPSJ0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKHt7b3duZXIueGhyUHJvZ3Jlc3N9fSUsIDBweCwgMHB4KTsiPiA8ZGl2IGNsYXNzPSJwYWNlLXByb2dyZXNzLWlubmVyIj4gPC9kaXY+IDwvZGl2PiA8ZGl2IGNsYXNzPSJwYWNlLWFjdGl2aXR5Ij48L2Rpdj4gPC9kaXY+IC0tPiA8ZGl2IGNsYXNzPSJjb250YWluZXItZmx1aWQgbWFpbiI+IHt7I2lmIG93bmVyLmFqYXhFcnJvcn19IDxkaXYgY2xhc3M9ImFsZXJ0IGFsZXJ0LWRhbmdlciIgcm9sZT0iYWxlcnQiPiA8c3Ryb25nPlJlcXVlc3QgZmFpbGVkOjwvc3Ryb25nPiB7e293bmVyLmFqYXhFcnJvcn19IDwvZGl2PiB7ey9pZn19IHt7I2lmICgiYW5kIiByZWxlYXNlcy5sZW5ndGggKCJpcy1ncmVhdGVyIiByZWxlYXNlcy4wLnZlcnNpb24gdmVyc2lvbikpfX0gPGgyPiBVcGRhdGUgYXZhaWxhYmxlIDxzbWFsbD4oPGEgcm9sZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIHNob3dVcGRhdGVzKSAoIm5vdCIgc2hvd1VwZGF0ZXMpKSl9fT52ZXJzaW9uIHt7cmVsZWFzZXMuMC52ZXJzaW9ufX08L2E+KTwvc21hbGw+IDwvaDI+IHt7I2lmIHNob3dVcGRhdGVzfX0gPGRpdiBjbGFzcz0iY2FyZCI+IDxkaXYgY2xhc3M9ImNhcmQtYm9keSI+IDxkaXYgY2xhc3M9InJlbGVhc2VzIj4ge3sjZWFjaCByZWxlYXNlcyBhcyB8cmVsZWFzZXx9fSA8ZGl2IGNsYXNzPSJyZWxlYXNlIj4gPGZpZWxkc2V0PiA8bGVnZW5kPiB7e3JlbGVhc2UudmVyc2lvbn19IDxzcGFuIGNsYXNzPSJkYXRlIj4tIDxzcGFuIHRpdGxlPXt7cmVsZWFzZS5kYXRlfX0+e3tyZWxlYXNlLmRhdGV9fTwvc3Bhbj48L3NwYW4+IHt7I2lmICgiaXMtZXF1YWwiIHJlbGVhc2UudmVyc2lvbiB2ZXJzaW9uKX19IDxzcGFuIGNsYXNzPSJzdGF0dXMgdGV4dC13aGl0ZSBiZy1zdWNjZXNzIj4gSW5zdGFsbGVkIDwvc3Bhbj4ge3svaWZ9fSA8L2xlZ2VuZD4ge3sjZWFjaCByZWxlYXNlLmNoYW5nZXMgYXMgfGNoYW5nZXx9fSA8ZGl2IGNsYXNzPSJjaGFuZ2UiPiA8c3BhbiBjbGFzcz0idGV4dC13aGl0ZSBiZy17eygiaWYiICgiaXMtZXF1YWwiIGNoYW5nZS50eXBlICJmaXgiKSAiaW5mbyIgInN1Y2Nlc3MiKX19Ij57e2NoYW5nZS50eXBlfX08L3NwYW4+IHt7Y2hhbmdlLnRpdGxlfX0gPC9kaXY+IHt7L2VhY2h9fSA8L2ZpZWxkc2V0PiA8L2Rpdj4ge3svZWFjaH19IDwvZGl2PiA8L2Rpdj4gPC9kaXY+IHt7L2lmfX0ge3svaWZ9fSA8d2lkZ2V0LXdhaXRpbmcgaWNvbj0ibG9jay1sb2NrZWQiIGFjbD10cnVlIHVzZXI9e3t1c2VyfX0gZTQwMT0iU2lnbiBpbiB0byBhY2Nlc3Mgc2l0ZSIgZTQwMz0iVXNlciB7e3VzZXJ9fSBpcyBub3QgcGVybWl0dGVkIHRvIGVudGVyIHRoaXMgc2l0ZSI+IHt7b3V0bGV0fX0gPC93aWRnZXQtd2FpdGluZz4gPC9kaXY+IDx3aWRnZXQtbW9kYWwgb3Blbj17e3NpZ25pbk9wZW59fSBzZXRPcGVuPXt7InNldHRlciIgKCJwYXRoIiBzaWduaW5PcGVuKX19IHRpdGxlPSJTaWduIGluIiBhcz0idGFyZ2V0Ij4ge3sjaWYgKCJpcy1lcXVhbCIgdGFyZ2V0ICJib2R5Iil9fSA8dWwgY2xhc3M9Im5hdiBuYXYtdGFicyI+IDxsaSBjbGFzcz0ibmF2LWl0ZW0iPiA8YSBjbGFzcz0ibmF2LWxpbmsge3siaWYiICgiaXMtZXF1YWwiIHJlYWxtICJtYXJ2IikgImFjdGl2ZSJ9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiByZWFsbSkgIm1hcnYiKSl9fT5NQVJWPC9hPiA8L2xpPiB7eyNlYWNoIG1vZGVsLnJlYWxtcyBhcyB8cnx9fSA8bGkgY2xhc3M9Im5hdi1pdGVtIj4gPGEgY2xhc3M9Im5hdi1saW5rIHt7ImlmIiAoImlzLWVxdWFsIiByZWFsbSByKSAiYWN0aXZlIn19IiB7eyJhY3Rpb24iICgic2V0dGVyIiAoInBhdGgiIHJlYWxtKSByKX19Pnt7cn19PC9hPiA8L2xpPiB7ey9lYWNofX0gPC91bD4gPHA+IDwvcD4gPGRpdiBjbGFzcz0idGFiLWNvbnRlbnQiPiA8ZGl2IHJvbGU9InRhYnBhbmVsIiBjbGFzcz0idGFiLXBhbmUgYWN0aXZlIj4ge3sjaWYgKCJpcy1lcXVhbCIgcmVhbG0gIm1hcnYiKX19IDxmb3JtIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInNpZ25pbiIgb249InN1Ym1pdCIpfX0+IDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPiA8bGFiZWw+VXNlcm5hbWU8L2xhYmVsPiA8aW5wdXQtY29udHJvbCBjbGFzcz0iZm9ybS1jb250cm9sIiBwbGFjZWhvbGRlcj0idXNlcm5hbWUiIHZhbHVlPXt7dXNlcm5hbWV9fSBjaGFuZ2VBY3Rpb249e3sic2V0dGVyIiAoInBhdGgiIHVzZXJuYW1lKX19IC8+IDwvZGl2PiA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4gPGxhYmVsPlBhc3N3b3JkPC9sYWJlbD4gPGlucHV0LWNvbnRyb2wgdHlwZT0icGFzc3dvcmQiIGNsYXNzPSJmb3JtLWNvbnRyb2wge3siaWYiIHBhc3N3b3JkX2Vycm9yICJpcy1pbnZhbGlkIn19IiBwbGFjZWhvbGRlcj0icGFzc3dvcmQiIHZhbHVlPXt7cGFzc3dvcmR9fSBjaGFuZ2VBY3Rpb249e3sic2V0dGVyIiAoInBhdGgiIHBhc3N3b3JkKX19IC8+IDxkaXYgY2xhc3M9ImludmFsaWQtZmVlZGJhY2siPiB7e3Bhc3N3b3JkX2Vycm9yfX0gPC9kaXY+IDwvZGl2PiA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+U2lnbiBpbjwvYnV0dG9uPiA8L2Zvcm0+IHt7ZWxzZX19IDxhdXRoLW8yIHJlYWxtPSJ7e3JlYWxtfX0iIGF1dGhFbmRwb2ludD17eyJmbiIgYXV0aEVuZHBvaW50fX0gYXV0aENvbXBsZXRlPXt7ImZuIiBhdXRoQ29tcGxldGV9fSAvPiB7ey9pZn19IDwvZGl2PiA8L2Rpdj4ge3tlbHNlfX0ge3svaWZ9fSA8L3dpZGdldC1tb2RhbD4gPHdpZGdldC1tb2RhbCBvcGVuPXt7YXBpRXJyb3J9fSBzZXRPcGVuPXt7InNldHRlciIgKCJwYXRoIiBhcGlFcnJvcil9fSB0aXRsZT0iT3BlcmF0aW9uIGZhaWxlZCIgYXM9InRhcmdldCI+IHt7I2lmICgiaXMtZXF1YWwiIHRhcmdldCAiYm9keSIpfX0gPGRpdj5TdGF0dXM6IDxiPnt7YXBpRXJyb3Iuc3RhdHVzfX08L2I+PC9kaXY+IDxkaXY+UmVhc29uOiA8Yj57e2FwaUVycm9yLmVycm9yfX08L2I+PC9kaXY+IHt7ZWxzZX19IDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIGFwaUVycm9yKSBmYWxzZSkpfX0+RGlzbWlzczwvYnV0dG9uPiB7ey9pZn19IDwvd2lkZ2V0LW1vZGFsPiA8bmF2IGNsYXNzPSJuYXZiYXIgbmF2YmFyLWV4cGFuZC1zbSBuYXZiYXItZGFyayI+IDxhIGNsYXNzPSJuYXZiYXItYnJhbmQgZm9vdGVyIiBocmVmPSJodHRwczovL3Rlcm5hcmlzLmNvbSIgcmVsPSJub29wZW5lciIgdGFyZ2V0PV9ibGFuaz48aW1nIHNyYz0ie3t0ZXJuYXJpc0xvZ299fSIgYWx0PSJURVJOQVJJUyIgd2lkdGg9MTAwPjwvYT4gPHVsIGNsYXNzPSJuYXZiYXItbmF2IG1yLWF1dG8iPiB7eyNlYWNoIG93bmVyLmZvb3RlcmxpbmtzIGFzIHxsaW5rfH19IDxsaSBjbGFzcz0ibmF2LWl0ZW0iPiA8YSBjbGFzcz0ibmF2LWxpbmsiIGhyZWY9Int7bGluay5ocmVmfX0iIHJlbD0ibm9vcGVuZXIiIHRhcmdldD1fYmxhbms+e3tsaW5rLnRleHR9fTwvYT4gPC9saT4ge3svZWFjaH19IHt7I2VhY2ggb3duZXIuZm9vdGVycm91dGVzIGFzIHxyb3V0ZXx9fSA8bGkgY2xhc3M9Im5hdi1pdGVtIj4gPGxpbmstdG8gY2xhc3M9Im5hdi1saW5rIiBocmVmPSJ7e3JvdXRlLnJvdXRlfX0iPnt7cm91dGUudGV4dH19PC9saW5rLXRvPiA8L2xpPiB7ey9lYWNofX0gPC91bD4gPHNwYW4gY2xhc3M9Im5hdmJhci10ZXh0Ij4gdmVyc2lvbiB7e3ZlcnNpb259fSB7eyNpZiBvd25lci5saWNlbnNlfX0gKDxzcGFuIGNsYXNzPSJkcm9wdXAge3siaWYiIGxpY2Vuc2VPcGVuICJzaG93In19Ij4gPGEgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSBuYXZiYXItbGluayIgcm9sZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIGxpY2Vuc2VPcGVuKSAoImlmIiBvd25lci5saWNlbnNlLmV4cGlyZXMgKCJub3QiIGxpY2Vuc2VPcGVuKSkpKX19ID4gPHNwYW4gY2xhc3M9Int7ImlmIiAoIm9yIiAoImlzLXBhc3QiIG93bmVyLmxpY2Vuc2UuZXhwaXJlcykgKCJub3QiICgib3IiICgiY29udGFpbnMiIG93bmVyLmxpY2Vuc2UuaG9zdG5hbWVzIGhvc3RuYW1lKSBpc0xvY2FsaG9zdCkpKSAidGV4dC1kYW5nZXIiICJ0ZXh0LXdoaXRlIn19Ij4ge3tvd25lci5saWNlbnNlLmxpY2Vuc2VlfX0gPHdpZGdldC1pY29uIGNsYXNzPSJiYXNlbGluZSIgZ2x5cGg9Int7ImlmIiAoIm9yIiAoImlzLXBhc3QiIG93bmVyLmxpY2Vuc2UuZXhwaXJlcykgKCJub3QiICgib3IiICgiY29udGFpbnMiIG93bmVyLmxpY2Vuc2UuaG9zdG5hbWVzIGhvc3RuYW1lKSBpc0xvY2FsaG9zdCkpKSAid2FybmluZyIgInNoaWVsZCJ9fSIgLz4gPC9zcGFuPiA8L2E+IDx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSBkcm9wZG93bi1tZW51LXJpZ2h0IHt7ImlmIiBsaWNlbnNlT3BlbiAic2hvdyJ9fSI+IDxoNiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIj4gTGljZW5zZWU6IDxzdHJvbmc+e3tvd25lci5saWNlbnNlLmxpY2Vuc2VlfX08L3N0cm9uZz4gPC9oNj4gPGg2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIiPiBUeXBlOiA8c3Ryb25nPnt7b3duZXIubGljZW5zZS50eXBlfX08L3N0cm9uZz4gPC9oNj4gPGg2IGNsYXNzPSJkcm9wZG93bi1oZWFkZXIiPiB7eyNpZiAoImlzLXBhc3QiIG93bmVyLmxpY2Vuc2UuZXhwaXJlcyl9fSBFeHBpcmVkOiA8c3Ryb25nIGNsYXNzPSJ0ZXh0LWRhbmdlciI+e3soImZvcm1hdC1kYXRlIiBvd25lci5saWNlbnNlLmV4cGlyZXMpfX08L3N0cm9uZz4ge3tlbHNlfX0gRXhwaXJlczogPHN0cm9uZz57eygiZm9ybWF0LWRhdGUiIG93bmVyLmxpY2Vuc2UuZXhwaXJlcyl9fTwvc3Ryb25nPiB7ey9pZn19IDwvaDY+IDxoNiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIj4ge3sjaWYgKCJub3QiICgib3IiICgiY29udGFpbnMiIG93bmVyLmxpY2Vuc2UuaG9zdG5hbWVzIGhvc3RuYW1lKSBpc0xvY2FsaG9zdCkpfX0gSG9zdG5hbWVzOiA8c3Ryb25nIGNsYXNzPSJ0ZXh0LWRhbmdlciI+e3sjZWFjaCBvd25lci5saWNlbnNlLmhvc3RuYW1lcyBhcyB8bmFtZXx9fXt7bmFtZX19IHt7L2VhY2h9fTwvc3Ryb25nPiB7e2Vsc2V9fSBIb3N0bmFtZXM6IDxzdHJvbmc+e3sjZWFjaCBvd25lci5saWNlbnNlLmhvc3RuYW1lcyBhcyB8bmFtZXx9fXt7bmFtZX19IHt7L2VhY2h9fTwvc3Ryb25nPiB7ey9pZn19IDwvaDY+IHt7I2lmIG93bmVyLmxpY2Vuc2UuZGV0YWlsc319IDxoNiBjbGFzcz0iZHJvcGRvd24taGVhZGVyIj4gRGV0YWlsczoge3soImZvcm1hdC1odG1sIiBvd25lci5saWNlbnNlLmRldGFpbHMpfX0gPC9oNj4ge3svaWZ9fSA8L3VsPiA8L3NwYW4+KSB7ey9pZn19IDwvc3Bhbj4gPC9uYXY+IDwvZGl2PiB7ey9pZn19",this.ternarisLogo=Lt,this.marvLogo=Rt,this.timezones=I("model",(function(){return[{name:"localtime",value:void 0}]})),this.timezoneSelected=I("timezones",{get(){const t=localStorage.getItem("marv-displayTimezone");return this.timezones.find(e=>e.name===t)||this.timezones[0]}}),this.displayTimezone=I("timezoneSelected",(function(){return this.timezoneSelected.value})),this.owner=I("owner",(function(){return this.getOwner()})),this.hostname=I((function(){return location.hostname})),this.isLocalhost=I((function(){const{hostname:t}=this;return"localhost"===t||/^127\./.test(t)})),this.insecure=I((function(){return"http:"===location.protocol&&!this.isLocalhost})),this.sessionid=I((function(){const t=JSON.parse(localStorage.session||"{}");return 1===t.version?t.id:(localStorage.session=JSON.stringify({version:1,id:null}),null)})),this.user=I("sessionid",(function(){return this.sessionid?JSON.parse(atob(this.sessionid.split(".")[1])).sub:null})),this.username="",this.password="",this.password_error=I("username","password",()=>!1),this.model=I("user",(async function(){return this.user,await this.api({url:"meta"})})),this.acl=I("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach(e=>t[e.replace("-","_")]=!0),t})),this.apiEndpoint=`${document.querySelector("base").href}marv/api/`,this.version=I((function(){return this.getOwner().version})),this.releases=[],this.realm="marv"}toggleCollectionCollapse(t){t.preventDefault(),this.collectionsOpen=!this.collectionsOpen}openCollection(t){this.transitionTo({route:"collection",models:[{id:t,fake:!0}]}),this.collectionsOpen=!1}openSignin(){this.signinOpen=!0,this.getOwner().addAfterRender(()=>{const t=this.getElement().querySelector("input[placeholder=username]");t&&t.focus()})}async signin(t){t.preventDefault();const e={url:"auth",method:"POST",data:{username:this.username,password:this.password}};try{const t=await this.api(e);this.setSessionid(t.access_token),this.username="",this.password="",this.signinOpen=!1}catch(t){let e;e=t.status>=600?"check your network connection":t.status>=500?"server side error, try again later":"check your username and password",this.password_error=`Could not sign in: ${e}`}this.getOwner().asyncEvent(()=>{})()}modelHook(){const t={url:"https://ternaris.com/marv-robotics/changes.json",headers:{"X-MARV":this.getOwner().et}};this.getOwner().ajax(t).then(t=>{this.releases=t})}setSessionid(t){const e=JSON.parse(localStorage.session||"{}");e.id=t,localStorage.session=JSON.stringify(e),this.sessionid=t}async api(t,e){const i=t.url;t.url=`${this.apiEndpoint}${t.url}`,this.sessionid&&(t.headers=Object.assign({Authorization:`Bearer ${this.sessionid}`},t.headers)),this.loading=!0;try{const e=await this.getOwner().ajax(t);return this.loading=!1,this.error=e.error,e}catch(s){if(401===s.status){if(this.setSessionid(null),t.headers&&t.headers.Authorization)return delete t.headers.Authorization,t.url=i,this.api(t)}else this.error="The frontend is unable to communicate with the server.";throw e&&(this.apiError=s),s}}comment(t){return this.api({url:"comment",method:"POST",data:t},!0)}tag(t){return this.api({url:"tag",method:"POST",data:t},!0)}getFilelist(t){return this.api({url:"file-list",method:"POST",data:t},!0)}delete(t){return this.api({url:"dataset",method:"DELETE",data:t},!0)}authComplete(t){this.setSessionid(t),this.username="",this.password="",this.signinOpen=!1}authEndpoint(t){const e={url:"oauth2",method:"POST",data:t};return this.api(e)}},qt.components["button-confirm"]=class extends _{constructor(){super(),this.template="e3sjaWYgKCJpcy1lcXVhbCIgbW9kZSAibGluayIpfX0gPGEgY2xhc3M9Int7Y2xhc3N9fSB7e2J1dHRvbkNsYXNzfX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNoZWNrIil9fT4gPHlpZWxkLWJsb2NrIC8+IDwvYT4ge3tlbHNlfX0gPGJ1dHRvbiBjbGFzcz0ie3tjbGFzc319IHt7YnV0dG9uQ2xhc3N9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2hlY2siKX19IGRpc2FibGVkPXt7ZGlzYWJsZWR9fT4gPHlpZWxkLWJsb2NrIC8+IDwvYnV0dG9uPiB7ey9pZn19IDx3aWRnZXQtbW9kYWwgb3Blbj17e21vZGFsT3Blbn19IHNldE9wZW49e3siY3VycnkiICgibm9leHBhbmQiICgic2V0IiAoIm5vZXhwYW5kIiBtb2RhbE9wZW4pKSl9fSB0aXRsZT17e3RpdGxlfX0gYXM9InRhcmdldCI+IHt7I2lmICgiaXMtZXF1YWwiIHRhcmdldCAiYm9keSIpfX0ge3t0ZXh0fX0ge3tlbHNlfX0gPGJ1dHRvbiBjbGFzcz0ie3tjbGFzc319IHt7YWN0aW9uQnV0dG9uQ2xhc3N9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiZXhlY3V0ZSIpfX0+e3soImlmIiBjb25maXJtVGV4dCBjb25maXJtVGV4dCAiQ29uZmlybSIpfX08L2J1dHRvbj4ge3svaWZ9fSA8L3dpZGdldC1tb2RhbD4=",this.modalOpen=!1}check(){this.modalOpen=!0}execute(){this.action(),this.modalOpen=!1}},qt.initializers.ce=function(){const{widgets:t,formats:e}=window.marv_extensions||{};this.variant="MARV_VARIANT";for(let[e,[i,s]]of Object.entries(t||{}))this.components[`widget-${e}`]=class extends _{constructor(){super(),this.template=`<div class="widget-${e}"></div>`}didInsertElement(){this.state=i(this.getElement(),JSON.parse(JSON.stringify(this.model)))}willRemoveElement(){s(this.state)}};for(let[t,i]of Object.entries(e||{}))this.helpers[`format-${t}`]=new a(t=>i(...JSON.parse(JSON.stringify(t))));this.helpers["format-float"]=new a(([t,e])=>{if(null===t)return"";e="number"==typeof e?e:2;const i=Math.pow(10,e);return(t*i>>0)/i}),this.helpers["format-int"]=new a(([t])=>null===t?"":t),this.helpers["format-string"]=new a(([t])=>null===t?"":t),"serviceWorker"in navigator&&async function(){try{await navigator.serviceWorker.register("sw.js")}catch(t){}}(),this.footerlinks=[{href:"https://gitlab.com/ternaris/marv-robotics",text:"Code"},{href:"https://gitlab.com/ternaris/marv-robotics/issues",text:"Issues"},{href:"docs/",text:"Documentation"}]},qt.components["collection-route"]=class extends Q{constructor(){super(),this.template="PHdpZGdldC13YWl0aW5nIGljb249Imxpc3QiIGFjbD17e2FwcC5tb2RlbC5jb2xsZWN0aW9ucy5sZW5ndGh9fSB1c2VyPXt7YXBwLnVzZXJ9fSBlNDAxPSJTaWduIGluIHRvIGFjY2VzcyBjb2xsZWN0aW9ucyIgZTQwMz0iVXNlciB7e2FwcC51c2VyfX0gaXMgbm90IHBlcm1pdHRlZCB0byBhY2Nlc3MgY29sbGVjdGlvbiB7e3BhcmFtcy5pZH19IiBlNDA0PSJDb2xsZWN0aW9uIHt7cGFyYW1zLmlkfX0gZG9lcyBub3QgZXhpc3QiPiA8ZGl2IGNsYXNzPSJjb2xsZWN0aW9uIj4gPGgyPiB7e2dzdW1tYXJ5LnRpdGxlfX0gPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi1zbSBmbG9hdC1yaWdodCB7eyJpZiIgZmlsdGVyc09wZW4gImFjdGl2ZSJ9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiBmaWx0ZXJzT3BlbikgKCJub3QiIGZpbHRlcnNPcGVuKSkpfX0+IHt7bW9kZWwuZmlsdGVycy50aXRsZX19IDwvYnV0dG9uPiA8L2gyPiA8ZGl2IGNsYXNzPSJjYXJkIj4ge3sjaWYgZmlsdGVyc09wZW4gYW5pbWF0ZU91dD0ibGluZWFyIiBhbmltYXRlSW49ImxpbmVhciJ9fSA8d2lkZ2V0LWZpbHRlciBtb2RlbD17e21vZGVsLmZpbHRlcnMud2lkZ2V0fX0gc2V0QWN0aW9uPXt7ImZuIiBzZXRGaWx0ZXJ9fSBmaWx0ZXI9e3tmaWx0ZXJ9fSBkZWJ1Zz17e2RlYnVnZmlsdGVyc319IC8+IHt7L2lmfX0gPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4gPHdpZGdldC1rZXl2YWwgbW9kZWw9e3tnc3VtbWFyeS53aWRnZXQuZGF0YX19IC8+IDwvZGl2PiA8L2Rpdj4gPGgyPnt7bW9kZWwubGlzdGluZy50aXRsZX19PC9oMj4ge3sjaWYgeGZpbHRlcnMubGVuZ3RofX0gPGRpdiBjbGFzcz0iY2FyZCI+IDxkaXYgY2xhc3M9ImNhcmQtYm9keSI+IHt7I2VhY2ggeGZpbHRlcnMgYXMgfGZpbHRlcnx9fSB7eyNpZiBmaWx0ZXIuc2VsZWN0ZWR9fSA8ZGl2IGNsYXNzPSJ4ZmlsdGVyLWNoYXJ0Ij4gPGg2Pnt7ZmlsdGVyLnRpdGxlfX0ge3sjaWYgZmlsdGVyLnNlbGVjdGVkLmxlbmd0aH19PGEgcm9sZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJ0b2dnbGVDbnQiIGZpbHRlciAiIil9fT5yZXNldDwvYT57ey9pZn19PC9oNj4gPHVsIGNsYXNzPSJsaXN0LWlubGluZSB0YWdzIiBzdHlsZT0icGFkZGluZy1sZWZ0OiAxNnB4OyI+IHt7I2VhY2ggZmlsdGVyLmdyb3VwLmdyb3VwcyBhcyB8Z3JvdXB8fX0gPGxpPiA8c3BhbiBjbGFzcz0iYmFkZ2UgdGFnIHt7ImlmIiAoImNvbnRhaW5zIiBmaWx0ZXIuc2VsZWN0ZWQgZ3JvdXAua2V5IGZpbHRlci5zZWxlY3RlZC5sZW5ndGgpICJhY3RpdmUifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInRvZ2dsZUNudCIgZmlsdGVyIGdyb3VwLmtleSl9fT4ge3tncm91cC5rZXl9fSA8c3Ryb25nPnt7Z3JvdXAudmFsdWV9fTwvc3Ryb25nPiA8L3NwYW4+IDwvbGk+IHt7L2VhY2h9fSA8L3VsPiA8L2Rpdj4ge3tlbHNlfX0gPHdpZGdldC1jaGFydCBkaW09e3tmaWx0ZXIuZGltfX0gZ3JvdXA9e3tmaWx0ZXIuZ3JvdXB9fSB0aXRsZT17e2ZpbHRlci50aXRsZX19IGZvcm1hdFh0aWNrcz17e2ZpbHRlci5mb3JtYXRYdGlja3N9fSB4dmFsdWVzPXt7ZmlsdGVyLnh2YWx1ZXN9fSAvPiB7ey9pZn19IHt7L2VhY2h9fSA8ZGl2IGNsYXNzPSJ0YWctY2xvdWQiPiA8aDY+QnkgVGFncyB7eyNpZiBzZWxlY3RlZFRhZ3MubGVuZ3RofX08YSBocmVmPSIjIiByb2xlPSJidXR0b24iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInRvZ2dsZVRhZyIgIiIpfX0+cmVzZXQ8L2E+e3svaWZ9fTwvaDY+IDx1bCBjbGFzcz0ibGlzdC1pbmxpbmUgdGFncyIgc3R5bGU9InBhZGRpbmctbGVmdDogMTZweDsiPiB7eyNlYWNoIHRhZ3NHcm91cC5ncm91cHMgYXMgfGdyb3VwfH19IDxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+IDxzcGFuIGNsYXNzPSJiYWRnZSB7eyJpZiIgKCJjb250YWlucyIgc2VsZWN0ZWRUYWdzIGdyb3VwLmtleSBzZWxlY3RlZFRhZ3MubGVuZ3RoKSAiYWN0aXZlIn19IHt7ImlmIiBncm91cC5rZXkgInRhZyIgIm5vdGFnIn19IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJ0b2dnbGVUYWciIGdyb3VwLmtleSl9fT4ge3soImlmIiBncm91cC5rZXkgZ3JvdXAua2V5ICJ1bnRhZ2dlZCIpfX0gPHN0cm9uZz57e2dyb3VwLnZhbHVlfX08L3N0cm9uZz4gPC9zcGFuPiA8L2xpPiB7ey9lYWNofX0gPC91bD4gPC9kaXY+IDwvZGl2PiA8L2Rpdj4gPGRpdiBjbGFzcz0iY2FyZCI+IDxkaXYgY2xhc3M9ImNhcmQtYm9keSI+IDx3aWRnZXQta2V5dmFsIG1vZGVsPXt7bHN1bW1hcnkud2lkZ2V0LmRhdGF9fSAvPiA8L2Rpdj4gPC9kaXY+IHt7L2lmfX0gPGRpdiBjbGFzcz0iY2FyZCI+IDxkaXYgY2xhc3M9ImNhcmQtYm9keSI+IDx3aWRnZXQtdGFibGUgbW9kZWw9e3tsaXN0aW5nfX0gc2VsZWN0YWJsZUZvcmNlPXRydWUgc2VsZWN0aW9uQ2hhbmdlPXt7ImZuIiBzZWxlY3Rpb25DaGFuZ2V9fSBub2ZpbHRlcj17e3RydWV9fSBjYWNoZWlkPSJtYXJ2LWxpc3RpbmdUYWJsZSIgYXM9InNlbGVjdGVkIj4gPHVsIGNsYXNzPSJsaXN0LWlubGluZSI+IHt7I2lmIGFjbC50YWd9fSA8bGkgY2xhc3M9Imxpc3QtaW5saW5lLWl0ZW0iPiA8d2lkZ2V0LXRhZyBjbGFzcz0iYnRuIGJ0bi14cyBidG4tb3V0bGluZS1zZWNvbmRhcnkiIGRpc2FibGVkPXt7Im5vdCIgYXBwLnVzZXJ9fSBmdWxsZGlzYWJsZWQ9e3sibm90IiBzZWxlY3RlZElkcy5sZW5ndGh9fSB0YWdzPXt7c2VsZWN0ZWR9fSBhbGx0YWdzPXt7YWxsdGFnc319IGFsdEFjdGlvbj17eyJmbiIgb3BlblNpZ25pbn19IGNoYW5nZUFjdGlvbj17eyJmbiIgZXhlY1RhZ319IC8+IDwvbGk+IHt7L2lmfX0ge3sjaWYgYWNsLmRvd25sb2FkX3Jhd319IHt7I2lmIGxpc3RGZXRjaGVkfX0gPGxpIGNsYXNzPSJsaXN0LWlubGluZS1pdGVtIj4gPHdpZGdldC1jbGlwYm9hcmQgY2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBtb2RlbD17e2NvcHlGaWxlbGlzdH19IC8+IDwvbGk+IDxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+IDx3aWRnZXQtY2xpcGJvYXJkIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgbW9kZWw9e3tjb3B5VXJsbGlzdH19IC8+IDwvbGk+IHt7ZWxzZX19IDxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+IDxidXR0b24gY2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBkaXNhYmxlZD17eyJub3QiIHNlbGVjdGVkSWRzLmxlbmd0aH19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImdldEZpbGVsaXN0Iil9fT4gZmV0Y2ggZmlsZSBsaXN0cyA8L2J1dHRvbj4gPC9saT4ge3svaWZ9fSB7ey9pZn19IHt7I2lmICgiYW5kIiBtb2RlbC5jb21wYXJlIGFjbC5jb21wYXJlKX19IDxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+IDxkaXYgY2xhc3M9IndpZGdldC1jb21wYXJlIj4gPHNwYW4gY2xhc3M9ImRyb3Bkb3duIHt7ImlmIiBjb21wYXJlT3BlbiAic2hvdyJ9fSI+IDxzcGFuIGNsYXNzPSJiYWNrZHJvcCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiBjb21wYXJlT3BlbikgZmFsc2UpKX19Pjwvc3Bhbj4gPGJ1dHRvbiByb2xlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBkcm9wZG93bi10b2dnbGUiIGRpc2FibGVkPXt7Im5vdCIgc2VsZWN0ZWRJZHMubGVuZ3RofX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAib3BlbkNvbXBhcmUiKX19PiBjb21wYXJlIDwvYnV0dG9uPiA8ZGl2IGNsYXNzPSJkcm9wZG93bi1tZW51IHt7ImlmIiBjb21wYXJlT3BlbiAic2hvdyJ9fSB7e21lbnVDbGFzc319Ij4ge3sjaWYgKCJub3QiIGFwcC51c2VyKX19IDxhIGNsYXNzPSJkcm9wZG93bi1pdGVtIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgiZm4iIG9wZW5TaWduaW4pKX19PlNpZ24gaW4gdG8gY29tcGFyZTwvYT4ge3tlbHNlfX0gPGZvcm0gY2xhc3M9InB4LTEgcHktMSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY29tcGFyZSIgb249InN1Ym1pdCIpfX0+IDxpbnB1dC1jb250cm9sIHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIiBwbGFjZWhvbGRlcj0iUGFyYW1ldGVyIiB2YWx1ZT17e2NvbXBhcmVQYXJhbX19IGNoYW5nZUFjdGlvbj17eyJzZXR0ZXIiICgicGF0aCIgY29tcGFyZVBhcmFtKX19IC8+IDwvZm9ybT4gPGRpdiBjbGFzcz0iZHJvcGRvd24tZGl2aWRlciI+PC9kaXY+IDxmb3JtIGNsYXNzPSJweC0xIHhweS0xIHRleHQtcmlnaHQiPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi14cyIgdHlwZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIGNvbXBhcmVPcGVuKSBmYWxzZSkpfX0+Q2FuY2VsPC9idXR0b24+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXhzIiB0eXBlPSJidXR0b24iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNvbXBhcmUiKX19PkNvbXBhcmU8L2J1dHRvbj4gPC9mb3JtPiB7ey9pZn19IDwvZGl2PiA8L3NwYW4+IDwvZGl2PiA8L2xpPiB7ey9pZn19IHt7I2lmIGFjbC5kZWxldGV9fSA8bGkgY2xhc3M9Imxpc3QtaW5saW5lLWl0ZW0iPiA8YnV0dG9uLWNvbmZpcm0gYnV0dG9uQ2xhc3M9ImJ0biBidG4teHMgYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiBhY3Rpb25CdXR0b25DbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLWRhbmdlciIgdGl0bGU9IkRpc2NhcmQgc2VsZWN0ZWQgZGF0YXNldHMiIHRleHQ9IkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBtYXJrIGFsbCBzZWxlY3RlZCBkYXRhc2V0cyBmb3IgZGVsZXRpb24/IElmIHRoZSBjb3JyZXNwb25kaW5nIGZpbGVzIHN0aWxsIGV4aXN0cyBvbiBkaXNrLCB0aGV5IHdvdWxkIGJlIHJlLWFkZGVkIGFzIG5ldyBkYXRhc2V0cyBkdXJpbmcgdGhlIG5leHQgc2Nhbi4gVGhlIGRpc2NhcmRlZCBkYXRhc2V0cyB3b3VsZCBiZSBkZWxldGVkIGR1cmluZyB0aGUgbmV4dCBjbGVhbnVwIGFuZCB0aGVpciB0YWdzIGFuZCBjb21tZW50cyB3b3VsZCBiZSBJUlJFVk9DQUJMWSBnb25lLiIgZGlzYWJsZWQ9e3soIm5vdCIgKCJhbmQiIHNlbGVjdGVkSWRzLmxlbmd0aCBhcHAudXNlcikpfX0gYWN0aW9uPXt7ImZuIiBkZWxldGV9fSBjb25maXJtVGV4dD0iRGlzY2FyZCBzZWxlY3RlZCBkYXRhc2V0cyI+IGRpc2NhcmQgPC9idXR0b24tY29uZmlybT4gPC9saT4ge3svaWZ9fSB7eyNlYWNoIGFwcC5fX293bmVyX18ubGlzdGluZ0FjdGlvbnMgYXMgfGFjdHx9fSA8bGkgY2xhc3M9Imxpc3QtaW5saW5lLWl0ZW0iPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSIgZGlzYWJsZWQ9e3sibm90IiBzZWxlY3RlZElkcy5sZW5ndGh9fSB7eyJhY3Rpb24iIGFjdC5mbn19PiB7e2FjdC5uYW1lfX0gPC9idXR0b24+IDwvbGk+IHt7L2VhY2h9fSA8L3VsPiA8L3dpZGdldC10YWJsZT4gPC9kaXY+IDwvZGl2PiA8L2Rpdj4gPC93aWRnZXQtd2FpdGluZz4=",this.params={},this.filter="",this.debugfilters=!1,this.filtersOpen=I("filter",(function(){return!!this.filter})),this.alltags=I("model.all_known",(function(){return v.create(this.model.all_known.tags)})),this.resetNdx=I("app.displayTimezone",(function(){this.app.displayTimezone,this.prevXfilters=null})),this.attrIdx=I("model","resetNdx",(function(){this.resetNdx;const t={};return this.model.listing.widget.data.columns.map(t=>t.id).forEach((e,i)=>t[e]=i),t})),this.prevAttrIdx=null,this.prevNdx=null,this.ndx=I("attrIdx",(function(){const{attrIdx:t,prevAttrIdx:e,model:i}=this;let s=this.prevNdx;return e&&!Object.entries(t||{}).some(([t,i])=>e[t]!==i)||(s=Ct.create(),this.allDim=s.dimension(()=>null),this.allGroup=this.allDim.group(),this.tagsDim=s.dimension(t=>t.tags),this.tagsGroup=this.tagsDim.group()),this.prevNdx=s,this.prevAttrIdx=t,s.clear(),s.add(i.listing.widget.data.rows),s})),this.selectedTags=I("params.id",(function(){return v.create()})),this.listing=I("ndx.allFilteredA",(function(){const{model:t,ndx:e}=this,i=x.create(t.listing.widget.data);return i.rows=e.allFilteredA,i}));const t={len:t=>t.length,sum:t=>t.reduce((t,e)=>t+e,0),map:(t,e,i)=>t.map(t=>void 0!==t[e]?t[e]:i),idx:t=>this.attrIdx[t]};function e(i,s){if(Array.isArray(i)){let[n,...l]=i;return l=l.map(t=>e(t,s)),t[n].apply(this,l)}return"object"==typeof i?s:i}function i(t,i){const s={title:t.title,widget:{type:"keyval",data:{}}};return s.widget.data.items=t.items.map(t=>({title:t.title,formatter:t.formatter,list:t.islist,value:e(t.function,i)})),s}this.gsummary=I("model.summary_config",(function(){return i(this.model.summary_config,this.model.listing.widget.data.rows.map(t=>t.values))})),this.lsummary=I("model.summary_config","ndx.allFilteredA",(function(){return i(this.model.summary_config,this.ndx.allFilteredA.map(t=>t.values))})),this.prevXfilters=null,this.xfilters=I("ndx","attrIdx",(function(){const t=this.attrIdx,e=this.getOwner().crxfilters||[];return e.some(e=>void 0===t[e.key])?(this.prevXfilters=null,[]):this.prevXfilters?this.prevXfilters:this.prevXfilters=e.map(e=>{const i=Object.assign(x.create({formatXticks:jt}),e),s=t[e.key],n=t=>t.values[s];if(e.dimFn)i.dim=this.ndx.dimension(t=>e.dimFn.call(this.app,n(t)));else if(e.dimHist){const s=e.dimHist;let l,r;if("linear"===s.axis){const i=Math.ceil(s.max/s.bins)*s.bins;l=n=>s.bins*n.values[t[e.key]]/i,r=t=>t*i/s.bins}else if("logarithmic"===s.axis){const i=Math.log(s.max);l=n=>s.bins*Math.log(n.values[t[e.key]])/i,r=t=>0|Math.exp(t*i/s.bins)}else s.bins=s.axis.length,l=t=>{let e=0;for(;e+1<s.axis.length&&n(t)>s.axis[e+1];)e++;return e},r=t=>s.axis[t];i.dim=this.ndx.dimension(t=>Math.min(s.bins-1,0|l(t))),i.formatXticks=t=>e.formatXticks(r(t)),i.xvalues=Array.from({length:s.bins},(t,e)=>e)}else i.dim=this.ndx.dimension(t=>n(t)),i.selected=v.create();return i.group=i.dim.group(),i})})),this.selectedIds=v.create(),this.listFetched=I("selectedIds.@each",(function(){return!1})),this.compareParam="",this.scrollEvent=()=>{const t=document.scrollingElement||document.body.parentElement;this.state.scroll=t.scrollTop},this.state=I((function(){const t=JSON.parse(localStorage.state||"{}");return 1!==t.version?{version:1}:t})),this.model=I("params","filter","app.user",(async function(){const t={url:`collection/${this.params.id}`};this.filter&&(t.data={filter:atob(this.filter)}),window.removeEventListener("scroll",this.scrollEvent),document.title=`MARV > ${this.params.id}`;const e=await this.app.api(t);return this.app.activeCollection=this.params.id,this.getOwner().addAfterRender(()=>{if((document.scrollingElement||document.body.parentElement).scrollTop=this.state.scroll,window.addEventListener("scroll",this.scrollEvent),this.app.lastDetailHash){const t=document.querySelector(`[href="/${this.app.lastDetailHash}"]`);t&&t.focus(),this.app.lastDetailHash=null}}),e})),this.app=I((function(){return this.getOwner().lookup("application-route")})),this.acl=I("model",(function(){const t={};return this.model.acl&&this.model.acl.forEach(e=>t[e.replace("-","_")]=!0),t}))}selectionChange(t){this.selectedIds=v.from(t,t=>t.id)}getFilelist(){this.app.getFilelist(this.selectedIds).then(t=>{this.copyFilelist={data:t.paths.join("\n"),title:"file paths"},this.copyUrllist={data:t.urls.map(t=>`${this.app.apiEndpoint}${t}`).join("\n"),title:"URLs"},this.listFetched=!0})}openCompare(){this.compareOpen=!0,this.getOwner().addAfterRender(()=>{const t=this.getElement().querySelector(".widget-compare input");t&&t.focus()})}compare(t){t.preventDefault(),this.compareOpen=!1,this.transitionTo({route:"compare",models:[{id:btoa(JSON.stringify({collection:this.params.id,ids:this.selectedIds,param:this.compareParam})),fake:!0}]})}toggleTag(t,e){if(e.preventDefault(),""===t)this.selectedTags.splice(0,this.selectedTags.length);else{const e=this.selectedTags.indexOf(t);~e?this.selectedTags.splice(e,1):this.selectedTags.push(t)}this.tagsDim.filterFunction(t=>!this.selectedTags.length||~this.selectedTags.indexOf(t))}setState(t,e){this.state[t]=e,localStorage.state=JSON.stringify(this.state)}openSignin(){this.app.openSignin()}setFilter(t){this.transitionTo({query:{filter:t}})}execTag(t){const e={};t.added.forEach(t=>e[t]=[]),this.selectedIds.forEach(i=>{const s=this.ndx.data.find(t=>t.id==i).tags;t.added.filter(t=>!s.includes(t)).forEach(t=>e[t].push(i))});const i={};t.removed.forEach(t=>i[t]=this.selectedIds);const s={[this.params.id]:{add:e,remove:i}};this.app.tag(s).then(()=>this.reloadModel())}delete(){this.app.delete(this.selectedIds).then(()=>this.reloadModel())}modelHook(t){t.id!==this.params.id&&(this.params=t)}reloadModel(){this.params={id:this.params.id}}willRemoveElement(){window.removeEventListener("scroll",this.scrollEvent),window.removeEventListener("beforeunload",this.beforeunload)}didInsertElement(){this.beforeunload=()=>{const t=document.scrollingElement||document.body.parentElement;this.setState("scroll",t.scrollTop)},window.addEventListener("beforeunload",this.beforeunload)}toggleCnt(t,e){if(""===e)t.selected.splice(0,t.selected.length);else{const i=t.selected.indexOf(e);~i?t.selected.splice(i,1):t.selected.push(e)}t.dim.filterFunction(e=>!t.selected.length||~t.selected.indexOf(e))}},qt.components["compare-route"]=class extends ${constructor(){super(),this.type="compare"}},qt.components["detail-route"]=$,qt.components["field-datetime"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0iZmllbGQtZGF0ZXRpbWUgZm9ybS1yb3ciPiA8ZGl2IGNsYXNzPSJjb2wiPiA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cCBpbnB1dC1ncm91cC1zbSBkYXRlIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjYWxlbmRhckZvY3VzSW4iIG9uPSJmb2N1cyIgY2FwdHVyZT10cnVlKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNhbGVuZGFyRm9jdXNPdXQiIG9uPSJibHVyIiBjYXB0dXJlPXRydWUpfX0+IDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwLXByZXBlbmQgZHJvcGRvd24iPiA8c3BhbiBjbGFzcz0iaW5wdXQtZ3JvdXAtdGV4dCI+IDx3aWRnZXQtaWNvbiBnbHlwaD0iY2FsZW5kYXIiIC8+IHt7ISNpZiBjYWxlbmRhck9wZW59fSA8ZGl2IGNsYXNzPSJkcm9wZG93bi1tZW51IHt7ImlmIiBjYWxlbmRhck9wZW4gInNob3cifX0iIHRhYmluZGV4PSItMSI+IDx0YWJsZSBjbGFzcz0ic21hbGwgdGV4dC1jZW50ZXIiPiA8dGhlYWQ+IDx0cj4gPHRoPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiB0eXBlPSJidXR0b24iIHRhYmluZGV4PSItMSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAicHJldiIpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0iY2hldnJvbi1sZWZ0IiAvPiA8L2J1dHRvbj4gPC90aD4gPHRoIGNsYXNzPSJ0ZXh0LWNlbnRlciIgY29sc3Bhbj0iNSI+e3tkaXNwbGF5TW9udGh5ZWFyfX08L3RoPiA8dGggY2xhc3M9InRleHQtY2VudGVyIiBzdHlsZT0icGFkZGluZy1sZWZ0OjA7IFhwYWRkaW5nLXJpZ2h0OjAiPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiB0eXBlPSJidXR0b24iIHRhYmluZGV4PSItMSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAibmV4dCIpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0iY2hldnJvbi1yaWdodCIgLz4gPC9idXR0b24+IDwvdGg+IDwvdHI+IDx0cj4ge3shI2dyb3VwfX0ge3sjZWFjaCB3ZWVrZGF5cyBhcyB8d2Vla2RheXx9fSA8dGg+e3t3ZWVrZGF5fX08L3RoPiB7ey9lYWNofX0ge3shL2dyb3VwfX0gPC90cj4gPC90aGVhZD4gPHRib2R5PiB7eyNlYWNoIG1hdHJpeCBhcyB8bGluZXx9fSA8dHI+IHt7I2VhY2ggbGluZSBhcyB8Y29sdW1ufH19IDx0ZCBjbGFzcz17eyJpZiIgY29sdW1uLmlzQ3VycmVudCAiY3VycmVudERheSJ9fT4gPGEgY2xhc3M9ImJ0biBidG4teHMge3siaWYiIGNvbHVtbi5pc01vbnRoICJibGFjayIgImdyYXkifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInNldERhdGUiIGNvbHVtbi55ZWFyIGNvbHVtbi5tb250aCBjb2x1bW4uZGF0ZSl9fT57e2NvbHVtbi5kYXRlfX08L2E+IDwvdGQ+IHt7L2VhY2h9fSA8L3RyPiB7ey9lYWNofX0gPC90Ym9keT4gPC90YWJsZT4gPC9kaXY+IHt7IS9pZn19IDwvc3Bhbj4gPC9kaXY+IDxpbnB1dC1jb250cm9sIGNsYXNzPSJmb3JtLWNvbnRyb2wge3tjbGFzc319IHt7ImlmIiBjYWxlbmRhck9wZW4gImZvY3VzIn19IiB2YWx1ZT17e2Rpc3BsYXlEYXRlfX0gY2hhbmdlQWN0aW9uPXt7ImZuIiBub29wfX0gLz4gPC9kaXY+IDwvZGl2PiB7eyNpZiBmYWxzZX19IDxkaXYgY2xhc3M9ImNvbCI+IDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIGlucHV0LWdyb3VwLXNtIHRpbWUiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNsb2NrRm9jdXNJbiIgb249ImZvY3VzIiBjYXB0dXJlPXRydWUpfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2xvY2tGb2N1c091dCIgb249ImJsdXIiIGNhcHR1cmU9dHJ1ZSl9fT4gPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAtcHJlcGVuZCBkcm9wZG93biB7eyJpZiIgY2xvY2tPcGVuICJvcGVuIn19Ij4gPHNwYW4gY2xhc3M9ImlucHV0LWdyb3VwLXRleHQiPiA8d2lkZ2V0LWljb24gZ2x5cGg9ImNsb2NrIiAvPiB7eyNpZiBjbG9ja09wZW59fSA8ZGl2IGNsYXNzPSJkcm9wZG93bi1tZW51IiBzdHlsZT0ibWluLXdpZHRoOjAiIHRhYmluZGV4PSItMSI+IDx0YWJsZSBjbGFzcz0iWHRhYmxlIHRhYmxlLWNvbmRlbnNlZCBzbWFsbCB0ZXh0LWNlbnRlciI+IDx0Ym9keT4gPHRyPiA8dGQ+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiaG91clVwIil9fT4gPHdpZGdldC1pY29uIGdseXBoPSJjaGV2cm9uLXVwIiAvPiA8L2J1dHRvbj4gPC90ZD4gPHRkIGNsYXNzPSJzZXBhcmF0b3IiPiZuYnNwOzwvdGQ+IDx0ZD4gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJtaW51dGVVcCIpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0iY2hldnJvbi11cCIgLz4gPC9idXR0b24+IDwvdGQ+IDwvdHI+IDx0cj4gPHRkPnt7aG91cn19PC90ZD4gPHRkIGNsYXNzPSJzZXBhcmF0b3IiPjo8L3RkPiA8dGQ+e3ttaW51dGV9fTwvdGQ+IDwvdHI+IDx0cj4gPHRkPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImhvdXJEb3duIil9fT4gPHdpZGdldC1pY29uIGdseXBoPSJjaGV2cm9uLWRvd24iIC8+IDwvYnV0dG9uPiA8L3RkPiA8dGQgY2xhc3M9InNlcGFyYXRvciI+Jm5ic3A7PC90ZD4gPHRkPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgIm1pbnV0ZURvd24iKX19PiA8d2lkZ2V0LWljb24gZ2x5cGg9ImNoZXZyb24tZG93biIgLz4gPC9idXR0b24+IDwvdGQ+IDwvdHI+IDwvdGJvZHk+IDwvdGFibGU+IDwvZGl2PiB7ey9pZn19IDwvc3Bhbj4gPC9kaXY+IDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIgdmFsdWU9e3tkaXNwbGF5VGltZX19IGRpc2FibGVkPWRpc2FibGVkID4gPC9kaXY+IDwvZGl2PiB7ey9pZn19IDwvZGl2Pg==",this.weekdays=[0,1,2,3,4,5,6].map(t=>{const e=new r;return e.weekday=t,e.format("dd")}),this.val=I("value",(function(){return this.value?new r(this.value):(new r).startOf("date")})),this.currentMonth=I("value",(function(){return this.val.clone().startOf("month")})),this.displayMonthyear=I("currentMonth",(function(){return this.currentMonth.format("MMM YYYY")})),this.displayDate=I("val",(function(){return this.value?this.val.format("LL"):""})),this.displayTime=I("val",(function(){return this.val.format("LT")})),this.hour=I("val",(function(){return this.val.hours})),this.minute=I("val",(function(){return this.val.minutes})),this.matrix=I("currentMonth","val",(function(){const t=this.val,e=this.currentMonth,i=t.year,s=t.month,n=t.date,l=e.month,r=e.clone().startOf("month").startOf("week"),a=e.clone().endOf("month").endOf("week");for(var o=v.create();r<a;){const t=v.create();for(let e=0;e<7;e++)t.push(x.create({isCurrent:r.date===n&&r.month===s&&r.year===i,isMonth:r.month===l,year:r.year,month:r.month,date:r.date})),r.add(1,"date");o.push(t)}return o})),this.app=I((function(){return this.__owner__.lookup("application-route")}))}calendarFocusIn(){this.calendarOpen=!0}calendarFocusOut(t){if(t.relatedTarget){if(Vt(this.getElement(),t.relatedTarget))return}this.calendarOpen=!1}clockFocusIn(){this.clockOpen=!0}clockFocusOut(t){if(t.relatedTarget){if(Vt(this.getElement(),t.relatedTarget))return}this.clockOpen=!1}prev(){this.currentMonth=this.currentMonth.clone().add(-1,"month")}next(){this.currentMonth=this.currentMonth.clone().add(1,"month")}setDate(t,e,i){const s=this.val.clone();s.year=t,s.month=e,s.date=i,this.changeAction(s.format("YYYY-MM-DDTHH:mm:ssZZ",this.app.displayTimezone)),this.val=s}hourUp(){this.val=this.val.clone().add(1,"hour")}hourDown(){this.val=this.val.clone().add(-1,"hour")}minuteUp(){this.val=this.val.clone().add(1,"minute")}minuteDown(){this.val=this.val.clone().add(-1,"minute")}mChangeAction(t){this.changeAction(t||t)}noop(){}},qt.components["field-filesize"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0icm93Ij4gPGRpdiBjbGFzcz0iY29sLTkiPiA8aW5wdXQtY29udHJvbCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIgdmFsdWU9e3t2YWx1ZX19IGNoYW5nZUFjdGlvbj17eyJmbiIgbUNoYW5nZUFjdGlvbn19IC8+IDwvZGl2PiA8ZGl2IGNsYXNzPSJjb2wtMyI+IDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIgdmFsdWU9e3tzaXplfX0gZGlzYWJsZWQ9dHJ1ZT4gPC9kaXY+IDwvZGl2Pg==",this.size=I("value",(function(){const t=St(this.value);return t?`${t} bytes`:""}))}mChangeAction(t){const e=St(t);isNaN(e)?this.changeErrorAction("Value must be a number and optional unit (e.g. MB)"):this.changeErrorAction(null),this.changeAction(t)}},qt.components["field-float"]=class extends _{constructor(){super(),this.template="PGlucHV0LWNvbnRyb2wgY2xhc3M9ImZvcm0tY29udHJvbCB7e2NsYXNzfX0iIHZhbHVlPXt7dmFsdWV9fSBjaGFuZ2VBY3Rpb249e3siZm4iIG1DaGFuZ2VBY3Rpb259fSAvPg=="}mChangeAction(t){isNaN(+t)?this.changeErrorAction("Value must be a number"):this.changeErrorAction(null),this.changeAction(t)}},qt.components["field-int"]=class extends _{constructor(){super(),this.template="PGlucHV0LWNvbnRyb2wgY2xhc3M9ImZvcm0tY29udHJvbCB7e2NsYXNzfX0iIHZhbHVlPXt7dmFsdWV9fSBjaGFuZ2VBY3Rpb249e3siZm4iIG1DaGFuZ2VBY3Rpb259fSAvPg=="}mChangeAction(t){isNaN(+t)?this.changeErrorAction("Value must be a number"):this.changeErrorAction(null),this.changeAction(t)}},qt.components["field-string"]=class extends _{constructor(){super(),this.template="PGlucHV0LWNvbnRyb2wgY2xhc3M9ImZvcm0tY29udHJvbCB7e2NsYXNzfX0iIHZhbHVlPXt7dmFsdWV9fSBjaGFuZ2VBY3Rpb249e3siZm4iIG1DaGFuZ2VBY3Rpb259fSAvPg=="}mChangeAction(t){this.changeAction(t||t)}},qt.components["field-subset"]=class extends _{constructor(){super(),this.template="PG0tdGFnIHRhZ3M9e3t2YWx1ZX19IGNsYXNzPXt7Y2xhc3N9fSBzdWdnZXN0aW9ucz17e2NvbnN0cmFpbnRzfX0gc3Vic2V0PXRydWUgYWRkQWN0aW9uPXt7ImZuIiBhZGR9fSByZW1vdmVBY3Rpb249e3siZm4iIHJlbW92ZX19IC8+"}add(t){this.value.push(t),this.changeAction(v.create(this.value))}remove(t){this.value.splice(this.value.indexOf(t),1),this.changeAction(v.create(this.value))}},qt.components["field-timedelta"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0icm93Ij4gPGRpdiBjbGFzcz0iY29sLTkiPiA8aW5wdXQtY29udHJvbCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIgdmFsdWU9e3t2YWx1ZX19IGNoYW5nZUFjdGlvbj17eyJmbiIgbUNoYW5nZUFjdGlvbn19IC8+IDwvZGl2PiA8ZGl2IGNsYXNzPSJjb2wtMyI+IDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIgdmFsdWU9e3tzaXplfX0gZGlzYWJsZWQ9dHJ1ZT4gPC9kaXY+IDwvZGl2Pg==",this.size=I("value",(function(){const t=Ft(this.value);return t?`${t} seconds`:""}))}mChangeAction(t){const e=Ft(t);isNaN(e)?this.changeErrorAction("Value must be a number with optional modifiers (e.g. 1h 30m)"):this.changeErrorAction(null),this.changeAction(t)}},qt.components["glycine-geojson"]=class extends _{constructor(){super(),this.template=null,this.layerWorld=I("timeRange","features",(function(){for(let t of this.features)if(t.timecode&&t.orientation){const e=this.timeRange[1];let i=t.num-1;for(;t.timecode[i]>e&&i>0;)i--;const s=t.orientation.origins[i].concat([-.1]),n=t.orientation.rotations[i]/180*Math.PI,l=[s[0]+Math.cos(n),s[1]+Math.sin(n),s[2]],{width:r,height:a}=this.gl.canvas;let o=q();return o=st(o,tt(Math.PI/2,r/a,1,1e6)),o=st(o,rt(s,l,[0,0,1])),o=st(o,it(1,1,100))}return null}))}didInsertElement(){this.add(this);const t=this.gl,e=ot(t,Ht,Mt),i={program:e,posloc:t.getAttribLocation(e,"a_position"),norloc:t.getAttribLocation(e,"a_normal"),colloc:t.getAttribLocation(e,"a_color"),matloc:t.getUniformLocation(e,"u_matrix"),scaloc:t.getUniformLocation(e,"u_scale"),ucoloc:t.getUniformLocation(e,"u_color"),d(e,i,s,n,l){const{program:r,matloc:a,scaloc:o,ucoloc:c,vao:h,num:d,c0:u,ucoval:m,timecode:I,width:g}=this,[b,p]=u,f=(e[0]**2+e[1]**2+e[2]**2+e[3]**2)**.5,G=(e[4]**2+e[5]**2+e[6]**2+e[7]**2)**.5,Z=(e[8]**2+e[9]**2+e[10]**2+e[11]**2)**.5;t.useProgram(r),t.bindVertexArray(h),(e=e.slice())[12]+=f*b,e[13]+=G*p,e[14]+=Z*i,t.uniformMatrix4fv(a,!1,e),t.uniform2fv(o,[g/n,g/l]),t.uniform4fv(c,m);let Y=d;Y&&(t.disable(t.DEPTH_TEST),t.drawArrays(t.TRIANGLE_STRIP,0,Y),t.enable(t.DEPTH_TEST))}};function s(e,s){let[n,l,r,a]=function(t){const e=t[0],i=new Float32Array(4*t.length),s=new Float32Array(6*t.length),n=new Uint32Array(2*t.length);let l=t[0],r=t[1],[a,o]=Tt(l,r)||[1,0];i.set([0,0,0,0],0),s.set([1*a,1*o,1,-1*a,-1*o,-1],0),n.set([0,0],0);for(let c=1,h=t.length-1;c<h;c++){l=t[c],r=t[c+1];const[h,d]=Tt(l,r)||[a,o],u=a*h+o*d,[m,I]=[a+h,o+d];[a,o]=[h,d];const g=(m**2+I**2)**.5,[b,p]=g&&u>-.8?[m/g,I/g]:[h,d];let f,G,Z=b*h+p*d;Math.abs(u)>20.99?(console.log("cosan fixup"),Z=1,[f,G]=[h,d]):[f,G]=[b/Z,p/Z],i.set([l[0]-e[0],l[1]-e[1],l[0]-e[0],l[1]-e[1]],4*c),s.set([f,G,1,-f,-G,-1],6*c),n.set([c,c],2*c)}l=t[t.length-1],r=t[t.length-2],[a,o]=Tt(r,l)||[a,o];const c=t.length-1;return i.set([l[0]-e[0],l[1]-e[1],l[0]-e[0],l[1]-e[1]],4*c),s.set([1*a,1*o,1,-1*a,-1*o,-1],6*c),n.set([c,c],2*c),[e,i,s,n]}(e);const o=t.createVertexArray(),c=t.createBuffer(),h=t.createBuffer();t.bindVertexArray(o),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),t.enableVertexAttribArray(i.posloc),t.vertexAttribPointer(i.posloc,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.enableVertexAttribArray(i.norloc),t.vertexAttribPointer(i.norloc,3,t.FLOAT,!1,0,0);const{colors:d,timestamps:u,width:m}=s;if(d.length){const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,function(t,e){const i=t.map(t=>t.map((e,i)=>3===i?e:t[3]*e)),s=Array.from(e,t=>i[t]);return Float32Array.from(s.reduce((t,e)=>t.concat(e),[]))}(d,a),t.STATIC_DRAW),t.enableVertexAttribArray(i.colloc),t.vertexAttribPointer(i.colloc,4,t.FLOAT,!1,0,0)}const I=u?Array.from(a,t=>u[t]):null,g=l.length/2;return Object.assign({vao:o,num:g,c0:n,width:m,timecode:I,vertexmap:a},i)}const n=ot(t,Jt,At),l={program:n,posloc:t.getAttribLocation(n,"a_position"),norloc:t.getAttribLocation(n,"a_normal"),colloc:t.getAttribLocation(n,"a_color"),matloc:t.getUniformLocation(n,"u_matrix"),oriloc:t.getUniformLocation(n,"u_origin"),ucoloc:t.getUniformLocation(n,"u_color"),d(e,i,s,n,l){const{program:r,matloc:a,ucoloc:o,vao:c,num:h,c0:d,ucoval:u,transform:m,timecode:I}=this,[g,b]=d,p=st(st(e,et(g,b,i)),m);t.useProgram(r),t.bindVertexArray(c),t.uniformMatrix4fv(a,!1,p),t.uniform4fv(o,u);let f=h;f&&(t.depthFunc(t.LEQUAL),t.drawArrays(t.TRIANGLE_STRIP,0,f),t.depthFunc(t.LESS))}};const r=ot(t,Dt,Et),a={program:r,idxloc:t.getAttribLocation(r,"a_index"),cntloc:t.getUniformLocation(r,"u_count"),posloc:t.getUniformLocation(r,"u_position"),matloc:t.getUniformLocation(r,"u_matrix"),scaloc:t.getUniformLocation(r,"u_scale"),ucoloc:t.getUniformLocation(r,"u_color"),d(e,i,s,n,l){const{program:r,cntloc:a,posloc:o,matloc:c,scaloc:h,ucoloc:d,vao:u,num:m,geometry:I,count:g,radius:b,ucoval:p}=this;t.useProgram(r),t.bindVertexArray(u);const f=function(t,e){for(var i=[],s=0;s<4;++s){i[s]=0;for(var n=0;n<4;++n)i[s]+=e[n]*t[4*n+s]}return i}(e,[...I.coordinates,0,1]);t.uniform4fv(o,f),t.uniform1f(a,g/(2*Math.PI)),e=q(),t.uniformMatrix4fv(c,!1,e),t.uniform2fv(h,[2*b/n,2*b/l]),t.uniform4fv(d,p),t.disable(t.DEPTH_TEST),t.drawArrays(t.TRIANGLE_FAN,0,m),t.enable(t.DEPTH_TEST)}};function o(e,i){const s=t.createVertexArray(),n=t.createBuffer();t.bindVertexArray(s),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,Float32Array.from({length:18},(t,e)=>e),t.STATIC_DRAW),t.enableVertexAttribArray(a.idxloc),t.vertexAttribPointer(a.idxloc,1,t.FLOAT,!1,0,0);return Object.assign({vao:s,num:18,count:16,radius:i,geometry:e},a)}this.features=this.model.geojson.features.map(e=>{const{geometry:i,properties:n}=e;let r,{type:a,coordinates:c}=i;if("LineString"===a)r=s(c,n);else if("Polygon"===a)r=function(e,i){let s,n=e[0].slice(0,-1),r=n[0];const a=new Float32Array(2*n.length);n.forEach((t,e)=>a.set([t[0]-r[0],t[1]-r[1]],2*e));const o=t.createVertexArray(),c=t.createBuffer(),h=t.createBuffer();return t.bindVertexArray(o),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),t.enableVertexAttribArray(l.posloc),t.vertexAttribPointer(l.posloc,2,t.FLOAT,!1,0,0),i.colors&&(t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,Uint8Array.from(i.colors.reduce((t,e)=>t.concat([e[0],e[1],e[2],e[3]||255]),[])),t.STATIC_DRAW),t.enableVertexAttribArray(l.colloc),t.vertexAttribPointer(l.colloc,4,t.UNSIGNED_BYTE,!0,0,0)),s=a.length/2,Object.assign({vao:o,num:s,c0:r},l)}(c,n);else if("Circle"===a)r=o(i,i.radius);else{if("Point"!==a)throw new Error(`GeoJSON type ${a} not supported yet`);r=o(i,4)}const h=Float32Array.from(n.color.length?n.color:[1,1,1,1]);n.colors&&n.colors.length?r.ucoval=[0,0,0,0]:r.ucoval=h.map((t,e)=>3===e?t:h[3]*t);const d=Float32Array.from(n.fillcolor.length?n.fillcolor:h.map((t,e)=>3===e?.8*t:t));n.fillcolors&&n.fillcolors.length?r.ufcval=[0,0,0,0]:r.ufcval=d.map((t,e)=>3===e?t:d[3]*t);const{timestamps:u,rotations:m,markervertices:I}=n;return[r]}).reduce((t,e)=>t.concat(e),[])}willRemoveElement(){this.remove(this)}glRender(){this.model.hidden||this.features.forEach((t,e)=>{t.d(this.world,this.index/16-.999+e/65536,this.timeRange,this.width,this.height)})}},qt.components["glycine-surface"]=ct,qt.components["glycine-tyler"]=class extends _{constructor(){super(),this.template=null,this.t=8,this.pixelSize=[-1,-1],this.scale=I("t","z","model.tile",(function(){const{t:t,z:e,model:{tile:{zoom:[i,s]}}}=this;return Math.min(s,Math.max(i,e-t))})),this.tileSize=I("pixelSize",(function(){const{t:t,pixelSize:[e,i]}=this;return[(e>>t)+(e%(1<<t)>0)+1,(i>>t)+(i%(1<<t)>0)+1]})),this.tileOffset=I("scale","pos","tileSize",(function(){const{scale:t,pos:[e,i],tileSize:[s,n]}=this;return[e*2**t-(s-1)/2|0,(1-i)*2**t-(n-1)/2|0]})),this.urls=I("model.tile.url",(function(){const t=this.model.tile.url;let e=[];return/\[abc\]/.test(t)?(e.push(t.replace("[abc]","a")),e.push(t.replace("[abc]","b")),e.push(t.replace("[abc]","c"))):e.push(t),e}));const t=v.create();this.tiles=I("urls","z","tileOffset","tileSize",(function(){const{scale:e,gl:i,tileOffset:[s,n],tileSize:[l,r],urls:a}=this,o=t.slice(),c=[];for(let t=0;t<r;t++)for(let i=0;i<l;i++){const r=a[(t*l+i)%a.length].replace("{z}",e).replace("{x}",s+i).replace("{y}",n+t),h=r.split("/").slice(-3).join("/"),d=o.find(t=>t.key===h);if(d)o.splice(o.indexOf(d),1),c.push(d);else{const t={texture:null,url:r,key:h,loaded:!1};c.push(t)}}return c.filter(t=>!t.texture).forEach(t=>{if(o.length){const e=o.pop();t.texture=e.texture,e.texture=null}else t.texture=function(t){const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),e}(i);i.bindTexture(i.TEXTURE_2D,t.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([.8,.8,.8,1]));const e=new Image;e.addEventListener("load",this.getOwner().asyncEvent(()=>{t.texture&&(i.bindTexture(i.TEXTURE_2D,t.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),t.loaded=!0)})),e.crossOrigin="",e.src=t.url}),o.forEach(t=>{i.deleteTexture(t.texture),t.texture=null}),t.splice.call(t,0,t.length,...c),t.map(t=>t.texture)})),this.dirty=I("tiles","tileStore.@each.loaded",(function(){return!0}))}didInsertElement(){this.add(this);const{gl:t}=this,e=this.program=ot(t,_t,Qt),i=t.getAttribLocation(e,"a_position");this.matloc=t.getUniformLocation(e,"u_matrix"),this.texloc=t.getUniformLocation(e,"u_texture");const s=this.vao=t.createVertexArray();t.bindVertexArray(s);const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,Ut,t.STATIC_DRAW)}willRemoveElement(){this.remove(this)}glRender(){if(this.model.hidden)return;const{pixelSize:[t,e],gl:i,program:s,vao:n,scale:l,world:r,tileOffset:[a,o],tileSize:[c,h],tiles:d,matloc:u}=this,{width:m,height:I}=i.canvas;m===t&&I===e||(this.pixelSize=[m,I]);const g=2**-l,b=st(r,it(g,g,1));i.useProgram(s),i.bindVertexArray(n);for(let t=0,e=a,s=1/g-(o+1);t<c;t+=1,e+=1,s+=h)for(let n=0;n<h;n+=1,s-=1)i.uniformMatrix4fv(u,!1,st(b,et(e,s,-.9999))),i.bindTexture(i.TEXTURE_2D,d[t+n*c]),i.drawArrays(i.TRIANGLE_STRIP,0,4)}},qt.components["index-route"]=class extends Q{constructor(){super(),this.template="e3sjaWYgYXBwLm1vZGVsLmNvbGxlY3Rpb25zLmxlbmd0aH19IHt7b2JzfX0ge3tlbHNlfX0gPGRpdiBjbGFzcz0ianVtYm90cm9uIj4gPGgxIGNsYXNzPSJ0ZXh0LWNlbnRlciI+IDx3aWRnZXQtaWNvbiBnbHlwaD0ibGlzdCIgY2xhc3M9IndpZGdldC1pY29uLWxnIiAvPiA8L2gxPiB7eyNpZiBhcHAudXNlcn19IDxwIGNsYXNzPSJ0ZXh0LWNlbnRlciI+VXNlciB7e2FwcC51c2VyfX0gaGFzIG5vIGFjY2VzcyB0byBhbnkgY29sbGVjdGlvbjwvcD4ge3tlbHNlfX0gPHAgY2xhc3M9InRleHQtY2VudGVyIj5TaWduIGluIHRvIHNlZSB5b3VyIGNvbGxlY3Rpb25zPC9wPiB7ey9pZn19IDwvZGl2PiB7ey9pZn19",this.app=I((function(){return this.getOwner().lookup("application-route")})),this.obs=I("app.model",(function(){this.didEnter()}))}didEnter(){if(this.app.model.collections&&this.app.model.collections.length){const{name:t}=this.app.model.collections[0];this.transitionTo({route:"collection",models:[{id:t,fake:!0}]})}}},qt.components["input-checkbox"]=class extends _{constructor(){super(),this.template="PGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz17e2NsYXNzfX0gZGlzYWJsZWQ9e3siaWYiIGRpc2FibGVkICJkaXNhYmxlZCIgdW5kZWZpbmVkfX0gY2hlY2tlZD17e21WYWx1ZX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNoYW5nZSIgb249ImNoYW5nZSIpfX0gPg==",this.mValue=I("value",(function(){return this.getElement().checked=this.value,this.value}))}change(){const t=this.getElement().checked;this.changeAction(t)}},qt.components["input-control"]=class extends _{constructor(){super(),this.template="PGlucHV0IHR5cGU9e3t0eXBlfX0gY2xhc3M9e3tjbGFzc319IG1pbj17e21pbn19IG1heD17e21heH19IHN0ZXA9e3tzdGVwfX0gZGlzYWJsZWQ9e3siaWYiIGRpc2FibGVkICJkaXNhYmxlZCIgdW5kZWZpbmVkfX0gcGxhY2Vob2xkZXI9e3twbGFjZWhvbGRlcn19IHZhbHVlPXt7bVZhbHVlfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2hhbmdlIiBvbj0iY2hhbmdlIil9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjaGFuZ2UiIG9uPSJrZXl1cCIpfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2hhbmdlIiBvbj0iaW5wdXQiKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgIm1vdXNlbW92ZSIgb249Im1vdXNlbW92ZSIpfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAibW91c2Vtb3ZlIiBvbj0ibW91c2VsZWF2ZSIpfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAibW91c2Vkb3duIiBvbj0ibW91c2Vkb3duIil9fSA+",this.type="text",this.mValue=I("value",(function(){const t=this.getElement();return t.value===this.value||this.blocked||(t.value=this.value),this.value}))}change(){const t=this.getElement().value;this.changeAction(t)}mousedown(){const t=()=>{this.blocked=!1,document.removeEventListener("mouseup",t)};this.blocked=!0,document.addEventListener("mouseup",t)}mousemove(t){if(this.overAction)if("mousemove"===t.type){const{left:e}=t.target.getClientRects()[0],i=Math.max(0,(t.clientX-e-8)/(t.target.clientWidth-18));this.overAction(Math.floor(this.min+i*(this.max-this.min)))}else this.overAction(null)}},qt.components["input-radio"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+IDxsYWJlbD57e3RpdGxlfX08L2xhYmVsPiA8ZGl2PiB7eyNlYWNoIGNob2ljZXMgYXMgfGNob2ljZSBpbmRleHx9fSA8ZGl2IGNsYXNzPSJjdXN0b20tY29udHJvbCBjdXN0b20tcmFkaW8gY3VzdG9tLWNvbnRyb2wtaW5saW5lIj4gPGlucHV0IHR5cGU9InJhZGlvIiBjbGFzcz0iY3VzdG9tLWNvbnRyb2wtaW5wdXQiIGlkPSJ7e29pZH19e3tpbmRleH19IiBuYW1lPSJ7eyJpZiIgbmFtZSBuYW1lIG9pZH19IiBkaXNhYmxlZD17eyJpZiIgZGlzYWJsZWQgImRpc2FibGVkIiB1bmRlZmluZWR9fSBjaGVja2VkPXt7ImlzLWVxdWFsIiBjaG9pY2UudmFsdWUgbVZhbHVlfX0gdmFsdWU9e3tjaG9pY2UudmFsdWV9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjaGFuZ2UiIG9uPSJjaGFuZ2UiKX19IC8+IDxsYWJlbCBjbGFzcz0iY3VzdG9tLWNvbnRyb2wtbGFiZWwiIGZvcj0ie3tvaWR9fXt7aW5kZXh9fSI+e3tjaG9pY2UudGl0bGV9fTwvbGFiZWw+IDwvZGl2PiB7ey9lYWNofX0gPC9kaXY+IDwvZGl2Pg==",this.mValue=I("value",(function(){const t=this.getElement().querySelector(`input[value="${this.value}"]`);return t&&(t.checked=!0),this.value})),this.oid=I(()=>this.__oid__)}change(t){this.changeAction(t.target.value)}},qt.components["input-textarea"]=class extends _{constructor(){super(),this.template="PHRleHRhcmVhIGNsYXNzPXt7Y2xhc3N9fSBkaXNhYmxlZD17eyJpZiIgZGlzYWJsZWQgImRpc2FibGVkIiB1bmRlZmluZWR9fSB2YWx1ZT17e21WYWx1ZX19IHJvd3M9e3tyb3dzfX0gY29scz17e2NvbHN9fSBwbGFjZWhvbGRlcj17e3BsYWNlaG9sZGVyfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2hhbmdlIiBvbj0iY2hhbmdlIil9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjaGFuZ2UiIG9uPSJrZXl1cCIpfX0gPiA8L3RleHRhcmVhPg==",this.mValue=I("value",(function(){return this.getElement().value=this.value,this.value}))}change(){const t=this.getElement().value;this.changeAction(t)}},qt.components["m-hover"]=class extends _{constructor(){super(),this.template="PHNwYW4gY2xhc3M9Im0taG92ZXIge3siaWYiIGhvdmVyaW5nICJob3ZlcmluZyJ9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiBob3ZlcmluZykgdHJ1ZSkgb249Im1vdXNlZW50ZXIiKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgIm1vdXNlbGVhdmUiIG9uPSJtb3VzZWxlYXZlIil9fT48eWllbGQtYmxvY2sgcGFyYW1zPXt7aG92ZXJpbmd9fSAvPjwvc3Bhbj4="}mouseleave(t){t.relatedTarget&&(this.hovering=!1)}},qt.components["m-hscroll"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0ibS1oc2Nyb2xsIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzY3JvbGwiIG9uPSJtb3VzZWRvd24iKX19PiA8eWllbGQtYmxvY2sgLz4gPC9kaXY+",this.wheelEvent=t=>{if(t.deltaX){this.getElement().firstElementChild.scrollLeft+=t.deltaX,this.updateHscroll(),t.preventDefault(),t.stopPropagation()}}}scroll(t){if(0!==t.button)return;let e=t.clientX;const i=this.getOwner().asyncEvent(t=>{const i=t.clientX-e;e=t.clientX,this.getElement().firstElementChild.scrollLeft-=i,this.updateHscroll()}),s=this.getOwner().asyncEvent(()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s)});document.addEventListener("mousemove",i),document.addEventListener("mouseup",s)}updateHscroll(){const t=this.getElement(),e=t.firstElementChild,i=e.scrollLeft;if(t.classList.remove("scrolling"),t.classList.remove("left"),t.classList.remove("right"),e.scrollWidth!==e.offsetWidth){t.classList.add("scrolling");const s=e.scrollWidth-e.offsetWidth;0!==e.scrollLeft&&t.classList.add("left"),e.scrollLeft!==s&&t.classList.add("right"),e.scrollLeft=i}}didInsertElement(){this.getOwner().addAfterRender(()=>{this.updateHscroll()}),this.getElement().addEventListener("wheel",this.wheelEvent)}willRemoveElement(){this.getElement().removeEventListener("wheel",this.wheelEvent)}},qt.components["m-select"]=class extends _{constructor(){super(),this.template="PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIHt7Y2xhc3N9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2hhbmdlIiBvbj0iY2hhbmdlIil9fSBkaXNhYmxlZD17e2Rpc2FibGVkfX0+IHt7I2VhY2ggbU9wdGlvbnMgYXMgfGl0ZW18fX0gPG9wdGlvbiB2YWx1ZT17e2l0ZW0udmFsdWV9fSBzZWxlY3RlZD17eyJpZiIgKCJpcy1lcXVhbCIgaXRlbS52YWx1ZSBtU2VsZWN0ZWQpICJzZWxlY3RlZCJ9fT4ge3tpdGVtLm5hbWV9fSA8L29wdGlvbj4ge3svZWFjaH19IDwvc2VsZWN0Pg==",this.nameKey="",this.valueKey="__index__",this.mOptions=I("options",(function(){return this.options.map((t,e)=>({name:this.nameKey?t[this.nameKey]:t,value:"__index__"===this.valueKey?e:t[this.valueKey]}))})),this.mSelected=I("options","selected",(function(){const t=this.options,e=this.selected,i=t.indexOf(e),s=this.getElement().querySelector(`option:nth-child(${i+1})`);if(s&&(s.selected=!0),~i)return"__index__"===this.valueKey?i:e[this.valueKey]}))}change(){const t=this.getElement().selectedIndex;this.changeAction(this.options[t])}},qt.components["m-tag"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0ibS10YWcgZHJvcGRvd24ge3siaWYiIHJlc3VsdHNWaXNpYmxlICJzaG93In19IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjbGljayIpfX0ge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAia2V5ZG93biIgb249ImtleWRvd24iKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImZvY3VzSW4iIG9uPSJmb2N1cyIgY2FwdHVyZT10cnVlKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImZvY3VzT3V0IiBvbj0iYmx1ciIgY2FwdHVyZT10cnVlKX19PiA8ZGl2IGNsYXNzPSJmb3JtLWNvbnRyb2wge3tjbGFzc319IHt7ImlmIiBmb2N1c2VkICJmb2N1cyJ9fSI+IHt7I2VhY2ggdGFncyBhcyB8dGFnfH19IDxzcGFuIGNsYXNzPSJiYWRnZSI+IHt7dGFnfX0ge3sjaWYgZGlzYWJsZWR9fSB7e2Vsc2V9fSA8c3BhbiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJyZW1vdmUiIHRhZyl9fT54PC9zcGFuPiB7ey9pZn19IDwvc3Bhbj4ge3svZWFjaH19IDxpbnB1dC1jb250cm9sIHZhbHVlPXt7c2VhcmNofX0gZGlzYWJsZWQ9e3tkaXNhYmxlZH19IHBsYWNlaG9sZGVyPXt7cGxhY2Vob2xkZXJ9fSBjaGFuZ2VBY3Rpb249e3siZm4iIGlucHV0Q2hhbmdlQWN0aW9ufX0gLz4gPC9kaXY+IHt7I2lmIHJlc3VsdHMubGVuZ3RofX0gPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51IHt7ImlmIiByZXN1bHRzVmlzaWJsZSAic2hvdyJ9fSI+IHt7I2VhY2ggcmVzdWx0cyBhcyB8cmVzdWx0fH19IDxhIGhyZWY9IiMiIHRhYmluZGV4PS0xIGNsYXNzPSJkcm9wZG93bi1pdGVtIHt7ImlmIiByZXN1bHQuYWN0aXZlICJhY3RpdmUifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImFkZCIgcmVzdWx0KX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImhpZ2hsaWdodCIgcmVzdWx0IG9uPSJtb3VzZWVudGVyIil9fSA+IHt7cmVzdWx0LnRhZ319IDwvYT4ge3svZWFjaH19IDwvdWw+IHt7ZWxzZSBpZiBzdWdnZXN0aW9ucy5sZW5ndGh9fSA8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUge3siaWYiIHJlc3VsdHNWaXNpYmxlICJzaG93In19Ij4gPGEgdGFiaW5kZXg9LTEgY2xhc3M9ImRyb3Bkb3duLWl0ZW0gZGlzYWJsZWQiID4gTm8gcmVzdWx0cyBtYXRjaCB5b3VyIHF1ZXJ5IDwvYT4gPC91bD4ge3svaWZ9fSA8L2Rpdj4=",this.tags=null,this.suggestions=null,this.search="",this.focused=!1,this.disabled=I("subset","suggestions.@each",(function(){return this.subset&&!this.suggestions.length})),this.placeholder=I("subset","suggestions.@each",(function(){return this.subset&&!this.suggestions.length?"There are no items":void 0})),this.results=I("search","tags.@each","suggestions.@each",(function(){const t=this.search,e=this.subset;if(!t&&!e)return v.create();const i=this.tags,s=new RegExp(t,"i");return v.create(this.suggestions.filter(t=>!~i.indexOf(t)).filter(t=>s.test(t)).map(t=>x.create({tag:t,active:!1})))})),this.resultsVisible=I("focused",(function(){return this.focused}))}click(){this.getElement().querySelector("input").focus()}focusIn(){this.focused=!0}focusOut(t){if(t.relatedTarget){if(function(t,e){do{if(t===e)return!0;e=e.parentElement}while(e.parentElement);return!1}(this.getElement(),t.relatedTarget))return}this.focused=!1}add(t,e){this.addAction(t.tag),this.getElement().querySelector("input").focus(),this.search="",e.stopPropagation(),e.preventDefault()}remove(t,e){this.removeAction(t),e.stopPropagation(),e.preventDefault()}highlight(t){const e=this.results;if(!e.length)return;const i=e.filter(t=>!0===t.active)[0];if(e.forEach(t=>t.active=!1),"number"==typeof t){let s=e.indexOf(i);e[s=(s+e.length+t)%e.length].active=!0}else t.active=!0}keydown(t){const e=t;if(38===e.keyCode)this.highlight(-1),e.stopPropagation(),e.preventDefault();else if(40===e.keyCode)this.highlight(1),e.stopPropagation(),e.preventDefault();else if(13===e.keyCode||9===e.keyCode){const t=this.results,i=this.search.trim();this.search="";const s=t.filter(t=>!0===t.active)[0];if(s)this.addAction(s.tag),e.stopPropagation(),e.preventDefault();else if(i.length)this.subset&&!t.filter(t=>t.tag===i)[0]||this.addAction(i),e.stopPropagation(),e.preventDefault();else if(9===e.keyCode)return}else if(8===e.keyCode){if(this.search.length)return;this.tags.length&&this.remove(this.tags[this.tags.length-1],e)}}inputChangeAction(t){this.search=t}},qt.components["notfound-route"]=class extends Q{constructor(){super(),this.template="PGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtZGFuZ2VyIiByb2xlPSJhbGVydCI+IDxzdHJvbmc+RXJyb3I6PC9zdHJvbmc+IFRoaXMgaXMgbm90IGEgdmFsaWQgbWFydiByb3V0ZS4gPC9kaXY+IDxsaW5rLXRvIGhyZWY9Ii8iPkdvIHRvIG92ZXJ2aWV3PC9saW5rLXRvPg=="}},qt.components["widget-clipboard"]=class extends _{constructor(){super(),this.template="PGJ1dHRvbiBjbGFzcz0ie3tjbGFzc319IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjb3B5Iil9fT5Db3B5IHt7bW9kZWwudGl0bGV9fSB0byBjbGlwYm9hcmQgPHdpZGdldC1pY29uIGdseXBoPSJjbGlwYm9hcmQiIC8+PC9idXR0b24+"}copy(){const t=this.getOwner().rootNode.__doc__.createElement("textarea");t.value=this.model.data,this.getElement().appendChild(t),t.select(),this.getOwner().rootNode.__doc__.execCommand("copy"),t.remove()}},qt.components["widget-comment"]=class extends _{constructor(){super(),this.template="PHNwYW4gY2xhc3M9IndpZGdldC1jb21tZW50Ij4gPHNwYW4gY2xhc3M9ImRyb3Bkb3duIHt7ImlmIiBmb2N1c2VkICJzaG93In19Ij4gPHNwYW4gY2xhc3M9ImJhY2tkcm9wIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJmb2N1c0luIil9fT48L3NwYW4+IDxidXR0b24gcm9sZT0iYnV0dG9uIiBjbGFzcz0ie3tjbGFzc319IGRyb3Bkb3duLXRvZ2dsZSIgZGlzYWJsZWQ9e3tmdWxsZGlzYWJsZWR9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJmb2N1c0luIil9fT4gY29tbWVudCA8L2J1dHRvbj4gPGRpdiBjbGFzcz0iZHJvcGRvd24tbWVudSB7eyJpZiIgZm9jdXNlZCAic2hvdyJ9fSB7e21lbnVDbGFzc319Ij4ge3sjaWYgZGlzYWJsZWR9fSA8YSBocmVmPSIjIiBjbGFzcz0iZHJvcGRvd24taXRlbSI+U2lnbiBpbiB0byBjb21tZW50PC9hPiB7e2Vsc2V9fSA8Zm9ybSBjbGFzcz0icHgtMSBweS0xIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzYXZlIiBvbj0ic3VibWl0Iil9fT4gPGlucHV0LXRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIiByb3dzPTEwIGNvbHM9ODAgcGxhY2Vob2xkZXI9IkNvbW1lbnQiIHZhbHVlPXt7Y29tbWVudH19IGNoYW5nZUFjdGlvbj17eyJjdXJyeSIgKCJub2V4cGFuZCIgKCJzZXQiICgibm9leHBhbmQiIGNvbW1lbnQpKSl9fSAvPiA8L2Zvcm0+IDxkaXYgY2xhc3M9ImRyb3Bkb3duLWRpdmlkZXIiPjwvZGl2PiA8Zm9ybSBjbGFzcz0icHgtMSBweS0xIHRleHQtcmlnaHQiPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi14cyIgdHlwZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzYXZlIil9fT5Db21tZW50PC9idXR0b24+IDwvZm9ybT4ge3svaWZ9fSA8L2Rpdj4gPC9zcGFuPiA8L3NwYW4+",this.comment="",this.focused=!1}focusIn(t){console.log("in",t.target),this.focused=!this.focused}focusOut(t){if(console.log("out",t.target,t.relatedTarget),t.relatedTarget){if(function(t,e){do{if(t===e)return!0;e=e.parentElement}while(e.parentElement);return!1}(this.getElement(),t.relatedTarget))return}this.focused=!1}save(t){t.preventDefault(),this.comment&&(this.changeAction(this.comment),this.comment="",this.focused=!1)}},qt.components["widget-dropdown"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0id2lkZ2V0LWRyb3Bkb3duIj4gPG0tc2VsZWN0IG9wdGlvbnM9e3tvcHRpb25zfX0gY2xhc3M9ImZvcm0tY29udHJvbC1zbSIgc2VsZWN0ZWQ9e3tzZWxlY3RlZH19IGNoYW5nZUFjdGlvbj17eyJzZXR0ZXIiICgicGF0aCIgc2VsZWN0ZWQpfX0gLz4gPGRpdiBjbGFzcz0id2lkZ2V0LWNvbnRhaW5lciI+IHt7I2VhY2ggd2lkZ2V0cyBhcyB8d2lkZ2V0fH19IHt7I2lmICgiaXMtZXF1YWwiIHdpZGdldCBjdXJyZW50V2lkZ2V0KX19IDx3aWRnZXQtbG9hZGVyIG1vZGVsPXt7Y3VycmVudFdpZGdldH19IC8+IHt7L2lmfX0ge3svZWFjaH19IDwvZGl2PiA8L2Rpdj4=",this.options=I("model.widgets.@each",(function(){return this.model?this.model.widgets.map(t=>t.title):[]})),this.widgets=I("model.widgets.@each",(function(){return this.model?this.model.widgets.map(t=>Object.assign({},t,{title:void 0})):[]})),this.selected=I("options",(function(){return this.options[0]})),this.currentWidget=I("selected",(function(){const{options:t,selected:e}=this;return this.widgets[t.indexOf(e)]}))}},qt.components["widget-filter"]=class extends _{constructor(){super(),this.template="PGZvcm0gY2xhc3M9ImNhcmQtYm9keSBmaWx0ZXJzIGZvcm0taG9yaXpvbnRhbCB4d2FzLXZhbGlkYXRlZCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiYXBwbHlGaWx0ZXIiIG9uPSJzdWJtaXQiKX19PiA8ZGl2IGNsYXNzPSJyb3cgZm9ybS1ncm91cCBmb3JtLWdyb3VwLXNtIGFkZC1maWx0ZXItYnV0dG9ucyI+IDxkaXYgY2xhc3M9ImNvbC0yIGNvbC1mb3JtLWxhYmVsIGNvbC1mb3JtLWxhYmVsLXNtIj5BZGQgbmV3IGZpbHRlcjwvZGl2PiA8ZGl2IGNsYXNzPSJjb2wiPiA8dWwgY2xhc3M9Imxpc3QtaW5saW5lIj4ge3sjZWFjaCBmaWVsZHMgYXMgfGZpZWxkfH19IDxsaSBjbGFzcz0ibGlzdC1pbmxpbmUtaXRlbSI+IDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4teHMiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImFkZCIgZmllbGQpfX0gZGlzYWJsZWQ9e3tmaWVsZC5hY3RpdmV9fSB0aXRsZT17e2ZpZWxkLnRpdGxlfX0+e3tmaWVsZC50aXRsZX19PC9idXR0b24+IDwvbGk+IHt7L2VhY2h9fSA8L3VsPiA8L2Rpdj4gPC9kaXY+IHt7I2VhY2ggZmllbGRzIGFzIHxmaWVsZHx9fSB7eyNpZiBmaWVsZC5hY3RpdmV9fSA8ZGl2IGNsYXNzPSJyb3cgZm9ybS1ncm91cCBmb3JtLWdyb3VwLXNtIHt7ImlmIiBmaWVsZC5lbnRyeS5lcnJvciAiaXMtaW52YWxpZCJ9fSI+IDxsYWJlbCBjbGFzcz0iY29sLTIgY29sLWZvcm0tbGFiZWwgY29sLWZvcm0tbGFiZWwtc20iPiB7e2ZpZWxkLnRpdGxlfX0gPC9sYWJlbD4ge3sjaWYgKCJpcy1ncmVhdGVyIiBmaWVsZC5vcGVyYXRvcnMubGVuZ3RoIDEpfX0gPGRpdiBjbGFzcz0iY29sLTIiPiA8bS1zZWxlY3Qgb3B0aW9ucz17e2ZpZWxkLm9wZXJhdG9yc319IGNsYXNzPSJmb3JtLWNvbnRyb2wtc20iIHNlbGVjdGVkPXt7ZmllbGQuZW50cnkub3B9fSBjaGFuZ2VBY3Rpb249e3sic2V0dGVyIiAoInBhdGgiIGZpZWxkLmVudHJ5Lm9wKX19IGRpc2FibGVkPXt7ImlmIiAoImlzLWdyZWF0ZXIiIGZpZWxkLm9wZXJhdG9ycy5sZW5ndGggMSkgdW5kZWZpbmVkIHRydWV9fSAvPiA8L2Rpdj4ge3svaWZ9fSA8ZGl2IGNsYXNzPSJjb2wiPiA8ZGVsZWdhdGUtY29tcG9uZW50IGNvbXBvbmVudD0iZmllbGQte3tmaWVsZC52YWx1ZV90eXBlfX0iIGNsYXNzPSJmb3JtLWNvbnRyb2wtc20ge3siaWYiIGZpZWxkLmVudHJ5LmVycm9yICJpcy1pbnZhbGlkIn19IiB2YWx1ZT17e2ZpZWxkLmVudHJ5LnZhbH19IGNvbnN0cmFpbnRzPXt7ZmllbGQuY29uc3RyYWludHN9fSBjaGFuZ2VBY3Rpb249e3sic2V0dGVyIiAoInBhdGgiIGZpZWxkLmVudHJ5LnZhbCl9fSBjaGFuZ2VFcnJvckFjdGlvbj17eyJzZXR0ZXIiICgicGF0aCIgZmllbGQuZW50cnkuZXJyb3IpfX0gLz4ge3sjaWYgZmllbGQuZW50cnkuZXJyb3J9fSA8ZGl2IGNsYXNzPSJpbnZhbGlkLWZlZWRiYWNrIGQtYmxvY2siPnt7ZmllbGQuZW50cnkuZXJyb3J9fTwvZGl2PiB7ey9pZn19IDwvZGl2PiA8ZGl2IGNsYXNzPSJjb2wtMSI+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXNtIiB0eXBlPSJidXR0b24iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInJlbW92ZSIgZmllbGQpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0ieCIgLz4gPC9idXR0b24+IDwvZGl2PiA8L2Rpdj4ge3svaWZ9fSB7ey9lYWNofX0gPGRpdiBjbGFzcz0iZmlsdGVyLWNvbnRyb2xzIHJvdyI+IHt7I2lmIGRlYnVnfX0gPGg0PkZpbHRlciBEZWJ1ZzwvaDQ+IDxwcmU+e3tmaWx0ZXJKU09OfX08L3ByZT4gPHByZT57e2ZpbHRlckJhc2V9fTwvcHJlPiB7ey9pZn19IDxkaXYgY2xhc3M9ImNvbC0xMSB0ZXh0LXJpZ2h0Ij4gPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi1zbSIgZGlzYWJsZWQ9e3siaXMtZXF1YWwiIGZpbHRlckJhc2UgIiJ9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJyZXNldEZpbHRlcnMiKX19PnJlc2V0IGZpbHRlcnM8L2J1dHRvbj4gPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSBidG4tc20iIGRpc2FibGVkPXt7ImlzLWVxdWFsIiBmaWx0ZXJTdHIgZmlsdGVyQmFzZX19PmFwcGx5IGZpbHRlcjwvYnV0dG9uPiA8L2Rpdj4gPC9kaXY+IDwvZm9ybT4=",this.filterStr=I("filter",(function(){return void 0!==this.filter?this.filter:""})),this.filterObj=I((function(){const t={};if(this.filter){const e=JSON.parse(atob(this.filter));for(let[i,s]of Object.entries(e))t[i]=x.create(s)}return x.create(t)})),this.filterJSON=I("model",(function(){y(this,"filterJSON",this.model.filters.reduce((t,e)=>t.concat([`filterObj.${e.key}.op`,`filterObj.${e.key}.val`]),["model"]));const t={};for(let[e,i]of Object.entries(this.filterObj)){const{op:s,val:n}=i;n.length&&(t[e]={op:s,val:n})}return JSON.stringify(t,0,1)})),this.filterBase=I("filterJSON",(function(){return"{}"!==this.filterJSON?btoa(this.filterJSON):""})),this.fields=I("model","filterObj",(function(){const t=this.filterObj;return this.model.filters.map((e,i)=>{const s=t[e.key]||(t[e.key]=x.create({}));return s.op=s.op||e.operators[0],s.val=s.val||("subset"===e.value_type?v.create():""),s.error=null,x.create({key:e.key,title:e.title,operators:e.operators,value_type:e.value_type,constraints:v.create(e.constraints),active:0===i||!!s.val.length,entry:s})})}))}add(t){t.active=!0}remove(t){t.active=!1,t.entry.val=t.entry.val.slice(0,0)}applyFilter(t){this.setAction(this.filterBase),t.preventDefault()}resetFilters(t){Object.values(this.filterObj).forEach(t=>t.val=t.val.slice(0,0)),this.applyFilter(t)}},qt.components["widget-gallery"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0id2lkZ2V0LWdhbGxlcnkiPiB7eyNpZiBzaG93VGl0bGV9fSA8aDQgY2xhc3M9InRleHQtY2VudGVyIj5JbWFnZSB7eygiaW5jcmVtZW50IiBpbmRleCl9fSBvZiB7e21vZGVsLmltYWdlcy5sZW5ndGh9fSA8c21hbGw+e3tpbWFnZS5hbHR9fTwvc21hbGw+PC9oND4ge3svaWZ9fSA8ZGl2IGNsYXNzPSJyb3ciPiA8ZGl2IGNsYXNzPSJjb2wiPiA8ZGl2IGNsYXNzPSJjYXJvdXNlbCI+IDxkaXYgY2xhc3M9ImNhcm91c2VsLWlubmVyIj4ge3sjZWFjaCBtb2RlbC5pbWFnZXMgYXMgfGltYWdlIGl8fX0gPGRpdiBjbGFzcz0iY2Fyb3VzZWwtaXRlbSB7eygiaWYiICgiaXMtZXF1YWwiIGkgaW5kZXgpICJhY3RpdmUiKX19Ij4gPGltZyBjbGFzcz0iaW1nLXJlc3BvbnNpdmUgY2VudGVyLWJsb2NrIiBzcmM9e3tpbWFnZS5zcmN9fSBhbHQ9e3tpbWFnZS5hbHR9fT4gPC9kaXY+IHt7L2VhY2h9fSA8L2Rpdj4gPGEgY2xhc3M9ImNhcm91c2VsLWNvbnRyb2wtcHJldiIgcm9sZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzZXRJbmRleCIgIi0xIil9fT4gPHNwYW4gY2xhc3M9ImNhcm91c2VsLWNvbnRyb2wtcHJldi1pY29uIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3Itb25seSI+UHJldmlvdXM8L3NwYW4+IDwvYT4gPGEgY2xhc3M9ImNhcm91c2VsLWNvbnRyb2wtbmV4dCIgcm9sZT0iYnV0dG9uIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzZXRJbmRleCIgIisxIil9fT4gPHNwYW4gY2xhc3M9ImNhcm91c2VsLWNvbnRyb2wtbmV4dC1pY29uIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3Itb25seSI+TmV4dDwvc3Bhbj4gPC9hPiA8L2Rpdj4gPC9kaXY+IHt7I2lmIGhhc0Jsb2NrfX08ZGl2IGNsYXNzPSJjb2wtMyI+PHlpZWxkLWJsb2NrIC8+PC9kaXY+e3svaWZ9fSA8L2Rpdj4gPHVsIGNsYXNzPSJpbWFnZS1zdHJpcGUiPiB7eyNlYWNoIG1vZGVsLmltYWdlcyBhcyB8aW1hZ2UgaXx9fSA8bGk+IDxkaXYgY2xhc3M9ImltZy10aHVtYm5haWwtd3JhcHBlciB7eyJpZiIgKCJpcy1lcXVhbCIgaSBpbmRleCkgImFjdGl2ZSJ9fSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAic2V0SW5kZXgiIGkpfX0+IDxpbWcgc3JjPXt7aW1hZ2Uuc3JjfX0gYWx0PXt7aW1hZ2UuYWx0fX0+IDwvZGl2PiA8L2xpPiB7ey9lYWNofX0gPC91bD4gPC9kaXY+",this.index=0,this.image=I("index",(function(){return this.model.images[this.index]}))}setIndex(t){"-1"===t?this.index>0&&this.index--:"+1"===t?this.index<this.model.images.length-1&&this.index++:this.index=t}},qt.components["widget-icon"]=class extends _{constructor(){super(),this.template="PHNwYW4gY2xhc3M9IndpZGdldC1pY29uIHt7Y2xhc3N9fSIgdGl0bGU9e3t0aXRsZX19Pnt7c3ZnfX08L3NwYW4+",this.svg=I("glyph",(function(){(async()=>{const t=await fetch(`app/styles/icons/${this.glyph}.svg`),e=await t.text();if(!/^<svg/.test(e))return console.log("Missing",this.glyph),null;const i=(new DOMParser).parseFromString(e,"application/xml"),s=this.getElements()[0];s&&(Array.from(s.querySelectorAll("svg")).forEach(t=>t.remove()),s.appendChild(s.ownerDocument.importNode(i.documentElement,!0)))})()}))}},qt.components["widget-image"]=class extends _{constructor(){super(),this.template="PGltZyBjbGFzcz17e2NsYXNzfX0gc3JjPSJ7e21vZGVsLnNyY319IiBhbHQ9e3ttb2RlbC5hbHR9fSB3aWR0aD17e21vZGVsLndpZHRofX0+",this.class="img-responsive widget-img"}},qt.components["widget-keyval"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0id2lkZ2V0LWtleXZhbCI+IDx1bCBjbGFzcz0ibGlzdC1pbmxpbmUiPiB7eyNlYWNoIG1vZGVsLml0ZW1zIGFzIHxyb3cgaW5kZXh8fX0gPGxpIGNsYXNzPSJsaXN0LWlubGluZS1pdGVtIj4gPGRpdiBjbGFzcz0idmFsdWUiPiB7eyNpZiByb3cubGlzdH19IHt7I2VhY2ggcm93LnZhbHVlIGFzIHx2YWx8fX0ge3soKCJjb25jYXQiICJmb3JtYXQtIiByb3cuZm9ybWF0dGVyKSB2YWwpfX0ge3svZWFjaH19IHt7ZWxzZX19IHt7KCgiY29uY2F0IiAiZm9ybWF0LSIgcm93LmZvcm1hdHRlcikgcm93LnZhbHVlKX19IHt7L2lmfX0gPC9kaXY+IDxkaXYgY2xhc3M9InVpbnQiPiB7e3Jvdy50aXRsZX19IDwvZGl2PiA8L2xpPiB7ey9lYWNofX0gPC91bD4gPC9kaXY+"}},qt.components["widget-link"]=class extends _{constructor(){super(),this.template="PGEgY2xhc3M9e3tjbGFzc319IGhyZWY9e3ttb2RlbC5ocmVmfX0gZG93bmxvYWQ9e3ttb2RlbC5kb3dubG9hZH19Pnt7bW9kZWwudGl0bGV9fTwvYT4="}},qt.components["widget-loader"]=class extends _{constructor(){super(),this.template="e3sjaWYgcHJvdG99fSB7eyNpZiBkYXRhfX0gPGg1Pnt7bW9kZWwudGl0bGV9fTwvaDU+IDxkZWxlZ2F0ZS1jb21wb25lbnQgY29tcG9uZW50PSJ3aWRnZXQte3ttb2RlbC50eXBlfX0iIG1vZGVsPXt7ZGF0YX19IC8+IHt7ZWxzZX19IDxkaXYgY2xhc3M9ImNzc2xvYWQtbG9hZGVyIj4gPGRpdiBjbGFzcz0iY3NzbG9hZC1pbm5lciBjc3Nsb2FkLTEiPjwvZGl2PiA8ZGl2IGNsYXNzPSJjc3Nsb2FkLWlubmVyIGNzc2xvYWQtMiI+PC9kaXY+IDxkaXYgY2xhc3M9ImNzc2xvYWQtaW5uZXIgY3NzbG9hZC0zIj48L2Rpdj4gPGRpdiBjbGFzcz0iY3NzbG9hZC1pbm5lciBjc3Nsb2FkLTQiPjwvZGl2PiA8L2Rpdj4ge3svaWZ9fSB7e2Vsc2V9fSBXaWRnZXQgPHN0cm9uZz57e21vZGVsLnR5cGV9fTwvc3Ryb25nPiBub3QgYXZhaWxhYmxlIHt7L2lmfX0=",this.route=I((function(){return this.getOwner().lookup("detail-route")})),this.proto=I("model.type",(function(){return this.getOwner().components[`widget-${this.model.type}`]})),this.data=I("model.data",(function(){const t=this.model.data;if(Ot.test(t)){const e=`dataset/${this.route.params.id}/${t.replace(Ot,"")}`;return this.getOwner().lookup("application-route").api({url:e},!0).then(t=>{this.model.data=this.data=t}),null}return t}))}},qt.components["widget-map"]=class extends ct{constructor(){super(),this.template="PGRpdiBjbGFzcz0id2lkZ2V0LW1hcCI+IDxjYW52YXM+e3tnbHlSZW5kZXJ9fTwvY2FudmFzPiB7eyNpZiBnbH19IHt7I2VhY2ggbGF5ZXJzIGFzIHxsYXllciBpbmRleHx9fSB7eyNpZiAoImlzLWVxdWFsIiBsYXllci50eXBlICJ0aWxlcyIpfX0gPGdseWNpbmUtdHlsZXIgbW9kZWw9e3tsYXllcn19IGluZGV4PXt7aW5kZXh9fSB6PXt7en19IHBvcz17e3Bvc319IGdsPXt7Z2x9fSBhZGQ9e3thZGR9fSByZW1vdmU9e3tyZW1vdmV9fSB3b3JsZD17e3dvcmxkfX0gLz4ge3tlbHNlIGlmICgiaXMtZXF1YWwiIGxheWVyLnR5cGUgImdlb2pzb24iKX19IDxnbHljaW5lLWdlb2pzb24gbW9kZWw9e3tsYXllcn19IGluZGV4PXt7aW5kZXh9fSBnbD17e2dsfX0gYWRkPXt7YWRkfX0gcmVtb3ZlPXt7cmVtb3ZlfX0gd29ybGQ9e3t3b3JsZH19IHRpbWVSYW5nZT17e3RpbWVSYW5nZX19IHdpZHRoPXt7d2lkdGh9fSBoZWlnaHQ9e3toZWlnaHR9fSAvPiB7e2Vsc2V9fSBMYXllciB7e2xheWVyLnR5cGV9fSBub3Qgc3VwcG9ydGVkIHt7L2lmfX0ge3svZWFjaH19IHt7L2lmfX0gPGRpdiBjbGFzcz0ib25kZW1hbmQgY29udHJvbHMgdG9wIGxlZnQgYnRuLWdyb3VwIj4gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJ6b29tIiAtMSl9fT4gPHdpZGdldC1pY29uIGdseXBoPSJ6b29tLW91dCIgLz4gPC9idXR0b24+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiem9vbSIgMCl9fT4gPHdpZGdldC1pY29uIGdseXBoPSJmdWxsc2NyZWVuLWV4aXQiIC8+IDwvYnV0dG9uPiA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInpvb20iIDEpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0iem9vbS1pbiIgLz4gPC9idXR0b24+IDwhLS0gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJ6b29tIiAiZnVsbCIpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0iZnVsbHNjcmVlbi1lbnRlciIgLz4gPC9idXR0b24+IC0tPiA8IS0tIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiBjYW1tb2RlKSAibm9ybWFsIikpfX0+IGRlZiA8L2J1dHRvbj4gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IiB7eyJhY3Rpb24iICgibm9leHBhbmQiICgic2V0dGVyIiAoInBhdGgiIGNhbW1vZGUpICJwZXJzcGVjdGl2ZSIpKX19PiBwZXIgPC9idXR0b24+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAoInNldHRlciIgKCJwYXRoIiBjYW1tb2RlKSAiY2hpbGQiKSl9fT4gZnAgPC9idXR0b24+IC0tPiA8L2Rpdj4gPGRpdiBjbGFzcz0ieG9uZGVtYW5kIGNvbnRyb2xzIHRvcCByaWdodCBkLWZsZXggYWxpZ24taXRlbXMtdG9wIj4ge3sjaWYgYnVyZ2VyT3Blbn19IDxmb3JtIGNsYXNzPSJsZWdlbmQgb25kZW1hbmQgZmxleC1jb2x1bW4gZC1pbmxpbmUtYmxvY2siPiB7eyNlYWNoIGxheWVycyBhcyB8bGF5ZXIgaW5kZXh8fX0ge3sjaWYgKCJpcy1lcXVhbCIgbGF5ZXIudHlwZSAidGlsZXMiKX19IDxtLXNlbGVjdCBjbGFzcz0iY3VzdG9tLXNlbGVjdCIgb3B0aW9ucz17e2xheWVyLnRpbGVzfX0gbmFtZUtleT0idGl0bGUiIHZhbHVlS2V5PSJ1cmwiIHNlbGVjdGVkPXt7bGF5ZXIudGlsZX19IGNoYW5nZUFjdGlvbj17eyJzZXR0ZXIiICgicGF0aCIgbGF5ZXIudGlsZSl9fSAvPiB7e2Vsc2UgaWYgKCJub3QiICgiaXMtZXF1YWwiIGxheWVyLnRpdGxlLjAgIl8iKSl9fSA8ZGl2IGNsYXNzPSJjdXN0b20tY29udHJvbCBjdXN0b20tY2hlY2tib3giPiA8aW5wdXQgaWQ9Int7b2lkfX1sYXllcnt7aW5kZXh9fSIgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJjdXN0b20tY29udHJvbC1pbnB1dCIgY2hlY2tlZD17eyJub3QiIGxheWVyLmhpZGRlbn19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInRvZ2dsZUxheWVyIiBsYXllcil9fSAvPiA8bGFiZWwgY2xhc3M9ImN1c3RvbS1jb250cm9sLWxhYmVsIiBmb3I9Int7b2lkfX1sYXllcnt7aW5kZXh9fSI+IDxzcGFuIGNsYXNzPSJsYXllciIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6e3tsYXllci5jb2xvcn19OyBoZWlnaHQ6MTRweDsgdmVydGljYWwtYWxpZ246bWlkZGxlIj4mbmJzcDs8L3NwYW4+IHt7bGF5ZXIudGl0bGV9fSA8L2xhYmVsPiA8L2Rpdj4ge3svaWZ9fSB7ey9lYWNofX0gPC9mb3JtPiB7ey9pZn19IDxkaXY+IDwhLS0gVE9ETzogZmlndXJlIG91dCB3aHkgdGhpcyB3b3JrcywgYW5kIGlmIGl0J3MgcmVsaWFibGUgLS0+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIge3siYWN0aW9uIiAoInNldHRlciIgKCJwYXRoIiBidXJnZXJPcGVuKSAoIm5vdCIgYnVyZ2VyT3BlbikpfX0+IDx3aWRnZXQtaWNvbiBnbHlwaD0ibWVudSIgLz4gPC9idXR0b24+IDwvZGl2PiA8L2Rpdj4gPC9kaXY+",this.oid=I(()=>this.__oid__),this.nextPlaytime=null,this.controls=!0,this.playState="stopped",this.playSpeed=1,this.playLength=240,this.timeRange=I("timebox","playState","playTime","playLength",(function(){return"stopped"===this.playState?this.timebox:[this.playTime-1e3*this.playLength,this.playTime]})),this.layers=I("model",(function(){return this.model.zoom=[-30,40],v.from(this.model.layers.map(t=>{if((t=x.create(t)).color instanceof Array&&t.color.length){const[e,i,s,n]=t.color.map(t=>255*t|0);t.color=`rgba(${e}, ${i}, ${s}, ${n})`}if("tiles"===t.type)t.tile=t.tiles[0];else if("geojson"===t.type){const e=t.geojson.features.reduce((e,i)=>{const{type:s,coordinates:n}=i.geometry;return"LineString"===s?("WGS84"===i.properties.coordinatesystem&&(i.geometry.coordinates=n.map(t=>$t(t)),i.properties.coordinatesystem="cartesian"),e.concat(i.geometry.coordinates)):"Polygon"===s?("WGS84"===i.properties.coordinatesystem&&(i.geometry.coordinates[0]=n[0].map(t=>$t(t)),i.properties.coordinatesystem="cartesian"),e.concat(i.geometry.coordinates[0])):"Circle"===s||"Point"===s?("WGS84"===i.properties.coordinatesystem&&(i.geometry.coordinates=$t(n),i.properties.coordinatesystem="cartesian"),t.hidden?e:e.concat([i.geometry.coordinates])):void console.assert(!1,`${i.geometry.type} not supported`)},[]);let i=1/0,s=-1/0,n=-1/0,l=1/0;e.forEach(([t,e])=>{t<i&&(i=t),t>n&&(n=t),e<l&&(l=e),e>s&&(s=e)}),t.bbox=[i,s,n,l];const r=t.geojson.features.filter(({properties:t})=>t.timestamps&&t.timestamps.length);r.length&&(t.timebox=r.reduce((t,{properties:e})=>[Math.min(t[0],e.timestamps[0]),Math.max(t[1],e.timestamps.slice(-1)[0])],[1/0,-1/0]))}return t}))})),this.bbox=I("layers",(function(){const t=this.layers.filter(t=>t.bbox).map(t=>t.bbox);return[Math.min.apply(null,t.map(t=>t[0])),Math.max.apply(null,t.map(t=>t[1])),Math.max.apply(null,t.map(t=>t[2])),Math.min.apply(null,t.map(t=>t[3]))]})),this.timebox=I("layers",(function(){const t=this.layers.filter(t=>t.timebox).map(t=>t.timebox);return t.length?[Math.min.apply(null,t.map(t=>t[0])),Math.max.apply(null,t.map(t=>t[1]))]:null})),this.playTime=I("timebox",(function(){return this.timebox?this.timebox[0]:null})),this.duration=I("timebox",(function(){const{timebox:t}=this;return t[1]-t[0]})),this.pos=I("bbox",(function(){return[(this.bbox[0]+this.bbox[2])/2,(this.bbox[1]+this.bbox[3])/2]})),this.z_auto=I("bbox","width","height",(function(){const t=this.bbox,e=t[2]-t[0],i=t[1]-t[3];if(0===e||0===i)return 30;const[s,n]=this.model.zoom,{width:l,height:r}=this;let a;for(a=n;a>s&&!(e*2**a<l&&i*2**a<r);a--);return a})),this.z_manual=null,this.z=I("z_auto","z_manual",(function(){const{z_auto:t,z_manual:e}=this;return null!==e?e:t})),this.world=I("pos","z","width","height","children.@each.layerWorld","cammode",(function(){const{cammode:t}=this;if("child"===t){const t=this.children.filter(t=>t.layerWorld)[0];return t?t.layerWorld.slice():q()}if("perspective"===t){const{width:t,height:e}=this;let i=q();return i=st(i=tt(Math.PI/2,t/e,1,1e3),rt([0,-40,60],[0,0,0],[0,0,1])),i=st(i,it(2**this.z,2**this.z,1)),i=st(i,et(-this.pos[0],-this.pos[1],0))}{const{width:t,height:e}=this;let i=q();return i=st(i,[2/t,0,0,0,0,2/e,0,0,0,0,-2/(1- -1),0,0,0,0,1]),i=st(i,it(2**this.z,2**this.z,1)),i=st(i,et(-this.pos[0],-this.pos[1],0))}})),this.pnow=I("playState",(function(){return this.getOwner().now})),this.playing=I("playState",(function(){return"playing"===this.playState})),this.localDirty=I("__owner__.now","playState","playTime","layers.@each.hidden","world",(function(){return!0})),this.infull=!1}zoom(t){if(t)if("full"===t){if(this.infull)document.webkitExitFullscreen();else{this.getElement().webkitRequestFullScreen()}this.infull=!this.infull}else{const[e,i]=this.model.zoom;this.z=Math.min(i,Math.max(e,this.z+t))}else this.bbox=this.bbox.slice()}toggleLayer(t){t.hidden=!t.hidden}panAndZoom(t,e,i){1===i&&(t=-t/2,e=-e/2),i=this.z-i;const[s,n]=this.model.zoom;s<=i&&i<=n&&(this.pos=[this.pos[0]-t/2**i,this.pos[1]-e/2**i],this.z_manual=i)}},qt.components["widget-modal"]=class extends _{constructor(){super(),this.template="e3sjaWYgb3Blbn19IDxkaXYgY2xhc3M9Im1vZGFsIHt7ImlmIiBvcGVuICJzaG93In19IHt7Y2xhc3N9fSIgc3R5bGU9ImRpc3BsYXk6YmxvY2s7Ij4gPGRpdiBjbGFzcz0ibW9kYWwtZGlhbG9nIj4gPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCI+IDxkaXYgY2xhc3M9Im1vZGFsLWhlYWRlciI+IDxoNSBjbGFzcz0ibW9kYWwtdGl0bGUiPnt7dGl0bGV9fTwvaDU+IDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtbGFiZWw9IkNsb3NlIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJjbG9zZSIpfX0+IDxzcGFuIGFyaWEtaGlkZGVuPSJ0cnVlIj4mdGltZXM7PC9zcGFuPiA8L2J1dHRvbj4gPC9kaXY+IDxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPiA8eWllbGQtYmxvY2sgcGFyYW1zPXt7ImJvZHkifX0gLz4gPC9kaXY+IDxkaXYgY2xhc3M9Im1vZGFsLWZvb3RlciI+IDx5aWVsZC1ibG9jayBwYXJhbXM9e3siZm9vdGVyIn19IC8+IDwhLS0gPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImNsb3NlIil9fT4gQ2xvc2UgPC9idXR0b24+IC0tPiA8L2Rpdj4gPC9kaXY+IDwvZGl2PiA8L2Rpdj4ge3svaWZ9fQ=="}close(){this.setOpen(!1)}},qt.components["widget-pre"]=class extends _{constructor(){super(),this.template="PHByZSBjbGFzcz17e2NsYXNzfX0+e3ttb2RlbC50ZXh0fX08L3ByZT4="}},qt.components["widget-table"]=class extends _{constructor(){super(),this.template="PGRpdiBjbGFzcz0id2lkZ2V0LXRhYmxlIj4gPGRpdiBjbGFzcz0iYWN0aW9ucyBkLWZsZXgiPiA8ZGl2IGNsYXNzPSJmbGV4LWdyb3ctMSI+IHt7I2lmIHBhZ2luYXRlZC5sZW5ndGh9fSB7eyNpZiBzZWxlY3RhYmxlfX0gPGxhYmVsIHN0eWxlPSJwYWRkaW5nLWxlZnQ6IDhweCIgY2xhc3M9Im1yLTIiPiA8aW5wdXQtY2hlY2tib3ggdmFsdWU9e3thbGxDaGVja2VkfX0gY2hhbmdlQWN0aW9uPXt7ImZuIiB0b2dnbGVBbGx9fSAvPiBBbGwgKHt7c2VsZWN0ZWRSb3dzLmxlbmd0aH19IHJvd3Mgc2VsZWN0ZWQpIDwvbGFiZWw+IHt7L2lmfX0gPGRpdiBjbGFzcz0iZC1pbmxpbmUtYmxvY2siPiA8eWllbGQtYmxvY2sgcGFyYW1zPXt7c2VsZWN0ZWRSb3dzfX0gLz4gPC9kaXY+IHt7L2lmfX0gPC9kaXY+IDwvZGl2PiA8ZGl2IGNsYXNzPSJzY3JvbGwtd3JhcCI+IDx0YWJsZSBjbGFzcz0idGFibGUgdGFibGUtaG92ZXIiPiA8dGhlYWQ+IDx0cj4ge3sjaWYgc2VsZWN0YWJsZX19PHRoPjwvdGg+e3svaWZ9fSB7eyNlYWNoIGNvbHVtbnMgYXMgfGNvbCBpbmRleHx9fSA8dGggY2xhc3M9ImludGVyYWN0aXZlIHRleHQte3tjb2wuYWxpZ259fSB7eyJpZiIgKCJhbmQiIHZpc2liaWxpdHlPcGVuICgibm90IiBjb2wudmlzaWJsZSkpICJiZy1zZWNvbmRhcnkifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInNvcnRieSIgaW5kZXgpfX0+IHt7Y29sLnRpdGxlfX17eyNpZiAoImlzLWVxdWFsIiBpbmRleCBzb3J0KX19IDx3aWRnZXQtaWNvbiBjbGFzcz0iYmFzZWxpbmUiIGdseXBoPSJzb3J0LXt7ImlmIiBkZXNjZW5kaW5nICJkZXNjZW5kaW5nIiAiYXNjZW5kaW5nIn19IiAvPnt7ZWxzZX19Jm5ic3A7e3svaWZ9fSA8L3RoPiB7ey9lYWNofX0gPC90cj4gPC90aGVhZD4gPHRib2R5PiB7eyNlYWNoICgiemlwIiBwYWdpbmF0ZWQgY2hlY2tib3hlcykgYXMgfHJvdyBpbmRleHx9fSA8dHIgY2xhc3M9InhtLWFuaW1hdGUiPiB7eyNpZiBzZWxlY3RhYmxlfX0gPHRkPiA8aW5wdXQtY2hlY2tib3ggdmFsdWU9e3tyb3cuMX19IGNoYW5nZUFjdGlvbj17eyJmbiIgdG9nZ2xlSXRlbSBpbmRleH19IC8+IDwvdGQ+IHt7L2lmfX0ge3sjZWFjaCAoInppcCIgY29sdW1ucyByb3cuMC52YWx1ZXMpIGFzIHxjb2x8fX0gPHRkIGNsYXNzPSJ0ZXh0LXt7Y29sLjAuYWxpZ259fSI+IHt7I2lmIGNvbC4wLmxpc3R9fSB7eyNlYWNoIGNvbC4xIGFzIHx2YWx8fX0ge3soY29sLjAuZm9ybWF0dGVyIHZhbCl9fSB7ey9lYWNofX0ge3tlbHNlfX0ge3soY29sLjAuZm9ybWF0dGVyIGNvbC4xKX19IHt7L2lmfX0gPC90ZD4ge3svZWFjaH19IDwvdHI+IHt7L2VhY2h9fSA8L3Rib2R5PiA8L3RhYmxlPiA8L2Rpdj4ge3sjaWYgKCJpcy1ncmVhdGVyIiBudW1QYWdlcyAxKX19IDxuYXYgY2xhc3M9InRleHQtY2VudGVyIj4gPHVsIGNsYXNzPSJwYWdpbmF0aW9uIHBhZ2luYXRpb24tc20gZC1pbmxpbmUtZmxleCI+IDxsaSBjbGFzcz0icGFnZS1pdGVtIHt7ImlmIiBwYWdlci5wcmV2LmRpc2FibGVkICJkaXNhYmxlZCJ9fSI+IDxhIGhyZWY9IiMiIGNsYXNzPSJwYWdlLWxpbmsiIGFyaWEtbGFiZWw9IlByZXZpb3VzIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJwcmV2UGFnZSIpfX0+IDxzcGFuIGFyaWEtaGlkZGVuPSJ0cnVlIj4mbGFxdW87PC9zcGFuPiA8L2E+IDwvbGk+IHt7I2VhY2ggcGFnZXIucGFnZXMgYXMgfHBhZ2V8fX0gPGxpIGNsYXNzPSJwYWdlLWl0ZW0ge3siaWYiIHBhZ2UuYWN0aXZlICJhY3RpdmUifX0ge3siaWYiIHBhZ2UuZGlzYWJsZWQgImRpc2FibGVkIn19Ij48YSBocmVmPSIjIiBjbGFzcz0icGFnZS1saW5rIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJzZXRwYWdlIiBwYWdlLm51bSl9fT57e3BhZ2UubnVtfX08L2E+PC9saT4ge3svZWFjaH19IDxsaSBjbGFzcz0icGFnZS1pdGVtIHt7ImlmIiBwYWdlci5uZXh0LmRpc2FibGVkICJkaXNhYmxlZCJ9fSI+IDxhIGhyZWY9IiMiIGNsYXNzPSJwYWdlLWxpbmsiIGFyaWEtbGFiZWw9Ik5leHQiIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgIm5leHRQYWdlIil9fT4gPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPiZyYXF1bzs8L3NwYW4+IDwvYT4gPC9saT4gPC91bD4gPC9uYXY+IHt7L2lmfX0gPC9kaXY+",this.selectable=I("selectableForce","model.actions",(function(){return this.selectableForce||!(!this.model.actions||!this.model.actions.length)})),this.columns=I("model",(function(){const t=JSON.parse(localStorage.getItem(this.cacheid)||'{"visibility":{}}');return v.from(this.model.columns,e=>Object.assign(new x,e,{formatter:`format-${e.formatter}`,visible:!1!==t.visibility[e.title],query:""}))})),this.indices=I("model",(function(){return Uint32Array.from({length:this.model.rows.length},(t,e)=>e)})),this.selected=I("model",(function(){return new Int8Array(this.model.rows.length)})),this.allChecked=!1,this.selectedRows=new v,this.sort=I("model.sortcolumn",(function(){return this.model.sortcolumn})),this.descending=I("model.sortorder",(function(){return"descending"===this.model.sortorder})),this.cache=I("model",(function(){return this.model.__cache||(this.model.__cache={}),this.model.__cache})),this.omodel=I("model",(function(){return x.create(this.model)})),this.sortedidxs=I("sort","descending","model.rows",(function(){const{model:{rows:t},sort:e,descending:i,cache:s,indices:n}=this;if(null===e||!t.length)return new Uint32Array;const l=`sort${e}`;if(!(l in s)){let i;if(this.model.columns[e].sortkey){const t=this.model.columns[e].sortkey;i=e=>null!==e?e[t]:""}else i=this.model.columns[e].list?t=>null!==t?t.length:"":t=>null!==t?t:"";const r=t.map(t=>i(t.values[e])),a=n.slice();Gt(a,(t,e)=>(t=r[t])===(e=r[e])?0:t>e?1:-1),s[l]=a}return i?s[l].slice().reverse():s[l]})),this.page=0,this.pagesizes=[50,100],this.pagesize=50,this.filteredidxs=I("sortedidxs","model.rows","filtersOpen","columns.@each.query",(function(){const{model:{rows:t},sortedidxs:e}=this;let i;return i=e})),this.pageidxs=I("filteredidxs","page","pagesize","columns",(function(){const{page:t,pagesize:e,filteredidxs:i}=this;return-1===e?i:i.subarray(t*e,(t+1)*e)})),this.checkboxes=I("pageidxs",(function(){const{selected:t}=this;return v.from(this.pageidxs,e=>t[e])})),this.numPages=I("filteredidxs","pagesize",(function(){return this.pagesize?Math.ceil(this.filteredidxs.length/this.pagesize):1})),this.paginated=I("pageidxs",(function(){const{pageidxs:t}=this;return Array.from(t,t=>this.model.rows[t])})),this.pagersize=7,this.pager=I("page","pagesize","filteredidxs",(function(){if(this.filteredidxs.length<this.pagesize)return[];const t={prev:{disabled:0===this.page,page:this.page-1},next:{disabled:this.page===this.numPages-1,page:this.page+1},pages:[]};for(let e=0,i=this.numPages;e<i;e++)t.pages.push({num:e+1,active:e===this.page});if(t.pages.length>this.pagersize){const e={num:"...",disabled:!0},i=this.pagersize-1,s=i>>1,n=(i>>1)+(1&i);this.page<=s?t.pages.splice(i-1,t.pages.length-i,e):this.page>=t.pages.length-1-n?t.pages.splice(1,t.pages.length-i,e):(t.pages.splice(this.page+n-1,t.pages.length-1-(this.page+n-1),e),t.pages.splice(1,this.page-(s-1),e))}return t}))}toggleItem(t){const e=this.pageidxs[t];this.checkboxes[t]=!this.checkboxes[t],this.selected[e]=!this.selected[e],this.allChecked=!this.selected.some(t=>!t);const i=this.model.rows[e];this.selected[e]?this.selectedRows.push(i):this.selectedRows.splice(this.selectedRows.indexOf(i),1),this.selectionChange&&this.selectionChange(this.selectedRows)}toggleAll(){this.allChecked?(this.checkboxes.fill(0),this.selected.fill(0)):(this.checkboxes.fill(1),this.selected.fill(1)),this.allChecked=!this.selected.some(t=>!t),this.allChecked?this.selectedRows=v.from(this.model.rows):this.selectedRows=new v,this.selectionChange&&this.selectionChange(this.selectedRows)}prevPage(t){t.preventDefault(),this.page>0&&this.page--}nextPage(t){t.preventDefault(),this.page<this.numPages-1&&this.page++}setpage(t,e){e.preventDefault(),"..."!==t&&(this.page=t-1)}sortby(t){this.sort===t?this.descending=!this.descending:(this.descending=!1,this.sort=t)}},qt.components["widget-tag"]=class extends _{constructor(){super(),this.template="PHNwYW4gY2xhc3M9IndpZGdldC10YWciPiA8c3BhbiBjbGFzcz0iZHJvcGRvd24ge3siaWYiIGZvY3VzZWQgInNob3cifX0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImtleWRvd24iIG9uPSJrZXlkb3duIil9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJmb2N1c0luIiBvbj0iZm9jdXNpblgiKX19IHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgImZvY3VzT3V0IiBvbj0iZm9jdXNvdXRYIil9fT4gPHNwYW4gY2xhc3M9ImJhY2tkcm9wIiB7eyJhY3Rpb24iICgibm9leHBhbmQiICJmb2N1c0luIil9fT48L3NwYW4+IDxidXR0b24gcm9sZT0iYnV0dG9uIiBjbGFzcz0ie3tjbGFzc319IGRyb3Bkb3duLXRvZ2dsZSIgZGlzYWJsZWQ9e3tmdWxsZGlzYWJsZWR9fSB7eyJhY3Rpb24iICgibm9leHBhbmQiICJmb2N1c0luIil9fT50YWc8L2J1dHRvbj4gPGRpdiBjbGFzcz0iZHJvcGRvd24tbWVudSB7eyJpZiIgZm9jdXNlZCAic2hvdyJ9fSB7e21lbnVDbGFzc319Ij4ge3sjaWYgZGlzYWJsZWR9fSA8YSBjbGFzcz0iZHJvcGRvd24taXRlbSIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiYWx0QWN0aW9uIil9fT5TaWduIGluIHRvIHRhZzwvYT4ge3tlbHNlfX0gPGZvcm0gY2xhc3M9InB4LTEgcHktMSI+IDxpbnB1dC1jb250cm9sIHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIiBwbGFjZWhvbGRlcj0iTGFiZWwiIHZhbHVlPXt7c2VhcmNofX0gY2hhbmdlQWN0aW9uPXt7ImN1cnJ5IiAoIm5vZXhwYW5kIiAoInNldCIgKCJub2V4cGFuZCIgc2VhcmNoKSkpfX0gLz4gPC9mb3JtPiA8ZGl2IGNsYXNzPSJkcm9wZG93bi1kaXZpZGVyIj48L2Rpdj4ge3sjZWFjaCByZXN1bHRzIGFzIHx0YWd8fX0gPGEgY2xhc3M9ImRyb3Bkb3duLWl0ZW0iIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInRvZ2dsZSIgdGFnKX19IHRpdGxlPXt7dGFnLmhpbnR9fSB0YWJpbmRleD0tMT4gPHdpZGdldC1pY29uIGNsYXNzPSJiYXNlbGluZSIgZ2x5cGg9e3siaWYiIHRhZy5zdGF0ZSB0YWcuc3RhdGUgImRpZmYtYWRkZWQifX0gLz4ge3t0YWcubmFtZX19IDwvYT4ge3svZWFjaH19IDxkaXYgY2xhc3M9ImRyb3Bkb3duLWRpdmlkZXIiPjwvZGl2PiA8Zm9ybSBjbGFzcz0icHgtMSB4cHktMSB0ZXh0LXJpZ2h0Ij4gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4teHMiIHR5cGU9ImJ1dHRvbiIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAiY2FuY2VsIil9fT5DYW5jZWw8L2J1dHRvbj4gPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4teHMiIHR5cGU9ImJ1dHRvbiIge3siYWN0aW9uIiAoIm5vZXhwYW5kIiAic2F2ZSIpfX0gZGlzYWJsZWQ9e3t1bnNhdmVhYmxlfX0+U2F2ZSB0YWdzPC9idXR0b24+IDwvZm9ybT4ge3svaWZ9fSA8L2Rpdj4gPC9zcGFuPiA8L3NwYW4+",this.tags=null,this.alltags=null,this.search="",this.changed=!1,this.unsaveable=I("changed",(function(){return!this.changed})),this.realtags=I("focused",(function(){if(this.tags.length){if("string"==typeof this.tags[0])return v.create(this.tags);{let t=this.tags[0].tags.slice();return this.tags.forEach(e=>{t=t.filter(t=>~e.tags.indexOf(t))}),v.create(t)}}return v.create()})),this.mtags=I("realtags",(function(){return v.create(this.realtags)})),this.malltags=I("focused",(function(){return v.create(this.alltags)})),this.vtags=I("mtags.@each","malltags.@each",(function(){return v.create(this.realtags.map(t=>x.create({name:t,state:~this.mtags.indexOf(t)?"task":"task-no"})).concat(this.malltags.filter(t=>!~this.realtags.indexOf(t)).map(t=>x.create({name:t,state:~this.mtags.indexOf(t)?"task":"task-no"}))))})),this.results=I("search","vtags.@each",(function(){const t=this.search,e=new RegExp(t,"i"),i=v.create(this.vtags.filter(t=>e.test(t.name)));return t&&!i.filter(e=>e.name===t).length&&i.push(x.create({name:`create "${t}"`,action:"create",label:this.search})),i})),this.focused=!1}focusIn(t){console.log("in",t.target),this.search="",this.changed=!1,this.focused=!this.focused}focusOut(t){if(console.log("out",t.target,t.relatedTarget),t.relatedTarget){if(function(t,e){do{if(t===e)return!0;e=e.parentElement}while(e.parentElement);return!1}(this.getElement(),t.relatedTarget))return}this.focused=!1}toggle(t){"create"===t.action?(this.mtags.push(this.search),~this.malltags.indexOf(this.search)||this.malltags.push(this.search),this.search=""):~this.mtags.indexOf(t.name)?this.mtags.splice(this.mtags.indexOf(t.name),1):this.mtags.push(t.name),this.changed=!0}keydown(t){const e=t;13===e.keyCode&&(this.search&&(~this.malltags.indexOf(this.search)?~this.mtags.indexOf(this.search)?this.mtags.splice(this.mtags.indexOf(this.search),1):this.mtags.push(this.search):(this.malltags.push(this.search),this.mtags.push(this.search)),this.search=""),this.changed=!0,e.stopPropagation(),e.preventDefault())}cancel(){this.focused=!1}save(){this.changed||this.toggle({action:"create"});const t=this.mtags.filter(t=>!~this.realtags.indexOf(t)),e=this.realtags.filter(t=>!~this.mtags.indexOf(t));this.changeAction({added:t,removed:e}),this.focused=!1}},qt.components["widget-video"]=class extends _{constructor(){super(),this.template="PHZpZGVvIHt7ImFjdGlvbiIgKCJub2V4cGFuZCIgInRvZ2dsZSIpfX1jb250cm9scz17e2NvbnRyb2xzfX0gc3JjPXt7bW9kZWwuc3JjfX0gLz4=",this.controls=!0}toggle(){const t=this.getElement();t.paused?t.play():t.pause()}},qt.components["widget-waiting"]=class extends _{constructor(){super(),this.template="e3sjaWYgZXJyb3J9fSA8ZGl2IGNsYXNzPSJqdW1ib3Ryb24iPiA8aDEgY2xhc3M9InRleHQtY2VudGVyIj4gPHdpZGdldC1pY29uIGdseXBoPXt7aWNvbn19IGNsYXNzPSJ3aWRnZXQtaWNvbi1sZyIgLz4gPC9oMT4gPHAgY2xhc3M9InRleHQtY2VudGVyIj57e2Vycm9yfX08L3A+IDwvZGl2PiB7e2Vsc2UgaWYgKCJpcy1wcm9taXNlIiBtb2RlbCl9fSA8ZGl2IGNsYXNzPSJqdW1ib3Ryb24iPiA8aDEgY2xhc3M9InRleHQtY2VudGVyIj4gPHdpZGdldC1pY29uIGdseXBoPXt7aWNvbn19IGNsYXNzPSJ3aWRnZXQtaWNvbi1sZyIgLz4gPC9oMT4gPGRpdiBjbGFzcz0iY3NzbG9hZC1sb2FkZXIiPiA8ZGl2IGNsYXNzPSJjc3Nsb2FkLWlubmVyIGNzc2xvYWQtMSI+PC9kaXY+IDxkaXYgY2xhc3M9ImNzc2xvYWQtaW5uZXIgY3NzbG9hZC0yIj48L2Rpdj4gPGRpdiBjbGFzcz0iY3NzbG9hZC1pbm5lciBjc3Nsb2FkLTMiPjwvZGl2PiA8ZGl2IGNsYXNzPSJjc3Nsb2FkLWlubmVyIGNzc2xvYWQtNCI+PC9kaXY+IDwvZGl2PiA8L2Rpdj4ge3tlbHNlfX08eWllbGQtYmxvY2sgLz57ey9pZn19",this.model=I("scope.parent.ctx.model",(function(){return this.scope.parent.ctx.model})),this.error=I("acl","model.error",(function(){if(!this.acl){return this[`e${this.user?403:401}`]}if(this.model&&this.model.error){const t=this.model.error.status;return this[`e${t}`]?this[`e${t}`]:JSON.stringify(this.model&&this.model.error)}}))}},qt.routes=[{name:"index",path:""},{name:"collection",path:"/collection/:id",queryParams:{filter:{refreshModel:!0},debugfilters:{}}},{name:"detail",path:"/detail/:id"},{name:"compare",path:"/compare/:id"},{name:"admin",path:"/admin"},{name:"notfound",path:"*wildcard"}];if(/code=/.test(location.search)){const t=/code=([^&]*)/.exec(decodeURIComponent(location.search))[1];window.opener&&(window.opener.postMessage(t,location.origin),window.close())}const{url:te}=import.meta;